!function(){"use strict";var t=function(){return(t=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function e(t,e,n,i){return new(n||(n=Promise))(function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((i=i.apply(t,e||[])).next())})}function n(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}function i(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function o(t,e){for(var n=0,i=e.length,o=t.length;n<i;n++,o++)t[o]=e[n];return t}var r,a=function(){function t(t){this._hooks={},this._cache=[],this._hooksCache={}}return t.prototype.on=function(t,e){t&&e&&"function"==typeof e&&(this._hooks[t]||(this._hooks[t]=[]),this._hooks[t].push(e))},t.prototype.once=function(t,e){var n=this;if(t&&e&&"function"==typeof e){this.on(t,function i(o){e(o),n.off(t,i)})}},t.prototype.off=function(t,e){if(t&&this._hooks[t]&&this._hooks[t].length)if(e){var n=this._hooks[t].indexOf(e);-1!==n&&this._hooks[t].splice(n,1)}else this._hooks[t]=[]},t.prototype.emit=function(t,e,n){if(n){if(!t)return;-1!==this._cache.indexOf(n)?this._emit(t,e):(this._hooksCache.hasOwnProperty(n)||(this._hooksCache[n]={}),this._hooksCache[n].hasOwnProperty(t)||(this._hooksCache[n][t]=[]),this._hooksCache[n][t].push(e))}else this._emit(t,e)},t.prototype._emit=function(t,e){t&&this._hooks[t]&&this._hooks[t].length&&o([],i(this._hooks[t])).forEach(function(t){try{t(e)}catch(t){}})},t.prototype.set=function(t){t&&-1===this._cache.indexOf(t)&&this._cache.push(t)},t}(),s=function(t){return null!=t&&"[object Object]"==Object.prototype.toString.call(t)},c=function(t){return Array.isArray(t)},u=function(t){return"boolean"==typeof t},l=function(t){return void 0===t},h=(r=+Date.now()+Number("".concat(Math.random()).slice(2,8)),function(){return r+=1}),f=function(t,e,n,i){t.addEventListener?t.addEventListener(e,n,i):t.attachEven?t.attachEven("on".concat(e),n):t["on".concat(e)]=n},p=function(t,e,n,i){t.addEventListener?t.removeEventListener(e,n,i):t.attachEven&&t.detachEven("on".concat(e),n)},d=function(t){return function(t,e,n){if("string"==typeof t&&"number"==typeof e&&"number"==typeof n){var i,o=[];n=n<=25?n:n%25;var r=String.fromCharCode(n+97);i=t.split(r);for(var a=0;a<i.length;a++){var s=parseInt(i[a],n);s=1*s^e;var c=String.fromCharCode(s);o.push(c)}return o.join("")}}(t,64,25)},g=function(t){var e=-1!==navigator.userAgent.indexOf("iPhone")||-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("Mac OS X");f(window,e?"pagehide":"beforeunload",t,!1)},v=function(t,e,n){var i=document.createElement("script");i.src=t,i.onerror=function(){n(t)},i.onload=function(){e()},document.getElementsByTagName("head")[0].appendChild(i)},m=function(){var t=0;return["hidden","msHidden","webkitHidden"].forEach(function(e){void 0!==document[e]&&(t=1)}),t},y=function(t,e){void 0===t&&(t=function(){}),void 0===e&&(e=1e3);var n,i=Date.now()+e;return n=window.setTimeout(function o(){var r=Date.now()-i;t(),i+=e,n=window.setTimeout(o,Math.max(0,e-r))},e),function(){window.clearTimeout(n)}},_=function(t){var e=document.createElement("a");return e.href=t,e},b=function(t){var e={};try{var n=_(t).search;(n=n.slice(1)).split("&").forEach(function(t){var n,i,o=t.split("=");o.length&&(n=o[0],i=o[1]);try{e[n]=decodeURIComponent(void 0===i?"":i)}catch(t){e[n]=i}})}catch(t){}return e},E=function(t){for(var e=0,n=0,i=(t+="").length,o=0;o<i;o++)((e=31*e+t.charCodeAt(n++))>0x7fffffffffff||e<-0x800000000000)&&(e&=0xffffffffffff);return e<0&&(e+=0x7ffffffffffff),e},S=function(){var t=window.navigator.appName,e=window.navigator.userAgent;return-1!==t.indexOf("Microsoft Internet Explorer")&&(-1!==e.indexOf("MSIE 8.0")||-1!==e.indexOf("MSIE 7.0")||-1!==e.indexOf("MSIE 9.0"))},w=function(){var t=window.navigator.appName,e=window.navigator.userAgent;return-1!==t.indexOf("Microsoft Internet Explorer")&&(-1!==e.indexOf("MSIE 8.0")||-1!==e.indexOf("MSIE 7.0")||-1!==e.indexOf("MSIE 9.0"))},T=function(){var t=window.navigator.appName,e=window.navigator.userAgent;return-1!==t.indexOf("Microsoft Internet Explorer")&&(-1!==e.indexOf("MSIE 8.0")||-1!==e.indexOf("MSIE 9.0"))},k=function(){var t=window.navigator.appName,e=window.navigator.userAgent;return-1!==t.indexOf("Microsoft Internet Explorer")&&-1!==e.indexOf("MSIE 7.0")};var D=function(t){var e,n,i=[],o=t.length;o%2!=0&&(n=o+1,t=(e=t).length>=n?e:new Array(n-e.length+1).join("0")+e),o=t.length;for(var r=0;r<o;r+=2)i.push(parseInt(t.substr(r,2),16));return i},A="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function I(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function O(t,e){return t(e={exports:{}},e.exports),e.exports}var x=O(function(t,e){var n;n=function(){function t(){for(var t=0,e={};t<arguments.length;t++){var n=arguments[t];for(var i in n)e[i]=n[i]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(i){function o(){}function r(e,n,r){if("undefined"!=typeof document){"number"==typeof(r=t({path:"/"},o.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var a=JSON.stringify(n);/^[\{\[]/.test(a)&&(n=a)}catch(t){}n=i.write?i.write(n,e):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in r)r[c]&&(s+="; "+c,!0!==r[c]&&(s+="="+r[c].split(";")[0]));return document.cookie=e+"="+n+s}}function a(t,n){if("undefined"!=typeof document){for(var o={},r=document.cookie?document.cookie.split("; "):[],a=0;a<r.length;a++){var s=r[a].split("="),c=s.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=e(s[0]);if(c=(i.read||i)(c,u)||e(c),n)try{c=JSON.parse(c)}catch(t){}if(o[u]=c,t===u)break}catch(t){}}return t?o[t]:o}}return o.set=r,o.get=function(t){return a(t,!1)},o.getJSON=function(t){return a(t,!0)},o.remove=function(e,n){r(e,"",t(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}(function(){})},t.exports=n()}),R=function(){function t(){this.cache={}}return t.prototype.setItem=function(t,e){this.cache[t]=e},t.prototype.getItem=function(t){return this.cache[t]},t.prototype.removeItem=function(t){this.cache[t]=void 0},t.prototype.getCookie=function(t){this.getItem(t)},t.prototype.setCookie=function(t,e){this.setItem(t,e)},t.prototype.removeCookie=function(t,e){this.removeItem(t)},t}();var M={getItem:function(t){try{var e=localStorage.getItem(t),n=e;try{e&&"string"==typeof e&&(n=JSON.parse(e))}catch(t){}return n||{}}catch(t){}return{}},setItem:function(t,e){try{var n="string"==typeof e?e:JSON.stringify(e);localStorage.setItem(t,n)}catch(t){}},removeItem:function(t){try{localStorage.removeItem(t)}catch(t){}},getCookie:function(t,e){try{return x.get(t)}catch(t){return""}},setCookie:function(t,e,n,i){try{var o=i||document.domain,r=+new Date+n;x.set(t,e,{expires:new Date(r),path:"/",domain:o})}catch(t){}},removeCookie:function(t,e){try{x.remove(t,{path:"/",domain:e||""})}catch(t){}},isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(t){return!1}}()},C={getItem:function(t){try{var e=sessionStorage.getItem(t),n=e;try{e&&"string"==typeof e&&(n=JSON.parse(e))}catch(t){}return n||{}}catch(t){}return{}},setItem:function(t,e){try{var n="string"==typeof e?e:JSON.stringify(e);sessionStorage.setItem(t,n)}catch(t){}},removeItem:function(t){try{sessionStorage.removeItem(t)}catch(t){}},getCookie:function(t){this.getItem(t)},setCookie:function(t,e){this.setItem(t,e)},removeCookie:function(t,e){this.removeItem(t)},isSupportSession:function(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(t){return!1}}()},B=function(){function t(t,e){this._storage=e&&"session"===e?C:!t&&M.isSupportLS?M:new R}return t.prototype.getItem=function(t){return this._storage.getItem(t)},t.prototype.setItem=function(t,e){this._storage.setItem(t,e)},t.prototype.removeItem=function(t){this._storage.removeItem(t)},t.prototype.getCookie=function(t,e){return this._storage.getCookie(t,e)},t.prototype.setCookie=function(t,e,n,i){this._storage.setCookie(t,e,n,i)},t.prototype.removeCookie=function(t,e){this._storage.removeCookie(t,e)},t}(),G=function(){function t(t,e,n){this.appid=t,this.domain=e,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=n}return t.prototype.init=function(){var t=window.navigator.userAgent,e=window.navigator.language,n=document.referrer,i=n?_(n).hostname:"",o=b(window.location.href),r="web";-1===this.appVersion.indexOf("Mobile")&&-1===this.appVersion.indexOf("Android")&&-1===this.appVersion.indexOf("iPhone")&&-1===this.appVersion.indexOf("iPad")&&-1===this.appVersion.indexOf("mini")||(r="wap"),this.utm=function(t,e,n,i){var o=new B(!1),r=new B(!1,"session"),a=t?"_tea_utm_cache_".concat(t):"_tea_utm_cache",s=t?"_$utm_from_url_".concat(t):"_$utm_from_url",c={},u=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],l={ad_id:Number(e.ad_id)||void 0,campaign_id:Number(e.campaign_id)||void 0,creative_id:Number(e.creative_id)||void 0,utm_source:e.utm_source,utm_medium:e.utm_medium,utm_campaign:e.utm_campaign,utm_term:e.utm_term,utm_content:e.utm_content,tr_shareuser:e.tr_shareuser,tr_admaster:e.tr_admaster,tr_param1:e.tr_param1,tr_param2:e.tr_param2,tr_param3:e.tr_param3,tr_param4:e.tr_param4};try{var h=!1;for(var f in l)l[f]&&(-1!==u.indexOf(f)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[f]=l[f]):c[f]=l[f],h=!0);if(h)r.setItem(s,"1"),o.setCookie(a,JSON.stringify(c),i,n);else{var p=o.getCookie(a,n);p&&(c=JSON.parse(p))}1==r.getItem(s)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(t){return l}return c}(this.appid,o,this.domain,this.cookie_expire);var a=this.browser(),s=this.os();return{browser:a.browser,browser_version:a.browser_version,platform:r,os_name:s.os_name,os_version:s.os_version,userAgent:t,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:e,referrer:n,referrer_host:i,utm:this.utm,latest_data:this.last(n,i)}},t.prototype.last=function(t,e){var n="",i="",o="",r=location.hostname,a=!1;if(t&&e&&r!==e){n=t,i=e,a=!0;var s=b(t);s.keyword&&(o=s.keyword)}return{$latest_referrer:n,$latest_referrer_host:i,$latest_search_keyword:o,isLast:a}},t.prototype.browser=function(){var t,e,n="",i="".concat(parseFloat(this.appVersion)),o=this.userAgent;return-1!==o.indexOf("Edge")||-1!==o.indexOf("Edg")?(n="Microsoft Edge",-1!==o.indexOf("Edge")?(t=o.indexOf("Edge"),i=o.substring(t+5)):(t=o.indexOf("Edg"),i=o.substring(t+4))):-1!==o.indexOf("MSIE")||-1!==o.indexOf("Trident")?(n="Microsoft Internet Explorer",-1!==o.indexOf("MSIE")?(t=o.indexOf("MSIE"),i=o.substring(t+5,t+9)):(t=o.indexOf("rv"),i=o.substring(t+3,t+7))):-1!==(t=o.indexOf("Lark"))?(n="Lark",i=o.substring(t+5,t+11)):-1!==(t=o.indexOf("MetaSr"))?(n="sougoubrowser",i=o.substring(t+7,t+10)):-1!==o.indexOf("MQQBrowser")||-1!==o.indexOf("QQBrowser")?(n="qqbrowser",-1!==o.indexOf("MQQBrowser")?(t=o.indexOf("MQQBrowser"),i=o.substring(t+11,t+15)):-1!==o.indexOf("QQBrowser")&&(t=o.indexOf("QQBrowser"),i=o.substring(t+10,t+17))):-1!==o.indexOf("Chrome")?-1!==(t=o.indexOf("MicroMessenger"))?(n="weixin",i=o.substring(t+15,t+20)):-1!==(t=o.indexOf("360"))?(n="360browser",i=o.substring(o.indexOf("Chrome")+7)):-1!==o.indexOf("baidubrowser")||-1!==o.indexOf("BIDUBrowser")?(-1!==o.indexOf("baidubrowser")?(t=o.indexOf("baidubrowser"),i=o.substring(t+13,t+16)):-1!==o.indexOf("BIDUBrowser")&&(t=o.indexOf("BIDUBrowser"),i=o.substring(t+12,t+15)),n="baidubrowser"):-1!==(t=o.indexOf("xiaomi"))?-1!==o.indexOf("openlanguagexiaomi")?(n="openlanguage xiaomi",i=o.substring(t+7,t+13)):(n="xiaomi",i=o.substring(t-7,t-1)):-1!==(t=o.indexOf("TTWebView"))?(n="TTWebView",i=o.substring(t+10,t+23)):-1!==(t=o.indexOf("Chrome"))?(n="Chrome",i=o.substring(t+7)):-1!==(t=o.indexOf("Chrome"))&&(n="Chrome",i=o.substring(t+7)):-1!==o.indexOf("Safari")?-1!==(t=o.indexOf("QQ"))?(n="qqbrowser",i=o.substring(t+10,t+16)):-1!==(t=o.indexOf("Safari"))&&(n="Safari",i=o.substring(t+7),-1!==(t=o.indexOf("Version"))&&(i=o.substring(t+8))):-1!==(t=o.indexOf("Firefox"))?(n="Firefox",i=o.substring(t+8)):-1!==(t=o.indexOf("MicroMessenger"))?(n="weixin",i=o.substring(t+15,t+20)):-1!==(t=o.indexOf("QQ"))?(n="qqbrowser",i=o.substring(t+3,t+8)):-1!==(t=o.indexOf("Opera"))&&(n="Opera",i=o.substring(t+6),-1!==(t=o.indexOf("Version"))&&(i=o.substring(t+8))),-1!==(e=i.indexOf(";"))&&(i=i.substring(0,e)),-1!==(e=i.indexOf(" "))&&(i=i.substring(0,e)),-1!==(e=i.indexOf(")"))&&(i=i.substring(0,e)),{browser:n,browser_version:i}},t.prototype.os=function(){var t,e,n,i="";if(w());else{for(var o=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows",r:/(Windows|Windows NT)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],r=0;r<o.length;r++){var a=o[r];if(a.r.test(this.userAgent)){"Mac OS X"===(i=a.s)&&this.isNewIpad()&&(i="iOS");break}}var s=function(t,e){var n=t.exec(e);return n&&n[1]?n[1]:""},c=function(t,e){var n=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:".concat(t,")"),"i").exec(e);return n?n.slice(1)[0]:""};/Windows/.test(i)&&(t=s(/Windows (.*)/,i),i="windows");switch(i){case"Mac OS X":t=c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),i="mac";break;case"Android":e=this.userAgent,(n=s(/Android ([\.\_\d]+)/,e))||(n=s(/Android\/([\.\_\d]+)/,e)),t=n,i="android";break;case"iOS":t=this.isNewIpad()?c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?"".concat(t[1],".").concat(t[2],".").concat(0|t[3]):"",i="ios"}}return{os_name:i,os_version:t}},t.prototype.getDeviceModel=function(t){var e="";try{if("android"===t)navigator.userAgent.split(";").forEach(function(t){t.indexOf("Build/")>-1&&(e=t.slice(0,t.indexOf("Build/")))});else if("ios"===t||"mac"===t||"windows"===t)if(this.isNewIpad())e="iPad";else{var n=navigator.userAgent.replace("Mozilla/5.0 (",""),i=n.indexOf(";");e=-1===i?"":n.slice(0,i)}}catch(t){return e.trim()}return e.trim()},t.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1},t}(),N={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az24z1mz1jz1az1cz18z1nz1nz1jz1mz1ez4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},L="5.2.1_tob";var P,U,z={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},j="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-editor-rangers.js",F="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-ab-core.js",q="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/heatmap-core";!function(t){t.Init="init",t.Config="config",t.Start="start",t.ReStart="re-start-sdk",t.Stop="stop-sdk",t.Ready="ready",t.CloudReady="cloud-ready",t.TokenComplete="token-complete",t.TokenStorage="token-storage",t.TokenFetch="token-fetch",t.TokenError="token-error",t.ConfigUuid="config-uuid",t.ConfigWebId="config-webid",t.ConfigDomain="config-domain",t.CustomWebId="custom-webid",t.AnonymousId="anonymous-id",t.TokenChange="token-change",t.TokenReset="token-reset",t.ConfigTransform="config-transform",t.EnvTransform="env-transform",t.SessionReset="session-reset",t.SessionResetTime="session-reset-time",t.Event="event",t.Events="events",t.EventNow="event-now",t.CleanEvents="clean-events",t.BeconEvent="becon-event",t.SubmitBefore="submit-before",t.SubmitScuess="submit-scuess",t.SubmitAfter="submit-after",t.SubmitError="submit-error",t.SubmitVerifyH="submit-verify-h5",t.BindToken="bind-token",t.BindTokenReady="bind-token-ready",t.CustomHeader="custom-request-header",t.Stay="stay",t.ResetStay="reset-stay",t.StayReady="stay-ready",t.SetStay="set-stay",t.RouteChange="route-change",t.RouteReady="route-ready",t.Ab="ab",t.AbVar="ab-var",t.AbAllVars="ab-all-vars",t.AbConfig="ab-config",t.AbExternalVersion="ab-external-version",t.AbVersionChangeOn="ab-version-change-on",t.AbVersionChangeOff="ab-version-change-off",t.AbOpenLayer="ab-open-layer",t.AbCloseLayer="ab-close-layer",t.AbReady="ab-ready",t.AbComplete="ab-complete",t.AbTimeout="ab-timeout",t.Profile="profile",t.ProfileSet="profile-set",t.ProfileSetOnce="profile-set-once",t.ProfileUnset="profile-unset",t.ProfileIncrement="profile-increment",t.ProfileAppend="profile-append",t.ProfileClear="profile-clear",t.TrackDuration="track-duration",t.TrackDurationStart="track-duration-start",t.TrackDurationEnd="track-duration-end",t.TrackDurationPause="track-duration-pause",t.TrackDurationResume="tracl-duration-resume",t.Autotrack="autotrack",t.AutotrackReady="autotrack-ready",t.SetExposureType="set-exposure-type",t.CepReady="cep-ready",t.TracerReady="tracer-ready",t.EncryptData="encrypt-data",t.LogSettingReady="logsetting-ready",t.SetResource="set-resource"}(P||(P={})),function(t){t.DEBUGGER_MESSAGE="debugger-message",t.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",t.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",t.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",t.DEBUGGER_MESSAGE_EVENT="debugger-message-event",t.DEVTOOL_WEB_READY="devtool-web-ready"}(U||(U={}));var V=P,K=void 0,H=(new Date).getTimezoneOffset(),J=parseInt("".concat(-H/60),10),W=60*H,X=7776e6,$=function(){function e(t,e){var n=this;this.is_first_time=!0,this.configPersist=!1,this.initConfig=e,this.collect=t;var i=new G(e.app_id,e.cookie_domain||"",e.cookie_expire||X).init();this.commonInfo=i;var o="__tea_cache_first_".concat(e.app_id);this.configKey="__tea_cache_config_".concat(e.app_id),this.sessionStorage=new B(!1,"session"),this.localStorage=new B(!1,"local"),e.configPersist&&(this.configPersist=!0,this.storage=1===e.configPersist?this.sessionStorage:this.localStorage);var r=this.localStorage.getItem(o);r&&1==r?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(o,"1")),this.envInfo={user:{user_unique_id:K,user_type:K,user_id:K,user_is_auth:K,user_is_login:K,device_id:K,web_id:K,ip_addr_id:K,user_unique_id_type:K,anonymous_id:K},header:{app_id:K,app_name:K,app_install_id:K,install_id:K,app_package:K,app_channel:K,app_version:K,ab_version:K,os_name:i.os_name,os_version:i.os_version,device_model:i.device_model,ab_client:K,traffic_type:K,client_ip:K,device_brand:K,os_api:K,access:K,language:i.language,region:K,app_language:K,app_region:K,creative_id:i.utm.creative_id,ad_id:i.utm.ad_id,campaign_id:i.utm.campaign_id,log_type:K,rnd:K,platform:i.platform,sdk_version:L,sdk_lib:"js",province:K,city:K,timezone:J,tz_offset:W,tz_name:K,sim_region:K,carrier:K,resolution:"".concat(i.screen_width,"x").concat(i.screen_height),browser:i.browser,browser_version:i.browser_version,referrer:i.referrer,referrer_host:i.referrer_host,width:i.screen_width,height:i.screen_height,screen_width:i.screen_width,screen_height:i.screen_height,utm_term:i.utm.utm_term,utm_content:i.utm.utm_content,utm_source:i.utm.utm_source,utm_medium:i.utm.utm_medium,utm_campaign:i.utm.utm_campaign,tracer_data:JSON.stringify(i.utm.tracer_data),custom:{},wechat_unionid:K,wechat_openid:K}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(i),this.initDomain(),this.initABData(),this.collect.on("route-change",function(t){n.changeReferInfo(t.config)})}return e.prototype.initDomain=function(){var t=this.initConfig.channel_domain;if(t)this.domain=t;else{var e=this.initConfig.channel;this.domain=d(N[e])}},e.prototype.setDomain=function(t){this.domain=t},e.prototype.getDomain=function(){return this.domain},e.prototype.getCommonInfo=function(t){return t?this.commonInfo[t]||"":this.commonInfo},e.prototype.initABData=function(){var t="__tea_sdk_ab_version_".concat(this.initConfig.app_id),e=null;if(this.initConfig.ab_cross){var n=this.localStorage.getCookie(t,this.initConfig.ab_cookie_domain);e=n?JSON.parse(n):null}else e=this.localStorage.getItem(t);this.setAbCache(e)},e.prototype.setAbCache=function(t){this.ab_cache=t},e.prototype.getAbCache=function(){return this.ab_cache},e.prototype.clearAbCache=function(){this.ab_cache={},this.ab_version=""},e.prototype.setAbVersion=function(t){this.ab_version=t},e.prototype.getAbVersion=function(){return this.ab_version},e.prototype.getUrl=function(t){var e="";switch(t){case"event":e="/list";break;case"webid":e="/webid";break;case"tobid":e="/tobid";break;case"profile":e="/profile/list";break;case"img":e="/gif";break;case"bind":e="/service/2/id_bind"}var n="";return this.initConfig.caller&&(n="?sdk_version=".concat(L,"&sdk_name=web&app_id=").concat(this.initConfig.app_id,"&caller=").concat(this.initConfig.caller)),this.initConfig.enable_encryption&&"sm"===this.initConfig.encryption_type&&!S()&&(n=n),this.initConfig.report_url?"".concat(this.initConfig.report_url).concat(n):"".concat(this.getDomain()).concat(e).concat(n)},e.prototype.setCustom=function(t){if(t&&t.latest_data&&t.latest_data.isLast)for(var e in delete t.latest_data.isLast,this.isLast=!0,t.latest_data){this.envInfo.header.custom[e]=t.latest_data[e];var n={};n["".concat(e)]=t.latest_data[e],this.set(n)}},e.prototype.changeReferInfo=function(t){var e=t;this.set({referrer:e.referrer});var n="";try{n=new URL(e.referrer).host}catch(t){}this.set({referrer_host:n||this.envInfo.header.referrer_host})},e.prototype.set=function(e){var n=this;Object.keys(e).forEach(function(i){if(void 0!==e[i]&&null!==e[i]||n.delete(i),"traffic_type"===i&&n.isLast&&(n.envInfo.header.custom.$latest_traffic_source_type=e[i]),"evtParams"===i)n.evtParams=t(t({},n.evtParams||{}),e.evtParams||{});else if("_staging_flag"===i)n.evtParams=t(t({},n.evtParams||{}),{_staging_flag:e._staging_flag});else if("reportErrorCallback"===i&&"function"==typeof e[i])n.reportErrorCallback=e[i];else{var o="",r="";if(i.indexOf(".")>-1){var a=i.split(".");o=a[0],r=a[1]}o?"user"===o||"header"===o?n.envInfo[o][r]=e[i]:(n.envInfo.header.custom[r]=e[i],n.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 添加了Custom",level:"info",time:Date.now(),infoType:"sdk",secType:"HEADER",common:"custom"})):Object.hasOwnProperty.call(n.envInfo.user,i)?(["user_type","ip_addr_id"].indexOf(i)>-1?n.envInfo.user[i]=e[i]?Number(e[i]):e[i]:["user_id","web_id","user_unique_id","user_unique_id_type","anonymous_id"].indexOf(i)>-1?n.envInfo.user[i]=e[i]?String(e[i]):e[i]:["user_is_auth","user_is_login"].indexOf(i)>-1?n.envInfo.user[i]=Boolean(e[i]):"device_id"===i&&(n.envInfo.user[i]=e[i]),n.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 修改了公共参数",level:"info",time:Date.now(),infoType:"sdk",secType:"USER",common:i})):Object.hasOwnProperty.call(n.envInfo.header,i)?(n.envInfo.header[i]=e[i],n.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 修改了公共参数",level:"info",time:Date.now(),infoType:"sdk",secType:"HEADER",common:i})):(n.envInfo.header.custom[i]=e[i],n.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 添加了Custom",level:"info",time:Date.now(),infoType:"sdk",secType:"HEADER",common:"custom"}))}})},e.prototype.getSettingData=function(t){if(this.logSettingConfig&&!l(this.logSettingConfig[t]))return this.logSettingConfig[t]},e.prototype.setSettingData=function(t){this.logSettingConfig=t},e.prototype.get=function(t){try{return t?"evtParams"===t?this.evtParams:"reportErrorCallback"===t?this[t]:Object.hasOwnProperty.call(this.envInfo.user,t)?this.envInfo.user[t]:Object.hasOwnProperty.call(this.envInfo.header,t)?this.envInfo.header[t]:JSON.parse(JSON.stringify(this.envInfo[t])):JSON.parse(JSON.stringify(this.envInfo))}catch(t){console.log("get config stringify error "),this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},e.prototype.setStore=function(t){try{if(!this.configPersist)return;var e=this.storage.getItem(this.configKey)||{};if(e&&Object.keys(t).length){var n=Object.assign(t,e);this.storage.setItem(this.configKey,n)}}catch(t){console.log("setStore error"),this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},e.prototype.getStore=function(){try{if(!this.configPersist)return null;var t=this.storage.getItem(this.configKey)||{};return t&&Object.keys(t).length?t:null}catch(t){return this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),null}},e.prototype.delete=function(t){try{if(!this.configPersist)return;var e=this.storage.getItem(this.configKey)||{};e&&Object.hasOwnProperty.call(e,t)&&(delete e[t],this.storage.setItem(this.configKey,e))}catch(t){this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),console.log("delete error")}},e}(),Z=function(){function t(t,e){this.isLog=e||!1,this.name=t||""}return t.prototype.info=function(t){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[instance: ".concat(this.name,"]")+" "+t)},t.prototype.warn=function(t){this.isLog&&console.warn("%c %s","color: yellow; background-color: black;","[instance: ".concat(this.name,"]")+" "+t)},t.prototype.error=function(t){this.isLog&&console.error("[instance: ".concat(this.name,"]")+" "+t)},t.prototype.throw=function(t){throw this.error(this.name),new Error(t)},t}(),Q=function(){function t(t,e){this.native=t.enable_native||t["evitaN".split("").reverse().join("")],this.os=e.get("os_name")}var e=t.prototype;return e.bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),AppLogBridge.osName?this.os=AppLogBridge.osName():this.os=this.os,!0):(console.log("AppLogBridge is not inject"),!1))}catch(t){return console.log("AppLogBridge is not inject"),!1}},e.bridgeReady=function(){var t=this;return new Promise(function(e,n){try{t.bridgeInject()?AppLogBridge.hasStarted(function(t){console.log("AppLogBridge is started? : "+t),t?e(!0):n(!1)}):n(!1)}catch(t){console.log("AppLogBridge, error:"+JSON.stringify(t.stack)),n(!1)}})},e.setNativeAppId=function(t){try{AppLogBridge.setNativeAppId(JSON.stringify(t)),console.log("change bridge appid, event report with appid: "+t)}catch(t){console.error("setNativeAppId error")}},e.setConfig=function(t){var e=this;try{Object.keys(t).forEach(function(n){"user_unique_id"===n?e.setUserUniqueId(t[n]):t[n]?e.addHeaderInfo(n,t[n]):e.removeHeaderInfo(n)})}catch(t){console.error("setConfig error")}},e.setUserUniqueId=function(t){try{AppLogBridge.setUserUniqueId(t)}catch(t){console.error("setUserUniqueId error")}},e.addHeaderInfo=function(t,e){try{AppLogBridge.addHeaderInfo(t,e)}catch(t){console.error("addHeaderInfo error")}},e.setHeaderInfo=function(t){try{AppLogBridge.setHeaderInfo(JSON.stringify(t))}catch(t){console.error("setHeaderInfo error")}},e.removeHeaderInfo=function(t){try{AppLogBridge.removeHeaderInfo(t)}catch(t){console.error("removeHeaderInfo error")}},e.reportPv=function(t){this.onEventV3("predefine_pageview",t)},e.onEventV3=function(t,e){try{AppLogBridge.onEventV3(t,e)}catch(t){console.error("onEventV3 error")}},e.profileSet=function(t){try{AppLogBridge.profileSet(t)}catch(t){console.error("profileSet error")}},e.profileSetOnce=function(t){try{AppLogBridge.profileSetOnce(t)}catch(t){console.error("profileSetOnce error")}},e.profileIncrement=function(t){try{AppLogBridge.profileIncrement(t)}catch(t){console.error("profileIncrement error")}},e.profileUnset=function(t){try{AppLogBridge.profileUnset(t)}catch(t){console.error("profileUnset error")}},e.profileAppend=function(t){try{AppLogBridge.profileAppend(t)}catch(t){console.error("profileAppend error")}},e.setExternalAbVersion=function(t){try{AppLogBridge.setExternalAbVersion(t)}catch(t){console.error("setExternalAbVersion error")}},e.getVar=function(t,e,n){try{"harmonyos"===this.os?n(AppLogBridge.getABTestConfigValueForKey(t,e)):"android"===this.os?n(AppLogBridge.getABTestConfigValueForKey(t,e)):AppLogBridge.getABTestConfigValueForKey(t,e,function(t){n(t)})}catch(t){console.error("getVar error"),n(e)}},e.getAllVars=function(t){try{"harmonyos"===this.os?t(AppLogBridge.getAllAbTestConfigs()):"android"===this.os?t(AppLogBridge.getAllAbTestConfigs()):AppLogBridge.getAllAbTestConfigs(function(e){t(e)})}catch(e){console.error("getAllVars error"),t(null)}},e.getAbSdkVersion=function(t){try{"harmonyos"===this.os?t(AppLogBridge.getAbSdkVersion()):"android"===this.os?t(AppLogBridge.getAbSdkVersion()):AppLogBridge.getAbSdkVersion(function(e){t(e)})}catch(e){console.error("getAbSdkVersion error"),t("")}},t}(),Y={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005};function tt(t,e,n,i,o,r,a,s,c,u){try{var l;if(window.XDomainRequest&&T()){l=new XDomainRequest;var h=s||"post";l.open(h,t),n&&(l.timeout=n,l.ontimeout=function(){r&&r(e,Y.TIMEOUT)}),l.onerror=function(){l.abort(),r&&r(e,Y.XHR_ON)},l.onload=function(){if(o){var t=null;if(l.responseText){try{t=JSON.parse(l.responseText)}catch(e){t={}}o(t,e)}}},setTimeout(function(){l.send(JSON.stringify(e))},0)}else if(window.ActiveXObject&&k()){l=new ActiveXObject("Micrsorf.XMLHTTP");h=s||"POST";l.open(h,t),n&&(l.timeout=n,l.ontimeout=function(){r&&r(e,Y.TIMEOUT)}),l.onerror=function(){l.abort(),r&&r(e,Y.XHR_ON)},l.onload=function(){if(o){var t=null;if(l.responseText){try{t=JSON.parse(l.responseText)}catch(e){t={}}o(t,e)}}},setTimeout(function(){l.send(JSON.stringify(e))},0)}else if(window.XMLHttpRequest){l=new XMLHttpRequest;h=s||"POST";l.open(h,t,!0),c&&u&&!S()?l.setRequestHeader("Content-Type","application/octet-stream;tt-data=".concat(u)):l.setRequestHeader("Content-Type","application/json; charset=utf-8"),a&&l.setRequestHeader("X-MCS-AppKey","".concat(a)),i&&(l.withCredentials=!0),n&&(l.timeout=n,l.ontimeout=function(){r&&r(e,Y.TIMEOUT)}),l.onreadystatechange=function(){if(4===l.readyState&&200===l.status&&o){var t=null;if(l.responseText){try{t=JSON.parse(l.responseText)}catch(e){t={}}o(t,e)}}},l.onerror=function(){l.abort(),r&&r(e,Y.XHR_ON)},c&&!S()?l.send(e):l.send(JSON.stringify(e))}}catch(t){console.log(t.message)}}var et=4e3,nt=4002,it=function(t,e,n,i){try{e.forEach(function(o){var r=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&(e+="&".concat(n,"=").concat(encodeURIComponent(JSON.stringify(t[n]))));return e="&"===e.slice(0,1)?e.slice(1):e}(o),a=new Image(1,1);a.onload=function(){a=null,n&&n()},a.onerror=function(){a=null,i&&i(t,e,et)},a.src="".concat(t,"?").concat(r)})}catch(n){i&&i(t,e,nt,n.message)}},ot=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},rt=function(){function t(){}return t.prototype.apply=function(t,e){var n=this;this.collect=t,this.storage=new B(!1,"session"),this.sessionKey="__tea_session_id_".concat(e.app_id),this.expireTime=e.expireTime||18e5,this.disableSession=e.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(V.SessionReset,function(){n.resetSessionId()}),this.collect.on(V.SessionResetTime,function(){n.updateSessionIdTime()}))},t.prototype.updateSessionIdTime=function(){var t=this.storage.getItem(this.sessionKey);if(t&&t.sessionId){var e=t.timestamp;Date.now()-e>this.expireTime?t={sessionId:ot(),timestamp:Date.now()}:t.timestamp=Date.now(),this.storage.setItem(this.sessionKey,t),this.resetExpTime()}},t.prototype.setSessionId=function(){var t=this,e=this.storage.getItem(this.sessionKey);e&&e.sessionId?e.timestamp=Date.now():e={sessionId:ot(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e),this.sessionExp=setInterval(function(){t.checkEXp()},this.expireTime)},t.prototype.getSessionId=function(){var t=this.storage.getItem(this.sessionKey);return this.disableSession?"":t&&t.sessionId?t.sessionId:""},t.prototype.resetExpTime=function(){var t=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){t.checkEXp()},this.expireTime))},t.prototype.resetSessionId=function(){var t={sessionId:ot(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,t)},t.prototype.checkEXp=function(){var t=this.storage.getItem(this.sessionKey);t&&t.sessionId&&(Date.now()-t.timestamp+30>=this.expireTime&&(t={sessionId:ot(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t)))},t}(),at=function(){function e(t,e){var n=this;this.MAX_LEVEL=3,this.metaResource={},this.eventCache=[],e.enable_track_id&&(this.MAX_LEVEL=e.track_level||3,t.on(V.SetResource,function(t){n.metaResource=t}))}return e.prototype.handleMetaResource=function(e){var n=this;return Object.keys(this.metaResource).length?(e.forEach(function(e){var r=e.event,a=e.local_time_ms,s=e.params,c=t({},JSON.parse(s));try{for(var u in c)if(n.metaResource.hasOwnProperty(u)){var l=c[u],h=n.metaResource[u];if(h.length&&h.includes(l)){var f=ot();c.ubt_source_id=f,n.eventCache.length&&(c.ubt_source=o([],i(n.eventCache)).reverse()),n.eventCache.length>=n.MAX_LEVEL&&n.eventCache.shift(),n.eventCache.push({event:r,params:t(t({},JSON.parse(s)),{ubt_source_id:f}),local_time_ms:a})}break}}finally{e.params=JSON.stringify(c)}}),e):e},e}(),st=function(){function e(){this.eventLimit=50,this.eventCache=[],this.beconEventCache=[]}return e.prototype.apply=function(t,e){var n=this;this.collect=t,this.config=e,this.configManager=t.configManager,this.cacheStorgae=new B(!0),this.localStorage=new B(!1),this.trackId=new at(t,e),this.maxReport=e.max_report||20,this.reportTime=e.reportTime||30,this.timeout=e.timeout||1e5,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_".concat(this.configManager.get("app_id")),this.beconKey="__tea_cache_events_becon_".concat(this.configManager.get("app_id")),this.abKey="__tea_sdk_ab_version_".concat(this.configManager.get("app_id")),this.refer_key="__tea_cache_refer_".concat(this.configManager.get("app_id")),this.collect.on(V.Ready,function(){n.reportAll(!1)}),this.collect.on(V.ConfigDomain,function(){n.reportUrl=n.configManager.getUrl("event")}),this.collect.on(V.Event,function(t){n.event(t)}),this.collect.on(V.BeconEvent,function(t){n.beconEvent(t)}),this.collect.on(V.CleanEvents,function(){n.reportAll(!1)}),this.collect.on(V.BindTokenReady,function(){n.reportAll(!1)}),this.linster()},e.prototype.linster=function(){var t=this;f(window,"unload",function(){t.reportAll(!0)},!1),g(function(){t.reportAll(!0)}),f(document,"visibilitychange",function(){"hidden"===document.visibilityState&&t.reportAll(!0)},!1)},e.prototype.reportAll=function(t){this.report(t),this.reportBecon()},e.prototype.event=function(t){var e=this;try{var n=this.cacheStorgae.getItem(this.eventKey)||[],r=o(o([],i(t)),i(n));if(this.cacheStorgae.setItem(this.eventKey,r),this.reportTimeout&&clearTimeout(this.reportTimeout),r.length>=this.maxReport)this.report(!1);else{var a=this.reportTime;this.reportTimeout=setTimeout(function(){e.report(!1),e.reportTimeout=null},a)}}catch(t){this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 发生了异常",level:"error",time:Date.now(),data:t.message,infoType:"sdk"})}},e.prototype.beconEvent=function(t){if(!this.collect.destroyInstance&&!this.collect.sdkStop){var e=this.cacheStorgae.getItem(this.beconKey)||[],n=o(o([],i(t)),i(e));this.cacheStorgae.setItem(this.beconKey,n),this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(n)),!0))}},e.prototype.reportBecon=function(){if(!this.collect.destroyInstance&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.beconKey)||[];t&&t.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(t)),!0))}},e.prototype.report=function(t){if(!this.collect.destroyInstance&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.eventKey)||[];e.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(e,t))}},e.prototype.sliceEvent=function(t,e){if(t.length>this.eventLimit)for(var n=0;n<t.length;n+=this.eventLimit){var i;i=t.slice(n,n+this.eventLimit);var o=this.split(this.merge(i));this.send(o,e)}else{o=this.split(this.merge(t));this.send(o,e)}},e.prototype.merge=function(e,n){var i,o,r=this,a=this.configManager.get(),s=a.header,c=a.user;s.custom.origin_referrer=null===(i=this.collect.configManager)||void 0===i?void 0:i.getCommonInfo("referrer"),s.custom.origin_referrer_host=null===(o=this.collect.configManager)||void 0===o?void 0:o.getCommonInfo("referrer_host"),s.custom=JSON.stringify(s.custom);var u=this.configManager.get("evtParams"),l=this.configManager.get("user_unique_id_type"),h=[];try{var f=e.filter(function(e){try{if(Object.keys(u).length&&!n&&(e.params=t(t({},e.params),u)),r.collect.dynamicParamsFilter&&!n){var i=r.collect.dynamicParamsFilter();Object.keys(i).length&&(e.params=t(t({},e.params),i))}l&&!n&&(e.params.$user_unique_id_type=l);var o=r.configManager.getAbCache(),a=r.configManager.getAbVersion();return a&&o&&(r.config.disable_ab_reset?e.ab_sdk_version=a:o.uuid===c.user_unique_id&&(e.ab_sdk_version=a)),e.session_id=r.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),r.blockEvent(e.event)&&r.whiteEvent(e.event)}catch(t){return console.warn("filter merge event: ".concat(e&&e.event," error, pls check"),t&&t.message),r.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 处理Event数据异常",level:"error",time:Date.now(),data:t.message,infoType:"sdk"}),!1}});if(this.config.enable_track_id&&(f=this.trackId.handleMetaResource(f)),!Object.keys(c).length)return console.warn("user info error，cant report"),h;this.config.enable_anonymousid&&delete c.web_id;var p=JSON.parse(JSON.stringify({events:f,user:c,header:s}));p.local_time=Math.floor(Date.now()/1e3),p.verbose=1,p.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,h.push(p)}catch(t){console.warn("event merge error, pls check",t&&t.message)}return h},e.prototype.split=function(t){return t=t.map(function(t){var e=[];return e.push(t),e})},e.prototype.blockEvent=function(t){try{var e=this.blockList;if(this.config.enable_logsetting){var n=this.blockList,i=this.collect.configManager.getSettingData("blocklist_events")||[];e=n.concat(i.filter(function(t){return-1===n.indexOf(t)}))}return!(e&&e.length&&e.includes(t))}catch(t){return!0}},e.prototype.whiteEvent=function(t){var e;try{return(null===(e=this.whiteList)||void 0===e?!void 0:!e.length)||!!this.whiteList.includes(t)}catch(t){return!0}},e.prototype.send=function(t,e){var n=this;t.length&&t.forEach(function(t){try{var i=JSON.parse(JSON.stringify(t));n.config.filter&&((i=n.config.filter(i))||console.warn("filter must return data !!")),n.collect.eventFilter&&i&&((i=n.collect.eventFilter(i))||console.warn("filterEvent api must return data !!"));var o=i||t,r=JSON.parse(JSON.stringify(o));if(!o.length)return;var a=!0;if(o.forEach(function(t){t.events.length||(a=!1)}),!a)return;n.collect.emit(V.SubmitBefore,o);var s=n.collect.cryptoData(o);if(w())return void it(n.configManager.getUrl("img"),s);var c=l(n.collect.configManager.getSettingData("request_timeout"))?n.timeout:n.collect.configManager.getSettingData("request_timeout");n.collect.requestManager.useRequest({url:n.reportUrl,data:o,success:function(t,e){t&&0!==t.e?(n.collect.emit(V.SubmitError,{type:"f_data",eventData:e,errorCode:t.e,response:t}),n.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_EVENT,info:"埋点上报失败",time:Date.now(),data:r,code:t.e,failType:"数据异常失败",status:"fail"})):(n.collect.emit(V.SubmitScuess,{eventData:e,res:t}),n.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:r,code:200,status:"success"}),n.updateFilter(t))},fail:function(t,e){n.configManager.get("reportErrorCallback")(t,e),n.collect.emit(V.SubmitError,{type:"f_net",eventData:t,errorCode:e}),n.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_EVENT,info:"埋点上报网络异常",time:Date.now(),data:r,code:e,failType:"网络异常失败",status:"fail"})},timeout:c,useBeacon:e,encryption:n.config.enable_encryption,encryption_header:n.config.encryption_header,zip:!0}),n.collect.emit(V.SubmitVerifyH,o),n.collect.emit(V.SubmitAfter,o)}catch(t){console.warn("something error, ".concat(JSON.stringify(t.stack))),n.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK发送埋点发生了异常",level:"error",time:Date.now(),data:t.message,infoType:"sdk"})}})},e.prototype.updateFilter=function(t){var e,n;this.blockList=(null===(e=null==t?void 0:t.blocklist)||void 0===e?void 0:e.v3)||[],this.whiteList=(null===(n=null==t?void 0:t.whitelist)||void 0===n?void 0:n.v3)||[]},e}(),ct=function(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)}().replace(/-/g,"").slice(0,19)},ut=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enableTTwebid=!1,this.enableCustomWebid=!1,this.enableAnonymousid=!1}return e.prototype.apply=function(t,e){var n=this;this.collect=t,this.config=e,this.configManager=this.collect.configManager,this.storage=new B(!1),this.tokenKey="__tea_cache_tokens_".concat(e.app_id),this.enableAnonymousid=e.enable_anonymousid,this.enableTTwebid=e.enable_ttwebid,this.enableCustomWebid=e.enable_custom_webid,this.timeout=e.timeout||3e5,this.collect.on(V.AnonymousId,function(t){n.setAnonymousId(t)}),this.collect.on(V.ConfigUuid,function(t){n.setUuid(t)}),this.collect.on(V.ConfigWebId,function(t){n.setWebId(t)}),this.collect.on(V.BindToken,function(t){n.fetchBind(t)}),this.enableCookie=e.cross_subdomain,this.expiresTime=e.cookie_expire||6048e5,this.cookieDomain=e.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var t=this;if(this.enableCookie){var e=this.storage.getCookie(this.tokenKey,this.cookieDomain);this.cacheToken=e&&"string"==typeof e?JSON.parse(e):{}}else this.cacheToken=this.storage.getItem(this.tokenKey)||{};this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid||this.enableAnonymousid?this.enableAnonymousid?this.completeAnonymous(this.cacheToken):this.enableCustomWebid?this.collect.on(V.CustomWebId,function(){t.tokenReady=!0,t.collect.emit(V.TokenComplete)}):this.checkEnv()||(this.enableTTwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){if(this.cacheToken&&this.cacheToken.web_id)this.complete(this.cacheToken);else if(this.config.disable_webid){var t=this.getLocalId();this.complete({web_id:t,user_unique_id:this.configManager.get("user_unique_id")||t})}else this.remoteWebid()},e.prototype.checkEnv=function(){var t=window.navigator.userAgent;if(-1!==t.indexOf("miniProgram")||-1!==t.indexOf("MiniProgram")){var e=b(window.location.href);return!(!e||!e.Web_ID)&&(this.complete({web_id:"".concat(e.Web_ID),user_unique_id:this.configManager.get("user_unique_id")||"".concat(e.Web_ID)}),!0)}return!1},e.prototype.remoteWebid=function(){var t=this,e=this.configManager.getUrl("webid"),n={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 发起WEBID请求",logType:"fetch",level:"info",time:Date.now(),data:n});var i=this.collect.cryptoData(n);this.collect.requestManager.useRequest({url:e,data:i,success:function(e){var n;if(e&&0===e.e)n=e.web_id,t.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"WEBID请求成功",logType:"fetch",level:"info",time:Date.now(),data:e});else{var i=t.getLocalId();n=i,t.collect.configManager.set({localWebId:i}),t.collect.emit(V.TokenError),t.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"WEBID请求返回值异常",logType:"fetch",level:"warn",time:Date.now(),data:e}),t.collect.logger.warn("appid: ".concat(t.config.app_id," get webid error, use local webid~"))}t.complete({web_id:t.configManager.get("web_id")||n,user_unique_id:t.configManager.get("user_unique_id")||n})},fail:function(){var e=t.getLocalId();t.complete({web_id:t.configManager.get("web_id")||e,user_unique_id:t.configManager.get("user_unique_id")||e}),t.collect.configManager.set({localWebId:e}),t.collect.emit(V.TokenError),t.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"WEBID请求网络异常",logType:"fetch",level:"error",time:Date.now(),data:null}),t.collect.logger.warn("appid: ".concat(t.config.app_id,", get webid error, use local webid~"))},timeout:this.timeout,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header})},e.prototype.getLocalId=function(){for(var t=ct(),e=0;0===t.indexOf("0")||0===t.indexOf("9");){if(e>=10){t=t.replace(/^(0|9)/,"");break}t=ct(),e++}return t},e.prototype.complete=function(t){var e=t.web_id,n=t.user_unique_id;if(!e&&!n)return this.collect.emit(V.TokenError),void console.warn("token error");t.timestamp=Date.now(),0===e.indexOf("9")&&e.length>18?this.remoteWebid():(this.collect.configManager.set({web_id:e,user_unique_id:n}),this.setStorage(t),this.tokenReady=!0,this.collect.emit(V.TokenComplete))},e.prototype.completeAnonymous=function(t){var e=t.anonymous_id||ot(),n=t.user_unique_id||this.configManager.get("user_unique_id");this.collect.configManager.set({anonymous_id:e,user_unique_id:n||e}),t.anonymous_id=e,t.user_unique_id=n||e,this.setStorage(t),this.tokenReady=!0,this.collect.emit(V.TokenComplete)},e.prototype.completeTtWid=function(t){var e=t.user_unique_id||"",n=this.configManager.get("user_unique_id");this.configManager.set({user_unique_id:n||e}),this.setStorage(t),this.tokenReady=!0,this.collect.emit(V.TokenComplete)},e.prototype.setUuid=function(t){if(t&&-1===["null","undefined","Null","None"].indexOf(t)){var e=String(t),n=this.configManager.get("user_unique_id"),i=this.cacheToken&&this.cacheToken.user_unique_id;if(e===n&&e===i)return;this.configManager.set({user_unique_id:e}),this.cacheToken?this.cacheToken.user_unique_id=e:(this.cacheToken={},this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(V.TokenChange,{type:"uuid",id:t}),this.collect.emit(V.ProfileClear),this.collect.emit(V.SessionReset)}else this.clearUuid()},e.prototype.clearUuid=function(){if(!this.config.enable_ttwebid){var t=this.enableAnonymousid?this.configManager.get("anonymous_id"):this.configManager.get("web_id");this.configManager.get("user_unique_id")!==t&&(this.configManager.set({user_unique_id:t}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(V.ProfileClear),this.collect.emit(V.TokenReset))}},e.prototype.setAnonymousId=function(t){if(t&&this.enableAnonymousid){var e=this.configManager.get("anonymous_id"),n=this.configManager.get("user_unique_id");e!==t&&(e!==n&&n||(this.configManager.set({user_unique_id:t}),this.cacheToken.user_unique_id=t,this.collect.emit(V.TokenChange,{type:"uuid",id:t})),this.configManager.set({anonymous_id:t}),this.cacheToken.anonymous_id=t,this.collect.emit(V.TokenChange,{type:"anonymous_id",id:t}),this.setStorage(this.cacheToken))}},e.prototype.setWebId=function(t){if(t&&!this.config.enable_ttwebid&&!this.enableAnonymousid){var e=this.configManager.get("web_id"),n=this.configManager.get("user_unique_id");n&&n!==e||(this.configManager.set({user_unique_id:t}),this.cacheToken.user_unique_id=t,this.collect.emit(V.TokenChange,{type:"uuid",id:t})),e!==t&&(this.configManager.set({web_id:t}),this.cacheToken.web_id=t,this.collect.emit(V.ProfileClear),this.collect.emit(V.TokenChange,{type:"webid",id:t})),this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)}},e.prototype.setStorage=function(t){t._type_=this.enableCustomWebid?"custom":"default",delete t["diss".split("").reverse().join("")],this.enableCookie||this.enableTTwebid?this.storage.setCookie(this.tokenKey,t,this.expiresTime,this.cookieDomain):this.storage.setItem(this.tokenKey,t),this.cacheToken=t},e.prototype.getReady=function(){return this.tokenReady},e.prototype.getTobId=function(t){var e=this,n={app_id:this.config.app_id,user_unique_id:this.configManager.get("user_unique_id"),user_unique_id_type:this.configManager.get("user_unique_id_type")};this.enableAnonymousid?n.anonymous_id=this.configManager.get("anonymous_id"):n.web_id=this.configManager.get("web_id");var i=this.collect.cryptoData(n);this.collect.requestManager.useRequest({url:this.configManager.getUrl("tobid"),data:i,success:function(n){n&&0===n.e?(t(n.tobid),e.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"GetToken请求成功",logType:"fetch",level:"info",time:Date.now(),data:n,infoType:"sdk"})):(t(""),e.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"GetToken请求失败",logType:"fetch",level:"error",time:Date.now(),data:n,infoType:"sdk"}))},fail:function(){t(""),e.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"GetToken请求失败",logType:"fetch",level:"error",time:Date.now(),infoType:"sdk"})},time:this.timeout,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header})},e.prototype.fetchBind=function(e){var n=this,i=e.params,o=e.callback,r=this.configManager.getUrl("bind"),a={header:{aid:this.configManager.get("app_id"),identities:t({},i)}};this.collect.requestManager.useRequest({url:r,data:a,success:function(t){o(t),n.collect.sdkStop=!1,n.collect.emit(V.BindTokenReady)},fail:function(t){o(t),n.collect.sdkStop=!1,n.collect.emit(V.BindTokenReady)},time:3e4,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header})},e}(),lt=function(){return!(!window.navigator||!window.navigator.sendBeacon)},ht=function(){function t(t,e){var n=this;this.collector=t,this.config=e,this.requestType=e.request_type||"xhr",this.supportBeacon=lt(),this.errorCode={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005},this.customHeader=e.custom_request_header||{},this.collector.on("custom-request-header",function(t){n.setRequestHeader(t)})}return t.prototype.setRequestHeader=function(t){this.customHeader=Object.assign(this.customHeader,t)},t.prototype.useFetch=function(t){var e=t.url,n=t.data,i=t.method,o=t.success,r=t.fail,a={"Content-Type":"application/json; charset=utf-8"};if(Object.keys(this.customHeader).length)for(var s in this.customHeader)a[s]=this.customHeader[s];window.fetch?fetch(e,{method:i||"POST",headers:a,body:JSON.stringify(n)}).then(function(t){return t.json()}).then(function(t){o&&o(t)}).catch(function(t){r&&r(n,t)}):(this.requestType="xhr",console.log("your brwoser not support fetch, use xhr"),this.useRequest({url:e,data:n,method:i,success:o,fail:r}))},t.prototype.useBeacon=function(t){var e=t.url,n=t.data,i=t.success,o=t.fail;window.navigator.sendBeacon(e,JSON.stringify(n))?i&&i():o&&o(n,this.errorCode.BEACON_FALSE)},t.prototype.useRequest=function(t){var e=this,n=t.url,i=t.data,o=t.method,r=t.success,a=t.fail,s=t.timeout,c=t.useBeacon,u=t.withCredentials,l=t.app_key,h=t.forceXhr,f=t.encryption,p=t.encryption_header,d=t.status;t.zip;if(c&&this.supportBeacon)this.useBeacon({url:n,data:i,method:o,success:r,fail:a});else if("fetch"!==this.requestType||h)try{var g=null;if(window.XDomainRequest&&T()){g=new XDomainRequest;var v=o||"post";g.open(v,n),s&&(g.timeout=s,g.ontimeout=function(){a&&a(i,e.errorCode.TIMEOUT)}),g.onerror=function(){g.abort(),a&&a(i,e.errorCode.XHR_ON)},g.onload=function(){if(r){var t=null;if(g.responseText){try{t=JSON.parse(g.responseText)}catch(e){t={}}r(t,i)}}},setTimeout(function(){f?g.send(i):g.send(JSON.stringify(i))},0)}else if(window.ActiveXObject&&k()){g=new ActiveXObject("Micrsorf.XMLHTTP");v=o||"POST";g.open(v,n),s&&(g.timeout=s,g.ontimeout=function(){a&&a(i,e.errorCode.TIMEOUT)}),g.onerror=function(){g.abort(),a&&a(i,e.errorCode.XHR_ON)},g.onload=function(){if(r){var t=null;if(g.responseText){try{t=JSON.parse(g.responseText)}catch(e){t={}}r(t,i)}}},setTimeout(function(){g.send(JSON.stringify(i))},0)}else if(window.XMLHttpRequest){g=new XMLHttpRequest;v=o||"POST";if(g.open(v,"".concat(n),!0),f&&p&&!S()?g.setRequestHeader("Content-Type","application/octet-stream;tt-data=".concat(p)):g.setRequestHeader("Content-Type","application/json; charset=utf-8"),l&&g.setRequestHeader("X-MCS-AppKey","".concat(l)),Object.keys(this.customHeader).length)for(var m in this.customHeader)g.setRequestHeader(m,this.customHeader[m]);u&&(g.withCredentials=!0),s&&(g.timeout=s,g.ontimeout=function(){a&&a(i,e.errorCode.TIMEOUT)}),g.onload=function(){if(r){var t=null;if(g.responseText){try{t=JSON.parse(g.responseText)}catch(e){t={}}r(t,i,d),e.collector.emit("http-ok",{data:i,status:d})}}},g.onerror=function(){a&&a(i,e.errorCode.XHR_ON),e.collector.emit("http-error",{data:i,status:d}),g.abort()},f&&!S()?g.send(i):g.send(JSON.stringify(i))}}catch(t){this.collector.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK useRequest 发送请求发生了一些问题",level:"error",time:Date.now(),data:t.message,infoType:"sdk"})}else this.useFetch({url:n,data:i,method:o,success:r,fail:a})},t}(),ft=function(){function e(){}return e.prototype.apply=function(t,e){var n=this;if(!w()){this.collect=t,this.config=e,this.duration=6e4,this.reportUrl="".concat(t.configManager.getDomain(),"/profile/list");var i=t.Types,o=t.adapters.fetch;this.fetch=o,this.cache={},this.collect.on(i.ProfileSet,function(t){n.setProfile(t)}),this.collect.on(i.ProfileSetOnce,function(t){n.setOnceProfile(t)}),this.collect.on(i.ProfileUnset,function(t){n.unsetProfile(t)}),this.collect.on(i.ProfileIncrement,function(t){n.incrementProfile(t)}),this.collect.on(i.ProfileAppend,function(t){n.appendProfile(t)}),this.collect.on(i.ProfileClear,function(){n.cache={}}),this.ready(i.Profile)}},e.prototype.ready=function(t){var e=this;if(this.collect.set(t),this.collect.hook._hooksCache.hasOwnProperty(t)){var n=this.collect.hook._hooksCache[t];if(!Object.keys(n).length)return;var i=function(t){n[t].length&&n[t].forEach(function(n){e.collect.hook.emit(t,n)})};for(var o in n)i(o)}},e.prototype.report=function(t,e){void 0===e&&(e={});try{if(this.config.disable_track_event)return;if(this.collect.sdkStop)return;var n=[];n.push(this.collect.processEvent(t,e));var i=this.collect.eventManager.merge(n,!0),o=this.collect.cryptoData(i);this.collect.configManager.getUrl("profile");this.collect.requestManager.useRequest({url:this.reportUrl,data:o,timeout:1e5,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header,zip:!0}),this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_EVENT,info:"profile 埋点上报成功",time:Date.now(),data:i,code:200,status:"success"})}catch(t){this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"profile report 发生了异常",level:"error",time:Date.now(),data:t.message,infoType:"sdk"})}},e.prototype.setProfile=function(e){var n=this.formatParams(e);n&&Object.keys(n).length&&(this.pushCache(n),this.report("__profile_set",t(t({},n),{profile:!0})))},e.prototype.setOnceProfile=function(e){var n=this.formatParams(e,!0);n&&Object.keys(n).length&&(this.pushCache(n),this.report("__profile_set_once",t(t({},n),{profile:!0})))},e.prototype.incrementProfile=function(e){e?this.report("__profile_increment",t(t({},e),{profile:!0})):console.warn("please check the params, must be object!!!")},e.prototype.unsetProfile=function(e){if(e){var n={};n[e]="1",this.report("__profile_unset",t(t({},n),{profile:!0}))}else console.warn("please check the key, must be string!!!")},e.prototype.appendProfile=function(e){if(e){var n={};for(var i in e)"string"==typeof e[i]||"Array"===Object.prototype.toString.call(e[i]).slice(8,-1)?n[i]=e[i]:console.warn("please check the value of param: ".concat(i,", must be string or array !!!"));Object.keys(n).length&&this.report("__profile_append",t(t({},n),{profile:!0}))}else console.warn("please check the params, must be object!!!")},e.prototype.pushCache=function(t){var e=this;Object.keys(t).forEach(function(n){e.cache[n]={val:e.clone(t[n]),timestamp:Date.now()}})},e.prototype.formatParams=function(t,e){var n=this;void 0===e&&(e=!1);try{if(!t||"[object Object]"!==Object.prototype.toString.call(t))return void console.warn("please check the params type, must be object !!!");var i={};for(var o in t)"string"==typeof t[o]||"number"==typeof t[o]||"Array"===Object.prototype.toString.call(t[o]).slice(8,-1)?i[o]=t[o]:console.warn("please check the value of params:".concat(o,", must be string,number,Array !!!"));var r=Object.keys(i);if(!r.length)return;var a=Date.now();return r.filter(function(i){var o=n.cache[i];return e?!o:!(o&&n.compare(o.val,t[i])&&a-o.timestamp<n.duration)}).reduce(function(t,e){return t[e]=i[e],t},{})}catch(t){this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),console.log("error")}},e.prototype.compare=function(t,e){try{return JSON.stringify(t)===JSON.stringify(e)}catch(t){return this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),!1}},e.prototype.clone=function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),t}},e.prototype.unReady=function(){console.warn("sdk is not ready, please use this api after start")},e}(),pt=function(){function t(){this.setUrl="/service/2/log_settings",this.expire=216e5}return t.prototype.apply=function(t,e){if(e.enable_logsetting){this.collect=t,this.config=e;var n=t.adapters.storage;this.setKey="__applog_web_logsetting_".concat(e.app_id),this.cacheStorgae=new n(!1),this.check()}else t.emit(V.LogSettingReady)},t.prototype.check=function(){var t=this.getLocalData();t&&Object.keys(t).length?(null==t?void 0:t.timestamp)<Date.now()-this.expire?this.setting():(this.setLocalData(t),this.setting(!0)):this.setting()},t.prototype.setting=function(t){var e=this;t?this.collect.emit(V.LogSettingReady):this.collect.requestManager.useRequest({url:"".concat(this.collect.configManager.getDomain()).concat(this.setUrl),data:{magic_tag:"ss_app_log",header:{aid:this.config.app_id,platform:"web"}},timeout:3e4,success:function(t){(null==t?void 0:t.config)&&e.setLocalData(t.config),e.collect.emit(V.LogSettingReady)},fail:function(){e.collect.emit(V.LogSettingReady)},encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header})},t.prototype.getLocalData=function(){return this.cacheStorgae.getItem(this.setKey)},t.prototype.setLocalData=function(t){this.collect.configManager.setSettingData(t),this.cacheStorgae.setItem(this.setKey,t)},t}(),dt=function(){function t(t,e){var n=this,i=t.Types;this.collector=t,this.config=e,this.Types=i,this.configCache=[],this.eventCache=[],this.beaconEventCache=[],t.once(i.CloudReady,function(t){n.tracerInit(t)}),t.on(i.ConfigTransform,function(t){n.tracerConfig(t)}),t.on(i.Event,function(t){try{n.tracerEvent(JSON.parse(JSON.stringify(t)))}catch(t){}}),t.on(i.BeconEvent,function(t){try{n.tracerBeacon(JSON.parse(JSON.stringify(t)))}catch(t){}})}return t.prototype.tracerInit=function(t){var e=this;try{if(!this.config.tracer_appId||!this.config.tracer_domain)return void console.warn("miss tracer_appId or tracer_domain, please check.");this.tracer=new ye("tracer_cloud"),this.tracer.init({app_id:this.config.tracer_appId,channel_domain:this.config.tracer_domain,log:!0,disable_heartbeat:!0,disable_sdk_monitor:!0,disable_auto_pv:!0}),this.configCache.length&&(this.configCache.forEach(function(t){e.tracerConfig(t)}),this.configCache=[]),this.tracer.once(this.Types.Ready,function(n){var i,o;if((e.eventCache.length||e.beaconEventCache.length)&&(e.eventCache.forEach(function(t){e.tracerEvent(t)}),e.beaconEventCache.forEach(function(t){e.tracerBeacon(t)}),e.eventCache=[],e.beaconEventCache=[]),2===(null===(o=null===(i=e.config)||void 0===i?void 0:i.tracer_bind)||void 0===o?void 0:o.length)){var r=t.userInfo.web_id,a=n.userInfo.web_id,s=e.config.tracer_bind,c={};c["".concat(s[0])]=r,c["".concat(s[1])]=a,e.collector.bindToken(c,function(){})}}),this.tracer.start()}catch(t){console.warn("tracer saas instance初始化异常，msg: ".concat(JSON.stringify(t.message)))}},t.prototype.tracerConfig=function(t){this.tracer?this.tracer.config(t):this.configCache.push(t)},t.prototype.tracerEvent=function(t){this.tracer?this.tracer.eventManager.event(t):this.eventCache.push(t)},t.prototype.tracerBeacon=function(t){this.tracer?this.tracer.eventManager.beaconEvent(t):this.beaconEventCache.push(t)},t}(),gt={autotrack:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/route.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},tracer:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"}},vt=function(){return"undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null},mt=vt(),yt=function(){function t(){}return t.prototype.apply=function(t,e){this._plugin={},this.config=e,this.collect=t,this.channel=e.channel||"cn",this.loadExtend()},t.prototype.loadExtend=function(){var t=this;try{this.collect.remotePlugin.forEach(function(e,n){if("sdk"===e)if(gt.hasOwnProperty(n)){var i=gt[n].object,o="".concat(gt[n].src[t.channel],"?query=").concat(Date.now());t.exist(n,i,o)}else console.warn("your ".concat(n," is not exist，please check plugin name"));else"object"==typeof e&&(e.src?t.exist(n,e.call,e.src):t.process(n,e.instance,"INSTANCE"))})}catch(t){this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),console.log("load extend error")}},t.prototype.exist=function(t,e,n){var i=this;mt[e]?this.process(t,mt[e]):this.loadPlugin(t,n,function(){i.process(t,mt[e]),console.log(" %c %s %s %s","color: yellow; background-color: black;","–","load plugin:".concat(t," success"),"-")},function(){console.log(" %c %s %s %s","color: red; background-color: yellow;","–","load plugin:".concat(t," error"),"-")})},t.prototype.process=function(t,e,n){try{if(n){var i=new e;i.apply&&i.apply(this.collect,this.config),console.log("excude ".concat(t," success"))}else e&&e(this.collect,this.config)}catch(e){this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),console.log("excude ".concat(t," error, message:").concat(e.message))}},t.prototype.loadPlugin=function(t,e,n,i){var o=this;try{var r=document.createElement("script");r.src=e,this._plugin[t]||(this._plugin[t]=[]),this._plugin[t].push(n),r.onerror=function(){i(e)},r.onload=function(){o._plugin[t].forEach(function(t){t()})},document.getElementsByTagName("head")[0].appendChild(r)}catch(t){this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t}(),_t=function(){function t(t,e){if(this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,e.enable_debug&&"Microsoft Internet Explorer"!==t.configManager.get("browser")){this.collect=t,this.config=e,this.app_id=e.app_id;var n=t.adapters.storage;this.cacheStorgae=new n(!1),this.loadUrl=e.devtool_url||"https://lf-static.applogcdn.com/obj/applog-sdk-static/log-sdk/collect/devtool/debug-web.v2.0.0.js",this.filterEvent=new Set(["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"]),this.load()}}return t.prototype.loadScript=function(t){try{var e=document.createElement("script");e.src=t,e.onerror=function(){console.log("load DevTool render fail")},e.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(e)}catch(t){console.log("devTool load fail, ".concat(t.message))}},t.prototype.parseUrl=function(){var t={};try{var e=window.location.href.split("?")[1].split("&");e.length&&e.forEach(function(e){var n=e.split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])})}catch(t){}return t},t.prototype.load=function(){try{this.loadBaseInfo(),this.loadHook(),this.setStorage(),this.addLintener(),this.loadDebuggerModule(),this.loadDevTool()}catch(t){console.log("debug fail, ".concat(t.message))}},t.prototype.getStorage=function(){var t=this.cacheStorgae.getItem("__applog_open_devtool_web");return t&&parseInt(t)===this.app_id},t.prototype.setStorage=function(){this.cacheStorgae.setItem("__applog_open_devtool_web",this.app_id)},t.prototype.loadDevTool=function(){this.loadScript(this.loadUrl)},t.prototype.loadBaseInfo=function(){if(this.log=[],this.event=[],this.info=[{title:"基本信息",key:"base",type:1,content:[{name:"app_id",desc:"APP_ID",value:this.config.app_id},{name:"channel",desc:"CHANNEL",value:this.config.channel},{name:"domain",desc:"上报域名",value:this.collect.configManager.getDomain()},{name:"sdk_version",desc:"SDK版本",value:L},{name:"sdk_type",desc:"SDK引入方式",value:"script"}]},{title:"用户信息",key:"user",type:2,content:[{name:"uuid",desc:"UUID",value:this.collect.configManager.get("user").user_unique_id||""},{name:"web_id",desc:"WEB_ID",value:this.collect.configManager.get("user").web_id||""}]},{title:"公共参数信息",type:2,key:"common",content:[{name:"browser",desc:"浏览器",value:this.collect.configManager.get("browser")},{name:"browser_version",desc:"浏览器版本",value:this.collect.configManager.get("browser_version")},{name:"platform",desc:"平台",value:this.collect.configManager.get("platform")},{name:"device_model",desc:"设备型号",value:this.collect.configManager.get("device_model")},{name:"os_name",desc:"操作系统",value:this.collect.configManager.get("os_name")},{name:"os_version",desc:"操作系统版本",value:this.collect.configManager.get("os_version")},{name:"resolution",desc:"屏幕分辨率",value:this.collect.configManager.get("resolution")},{name:"referrer",desc:"来源",value:this.collect.configManager.get("referrer")},{name:"custom",desc:"自定义信息",value:JSON.stringify(this.collect.configManager.get("custom"))}]},{title:"配置信息",key:"config",type:3,content:[{name:"autotrack",desc:"全埋点",value:!!this.config.autotrack},{name:"stay",desc:"停留时长",value:!!this.config.enable_stay_duration}]},{title:"A/B配置信息",key:"ab",type:4,content:[{name:"ab",desc:"A/B实验",value:!!this.config.enable_ab_test}]}],this.config.enable_ab_test){var t=this.getInfo("ab"),e=[{name:"ab",desc:"A/B实验",value:!!this.config.enable_ab_test},{name:"vid",desc:"已曝光VID",value:this.collect.configManager.getAbVersion()},{name:"ab_domain",desc:"A/B域名",value:this.config.ab_channel_domain||d(z[this.config.channel])},{name:"all_values",desc:"全部配置",value:this.collect.configManager.getAbCache()}];t.content=e,this.setInfo("ab",t)}if(this.config.enable_native||this.config.Native){var n={title:"客户端信息",type:3,content:[{name:"native",desc:"是否打通",value:!!this.collect.bridgeReport}]};this.setInfo("native",n)}if(L.includes("tob")){var i=this.getInfo("user");i.content.push({name:"sid",desc:"DISS".split("").reverse().join(""),value:"点击获取"}),this.setInfo("user",i)}},t.prototype.getInfo=function(t){var e=null;return this.info.forEach(function(n){n.key===t&&(e=n)}),e},t.prototype.setInfo=function(t,e){var n=!1;this.info.forEach(function(i){i.key===t&&(n=!0,i=e)}),n||this.info.push(e)},t.prototype.getSecondInfo=function(t,e){var n=this.getInfo(t),i=null;return n.content.forEach(function(t){t.name===e&&(i=t)}),i},t.prototype.setSecondInfo=function(t,e,n){var i=this.getInfo(t),o=!1;if(i.content.forEach(function(t){t.name===e&&(t.value=n,o=!0)}),!o){var r={name:e,value:n,desc:e.toLocaleUpperCase()};i.content.push(r)}this.setInfo(t,i)},t.prototype.loadHook=function(){var t=this;this.collect.on(U.DEBUGGER_MESSAGE,function(e){switch(e.type){case U.DEBUGGER_MESSAGE_SDK:var n={time:e.time,type:e.logType||"sdk",infoType:e.infoType||"sdk",level:e.level,name:e.info,show:!0,levelShow:!0,needDesc:!!e.data};if(e.data&&(n.desc={content:JSON.stringify(e.data)}),t.updateLog(n),e.secType&&"AB"===e.secType)t.setSecondInfo("ab","vid",t.collect.configManager.getAbVersion()),t.setSecondInfo("ab","all_values",t.collect.configManager.getAbCache());else if("USER"===e.secType)t.setSecondInfo("user","user_unique_id"===e.common?"uuid":e.common,t.collect.configManager.get(e.common));else if("HEADER"===e.secType){var i=t.collect.configManager.get(e.common);t.setSecondInfo("common",e.common,"custom"===e.common?JSON.stringify(i):i)}return void t.updateInfo();case U.DEBUGGER_MESSAGE_EVENT:if(e.data&&e.data.length){var o=e.data[0],r=o.events;if(!r.length)return;r.forEach(function(n){n.checkShow=!0,n.searchShow=!0,n.focusShow=!0,n.status=e.status,n.type=t.filterEvent.has(n.event)?"sdk":"cus",n.verifyType=e.verifyType?"verify":"no",n.info="","fail"===e.status&&(n.info={message:"code: ".concat(e.code,"， msg: ").concat(e.msg||e.failType)})}),t.updateEvent(o)}return}})},t.prototype.addLintener=function(){var t=this;window.addEventListener("message",function(e){if(e&&e.data&&"devtool:web:ready"===e.data.type){if(t.devToolOrigin=e.origin,t.devToolReady=!0,t.sendAlready)return;t.sendData("devtool:web:init",{info:t.info,log:t.log,event:t.event,sdk_type:L.includes("tob")?"tob":"inner",appId:t.app_id}),t.sendAlready=!0}e&&e.data&&"devtool:web:ssid"===e.data.type&&t.collect.getToken(function(e){t.setSecondInfo("user","sid",e.tobid),t.updateInfo()})})},t.prototype.sendData=function(t,e){try{var n={type:t,payload:e};window&&window.postMessage(n,this.devToolOrigin)}catch(t){}},t.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},t.prototype.updateLog=function(t){this.devToolReady?this.sendData("devtool:web:log",t):this.log.push(t)},t.prototype.updateEvent=function(t){this.devToolReady?this.sendData("devtool:web:event",t):this.event.push(t)},t.prototype.loadDebuggerModule=function(){var t="#debugger-applog-web {\n      position: fixed;\n      width: 45px;\n      height: 45px;\n      background-image: url(".concat(d("1fz22z22z1nz21z4mz4bz4bz1jz1dz49z1az1bz1lz49z22z1mz21z4az19z27z22z1cz21z1az1kz4az1az1mz1kz4bz1mz19z1hz4bz21z22z18z22z1gz1az4bz1jz1mz1ez49z21z1bz1iz4bz1az1mz1jz1jz1cz1az22z4bz1bz1cz24z22z1mz1mz1jz4bz18z1nz1nz1jz1mz1ez4az1nz1lz1e"),");\n      bottom: 5%;\n      right: 10%;\n      cursor: pointer;\n      z-index:100;\n      background-size: 45px;\n    }"),e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.appendChild(document.createTextNode(t)),e.appendChild(n);var i=document.createElement("div");i.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web"></div>';var o=document.createElement("div");o.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(i),document.getElementsByTagName("body")[0].appendChild(o);var r=document.getElementById("debugger-applog-web");r&&r.addEventListener("click",function(){window&&window.postMessage({type:"devtool:web:open-draw"},location.origin)})},t}(),bt=O(function(t,e){(function(){var e;function n(t,e,n){null!=t&&("number"==typeof t?this.fromNumber(t,e,n):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function i(){return new n(null)}var o="undefined"!=typeof navigator;o&&"Microsoft Internet Explorer"==navigator.appName?(n.prototype.am=function(t,e,n,i,o,r){for(var a=32767&e,s=e>>15;--r>=0;){var c=32767&this[t],u=this[t++]>>15,l=s*c+u*a;o=((c=a*c+((32767&l)<<15)+n[i]+(1073741823&o))>>>30)+(l>>>15)+s*u+(o>>>30),n[i++]=1073741823&c}return o},e=30):o&&"Netscape"!=navigator.appName?(n.prototype.am=function(t,e,n,i,o,r){for(;--r>=0;){var a=e*this[t++]+n[i]+o;o=Math.floor(a/67108864),n[i++]=67108863&a}return o},e=26):(n.prototype.am=function(t,e,n,i,o,r){for(var a=16383&e,s=e>>14;--r>=0;){var c=16383&this[t],u=this[t++]>>14,l=s*c+u*a;o=((c=a*c+((16383&l)<<14)+n[i]+o)>>28)+(l>>14)+s*u,n[i++]=268435455&c}return o},e=28),n.prototype.DB=e,n.prototype.DM=(1<<e)-1,n.prototype.DV=1<<e;n.prototype.FV=Math.pow(2,52),n.prototype.F1=52-e,n.prototype.F2=2*e-52;var r,a,s="0123456789abcdefghijklmnopqrstuvwxyz",c=new Array;for(r="0".charCodeAt(0),a=0;a<=9;++a)c[r++]=a;for(r="a".charCodeAt(0),a=10;a<36;++a)c[r++]=a;for(r="A".charCodeAt(0),a=10;a<36;++a)c[r++]=a;function u(t){return s.charAt(t)}function l(t,e){var n=c[t.charCodeAt(e)];return null==n?-1:n}function h(t){var e=i();return e.fromInt(t),e}function f(t){var e,n=1;return 0!=(e=t>>>16)&&(t=e,n+=16),0!=(e=t>>8)&&(t=e,n+=8),0!=(e=t>>4)&&(t=e,n+=4),0!=(e=t>>2)&&(t=e,n+=2),0!=(e=t>>1)&&(t=e,n+=1),n}function p(t){this.m=t}function d(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function g(t,e){return t&e}function v(t,e){return t|e}function m(t,e){return t^e}function y(t,e){return t&~e}function _(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function b(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function E(){}function S(t){return t}function w(t){this.r2=i(),this.q3=i(),n.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}p.prototype.convert=function(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t},p.prototype.revert=function(t){return t},p.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},p.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},p.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},d.prototype.convert=function(t){var e=i();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(n.ZERO)>0&&this.m.subTo(e,e),e},d.prototype.revert=function(t){var e=i();return t.copyTo(e),this.reduce(e),e},d.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var n=32767&t[e],i=n*this.mpl+((n*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[n=e+this.m.t]+=this.m.am(0,i,t,e,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)},d.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},d.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},n.prototype.copyTo=function(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s},n.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},n.prototype.fromString=function(t,e){var i;if(16==e)i=4;else if(8==e)i=3;else if(256==e)i=8;else if(2==e)i=1;else if(32==e)i=5;else{if(4!=e)return void this.fromRadix(t,e);i=2}this.t=0,this.s=0;for(var o=t.length,r=!1,a=0;--o>=0;){var s=8==i?255&t[o]:l(t,o);s<0?"-"==t.charAt(o)&&(r=!0):(r=!1,0==a?this[this.t++]=s:a+i>this.DB?(this[this.t-1]|=(s&(1<<this.DB-a)-1)<<a,this[this.t++]=s>>this.DB-a):this[this.t-1]|=s<<a,(a+=i)>=this.DB&&(a-=this.DB))}8==i&&0!=(128&t[0])&&(this.s=-1,a>0&&(this[this.t-1]|=(1<<this.DB-a)-1<<a)),this.clamp(),r&&n.ZERO.subTo(this,this)},n.prototype.clamp=function(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t},n.prototype.dlShiftTo=function(t,e){var n;for(n=this.t-1;n>=0;--n)e[n+t]=this[n];for(n=t-1;n>=0;--n)e[n]=0;e.t=this.t+t,e.s=this.s},n.prototype.drShiftTo=function(t,e){for(var n=t;n<this.t;++n)e[n-t]=this[n];e.t=Math.max(this.t-t,0),e.s=this.s},n.prototype.lShiftTo=function(t,e){var n,i=t%this.DB,o=this.DB-i,r=(1<<o)-1,a=Math.floor(t/this.DB),s=this.s<<i&this.DM;for(n=this.t-1;n>=0;--n)e[n+a+1]=this[n]>>o|s,s=(this[n]&r)<<i;for(n=a-1;n>=0;--n)e[n]=0;e[a]=s,e.t=this.t+a+1,e.s=this.s,e.clamp()},n.prototype.rShiftTo=function(t,e){e.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t)e.t=0;else{var i=t%this.DB,o=this.DB-i,r=(1<<i)-1;e[0]=this[n]>>i;for(var a=n+1;a<this.t;++a)e[a-n-1]|=(this[a]&r)<<o,e[a-n]=this[a]>>i;i>0&&(e[this.t-n-1]|=(this.s&r)<<o),e.t=this.t-n,e.clamp()}},n.prototype.subTo=function(t,e){for(var n=0,i=0,o=Math.min(t.t,this.t);n<o;)i+=this[n]-t[n],e[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i-=t.s;n<this.t;)i+=this[n],e[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i-=t[n],e[n++]=i&this.DM,i>>=this.DB;i-=t.s}e.s=i<0?-1:0,i<-1?e[n++]=this.DV+i:i>0&&(e[n++]=i),e.t=n,e.clamp()},n.prototype.multiplyTo=function(t,e){var i=this.abs(),o=t.abs(),r=i.t;for(e.t=r+o.t;--r>=0;)e[r]=0;for(r=0;r<o.t;++r)e[r+i.t]=i.am(0,o[r],e,r,0,i.t);e.s=0,e.clamp(),this.s!=t.s&&n.ZERO.subTo(e,e)},n.prototype.squareTo=function(t){for(var e=this.abs(),n=t.t=2*e.t;--n>=0;)t[n]=0;for(n=0;n<e.t-1;++n){var i=e.am(n,e[n],t,2*n,0,1);(t[n+e.t]+=e.am(n+1,2*e[n],t,2*n+1,i,e.t-n-1))>=e.DV&&(t[n+e.t]-=e.DV,t[n+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(n,e[n],t,2*n,0,1)),t.s=0,t.clamp()},n.prototype.divRemTo=function(t,e,o){var r=t.abs();if(!(r.t<=0)){var a=this.abs();if(a.t<r.t)return null!=e&&e.fromInt(0),void(null!=o&&this.copyTo(o));null==o&&(o=i());var s=i(),c=this.s,u=t.s,l=this.DB-f(r[r.t-1]);l>0?(r.lShiftTo(l,s),a.lShiftTo(l,o)):(r.copyTo(s),a.copyTo(o));var h=s.t,p=s[h-1];if(0!=p){var d=p*(1<<this.F1)+(h>1?s[h-2]>>this.F2:0),g=this.FV/d,v=(1<<this.F1)/d,m=1<<this.F2,y=o.t,_=y-h,b=null==e?i():e;for(s.dlShiftTo(_,b),o.compareTo(b)>=0&&(o[o.t++]=1,o.subTo(b,o)),n.ONE.dlShiftTo(h,b),b.subTo(s,s);s.t<h;)s[s.t++]=0;for(;--_>=0;){var E=o[--y]==p?this.DM:Math.floor(o[y]*g+(o[y-1]+m)*v);if((o[y]+=s.am(0,E,o,_,0,h))<E)for(s.dlShiftTo(_,b),o.subTo(b,o);o[y]<--E;)o.subTo(b,o)}null!=e&&(o.drShiftTo(h,e),c!=u&&n.ZERO.subTo(e,e)),o.t=h,o.clamp(),l>0&&o.rShiftTo(l,o),c<0&&n.ZERO.subTo(o,o)}}},n.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)>0?this.DV-e:-e},n.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},n.prototype.exp=function(t,e){if(t>4294967295||t<1)return n.ONE;var o=i(),r=i(),a=e.convert(this),s=f(t)-1;for(a.copyTo(o);--s>=0;)if(e.sqrTo(o,r),(t&1<<s)>0)e.mulTo(r,a,o);else{var c=o;o=r,r=c}return e.revert(o)},n.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var n,i=(1<<e)-1,o=!1,r="",a=this.t,s=this.DB-a*this.DB%e;if(a-- >0)for(s<this.DB&&(n=this[a]>>s)>0&&(o=!0,r=u(n));a>=0;)s<e?(n=(this[a]&(1<<s)-1)<<e-s,n|=this[--a]>>(s+=this.DB-e)):(n=this[a]>>(s-=e)&i,s<=0&&(s+=this.DB,--a)),n>0&&(o=!0),o&&(r+=u(n));return o?r:"0"},n.prototype.negate=function(){var t=i();return n.ZERO.subTo(this,t),t},n.prototype.abs=function(){return this.s<0?this.negate():this},n.prototype.compareTo=function(t){var e=this.s-t.s;if(0!=e)return e;var n=this.t;if(0!=(e=n-t.t))return this.s<0?-e:e;for(;--n>=0;)if(0!=(e=this[n]-t[n]))return e;return 0},n.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+f(this[this.t-1]^this.s&this.DM)},n.prototype.mod=function(t){var e=i();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(n.ZERO)>0&&t.subTo(e,e),e},n.prototype.modPowInt=function(t,e){var n;return n=t<256||e.isEven()?new p(e):new d(e),this.exp(t,n)},n.ZERO=h(0),n.ONE=h(1),E.prototype.convert=S,E.prototype.revert=S,E.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n)},E.prototype.sqrTo=function(t,e){t.squareTo(e)},w.prototype.convert=function(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=i();return t.copyTo(e),this.reduce(e),e},w.prototype.revert=function(t){return t},w.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)},w.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},w.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)};var T,k,D,A=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],I=(1<<26)/A[A.length-1];function O(){var t;t=(new Date).getTime(),k[D++]^=255&t,k[D++]^=t>>8&255,k[D++]^=t>>16&255,k[D++]^=t>>24&255,D>=N&&(D-=N)}if(n.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},n.prototype.toRadix=function(t){if(null==t&&(t=10),0==this.signum()||t<2||t>36)return"0";var e=this.chunkSize(t),n=Math.pow(t,e),o=h(n),r=i(),a=i(),s="";for(this.divRemTo(o,r,a);r.signum()>0;)s=(n+a.intValue()).toString(t).substr(1)+s,r.divRemTo(o,r,a);return a.intValue().toString(t)+s},n.prototype.fromRadix=function(t,e){this.fromInt(0),null==e&&(e=10);for(var i=this.chunkSize(e),o=Math.pow(e,i),r=!1,a=0,s=0,c=0;c<t.length;++c){var u=l(t,c);u<0?"-"==t.charAt(c)&&0==this.signum()&&(r=!0):(s=e*s+u,++a>=i&&(this.dMultiply(o),this.dAddOffset(s,0),a=0,s=0))}a>0&&(this.dMultiply(Math.pow(e,a)),this.dAddOffset(s,0)),r&&n.ZERO.subTo(this,this)},n.prototype.fromNumber=function(t,e,i){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,i),this.testBit(t-1)||this.bitwiseTo(n.ONE.shiftLeft(t-1),v,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(n.ONE.shiftLeft(t-1),this);else{var o=new Array,r=7&t;o.length=1+(t>>3),e.nextBytes(o),r>0?o[0]&=(1<<r)-1:o[0]=0,this.fromString(o,256)}},n.prototype.bitwiseTo=function(t,e,n){var i,o,r=Math.min(t.t,this.t);for(i=0;i<r;++i)n[i]=e(this[i],t[i]);if(t.t<this.t){for(o=t.s&this.DM,i=r;i<this.t;++i)n[i]=e(this[i],o);n.t=this.t}else{for(o=this.s&this.DM,i=r;i<t.t;++i)n[i]=e(o,t[i]);n.t=t.t}n.s=e(this.s,t.s),n.clamp()},n.prototype.changeBit=function(t,e){var i=n.ONE.shiftLeft(t);return this.bitwiseTo(i,e,i),i},n.prototype.addTo=function(t,e){for(var n=0,i=0,o=Math.min(t.t,this.t);n<o;)i+=this[n]+t[n],e[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i+=t.s;n<this.t;)i+=this[n],e[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i+=t[n],e[n++]=i&this.DM,i>>=this.DB;i+=t.s}e.s=i<0?-1:0,i>0?e[n++]=i:i<-1&&(e[n++]=this.DV+i),e.t=n,e.clamp()},n.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},n.prototype.dAddOffset=function(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}},n.prototype.multiplyLowerTo=function(t,e,n){var i,o=Math.min(this.t+t.t,e);for(n.s=0,n.t=o;o>0;)n[--o]=0;for(i=n.t-this.t;o<i;++o)n[o+this.t]=this.am(0,t[o],n,o,0,this.t);for(i=Math.min(t.t,e);o<i;++o)this.am(0,t[o],n,o,0,e-o);n.clamp()},n.prototype.multiplyUpperTo=function(t,e,n){--e;var i=n.t=this.t+t.t-e;for(n.s=0;--i>=0;)n[i]=0;for(i=Math.max(e-this.t,0);i<t.t;++i)n[this.t+i-e]=this.am(e-i,t[i],n,0,0,this.t+i-e);n.clamp(),n.drShiftTo(1,n)},n.prototype.modInt=function(t){if(t<=0)return 0;var e=this.DV%t,n=this.s<0?t-1:0;if(this.t>0)if(0==e)n=this[0]%t;else for(var i=this.t-1;i>=0;--i)n=(e*n+this[i])%t;return n},n.prototype.millerRabin=function(t){var e=this.subtract(n.ONE),o=e.getLowestSetBit();if(o<=0)return!1;var r=e.shiftRight(o);(t=t+1>>1)>A.length&&(t=A.length);for(var a=i(),s=0;s<t;++s){a.fromInt(A[Math.floor(Math.random()*A.length)]);var c=a.modPow(r,this);if(0!=c.compareTo(n.ONE)&&0!=c.compareTo(e)){for(var u=1;u++<o&&0!=c.compareTo(e);)if(0==(c=c.modPowInt(2,this)).compareTo(n.ONE))return!1;if(0!=c.compareTo(e))return!1}}return!0},n.prototype.clone=function(){var t=i();return this.copyTo(t),t},n.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},n.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},n.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},n.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},n.prototype.toByteArray=function(){var t=this.t,e=new Array;e[0]=this.s;var n,i=this.DB-t*this.DB%8,o=0;if(t-- >0)for(i<this.DB&&(n=this[t]>>i)!=(this.s&this.DM)>>i&&(e[o++]=n|this.s<<this.DB-i);t>=0;)i<8?(n=(this[t]&(1<<i)-1)<<8-i,n|=this[--t]>>(i+=this.DB-8)):(n=this[t]>>(i-=8)&255,i<=0&&(i+=this.DB,--t)),0!=(128&n)&&(n|=-256),0==o&&(128&this.s)!=(128&n)&&++o,(o>0||n!=this.s)&&(e[o++]=n);return e},n.prototype.equals=function(t){return 0==this.compareTo(t)},n.prototype.min=function(t){return this.compareTo(t)<0?this:t},n.prototype.max=function(t){return this.compareTo(t)>0?this:t},n.prototype.and=function(t){var e=i();return this.bitwiseTo(t,g,e),e},n.prototype.or=function(t){var e=i();return this.bitwiseTo(t,v,e),e},n.prototype.xor=function(t){var e=i();return this.bitwiseTo(t,m,e),e},n.prototype.andNot=function(t){var e=i();return this.bitwiseTo(t,y,e),e},n.prototype.not=function(){for(var t=i(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t},n.prototype.shiftLeft=function(t){var e=i();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e},n.prototype.shiftRight=function(t){var e=i();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e},n.prototype.getLowestSetBit=function(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+_(this[t]);return this.s<0?this.t*this.DB:-1},n.prototype.bitCount=function(){for(var t=0,e=this.s&this.DM,n=0;n<this.t;++n)t+=b(this[n]^e);return t},n.prototype.testBit=function(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)},n.prototype.setBit=function(t){return this.changeBit(t,v)},n.prototype.clearBit=function(t){return this.changeBit(t,y)},n.prototype.flipBit=function(t){return this.changeBit(t,m)},n.prototype.add=function(t){var e=i();return this.addTo(t,e),e},n.prototype.subtract=function(t){var e=i();return this.subTo(t,e),e},n.prototype.multiply=function(t){var e=i();return this.multiplyTo(t,e),e},n.prototype.divide=function(t){var e=i();return this.divRemTo(t,e,null),e},n.prototype.remainder=function(t){var e=i();return this.divRemTo(t,null,e),e},n.prototype.divideAndRemainder=function(t){var e=i(),n=i();return this.divRemTo(t,e,n),new Array(e,n)},n.prototype.modPow=function(t,e){var n,o,r=t.bitLength(),a=h(1);if(r<=0)return a;n=r<18?1:r<48?3:r<144?4:r<768?5:6,o=r<8?new p(e):e.isEven()?new w(e):new d(e);var s=new Array,c=3,u=n-1,l=(1<<n)-1;if(s[1]=o.convert(this),n>1){var g=i();for(o.sqrTo(s[1],g);c<=l;)s[c]=i(),o.mulTo(g,s[c-2],s[c]),c+=2}var v,m,y=t.t-1,_=!0,b=i();for(r=f(t[y])-1;y>=0;){for(r>=u?v=t[y]>>r-u&l:(v=(t[y]&(1<<r+1)-1)<<u-r,y>0&&(v|=t[y-1]>>this.DB+r-u)),c=n;0==(1&v);)v>>=1,--c;if((r-=c)<0&&(r+=this.DB,--y),_)s[v].copyTo(a),_=!1;else{for(;c>1;)o.sqrTo(a,b),o.sqrTo(b,a),c-=2;c>0?o.sqrTo(a,b):(m=a,a=b,b=m),o.mulTo(b,s[v],a)}for(;y>=0&&0==(t[y]&1<<r);)o.sqrTo(a,b),m=a,a=b,b=m,--r<0&&(r=this.DB-1,--y)}return o.revert(a)},n.prototype.modInverse=function(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return n.ZERO;for(var i=t.clone(),o=this.clone(),r=h(1),a=h(0),s=h(0),c=h(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),e?(r.isEven()&&a.isEven()||(r.addTo(this,r),a.subTo(t,a)),r.rShiftTo(1,r)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);for(;o.isEven();)o.rShiftTo(1,o),e?(s.isEven()&&c.isEven()||(s.addTo(this,s),c.subTo(t,c)),s.rShiftTo(1,s)):c.isEven()||c.subTo(t,c),c.rShiftTo(1,c);i.compareTo(o)>=0?(i.subTo(o,i),e&&r.subTo(s,r),a.subTo(c,a)):(o.subTo(i,o),e&&s.subTo(r,s),c.subTo(a,c))}return 0!=o.compareTo(n.ONE)?n.ZERO:c.compareTo(t)>=0?c.subtract(t):c.signum()<0?(c.addTo(t,c),c.signum()<0?c.add(t):c):c},n.prototype.pow=function(t){return this.exp(t,new E)},n.prototype.gcd=function(t){var e=this.s<0?this.negate():this.clone(),n=t.s<0?t.negate():t.clone();if(e.compareTo(n)<0){var i=e;e=n,n=i}var o=e.getLowestSetBit(),r=n.getLowestSetBit();if(r<0)return e;for(o<r&&(r=o),r>0&&(e.rShiftTo(r,e),n.rShiftTo(r,n));e.signum()>0;)(o=e.getLowestSetBit())>0&&e.rShiftTo(o,e),(o=n.getLowestSetBit())>0&&n.rShiftTo(o,n),e.compareTo(n)>=0?(e.subTo(n,e),e.rShiftTo(1,e)):(n.subTo(e,n),n.rShiftTo(1,n));return r>0&&n.lShiftTo(r,n),n},n.prototype.isProbablePrime=function(t){var e,n=this.abs();if(1==n.t&&n[0]<=A[A.length-1]){for(e=0;e<A.length;++e)if(n[0]==A[e])return!0;return!1}if(n.isEven())return!1;for(e=1;e<A.length;){for(var i=A[e],o=e+1;o<A.length&&i<I;)i*=A[o++];for(i=n.modInt(i);e<o;)if(i%A[e++]==0)return!1}return n.millerRabin(t)},n.prototype.square=function(){var t=i();return this.squareTo(t),t},n.prototype.Barrett=w,null==k){var x;if(k=new Array,D=0,"undefined"!=typeof window&&window.crypto)if(window.crypto.getRandomValues){var R=new Uint8Array(32);for(window.crypto.getRandomValues(R),x=0;x<32;++x)k[D++]=R[x]}else if("Netscape"==navigator.appName&&navigator.appVersion<"5"){var M=window.crypto.random(32);for(x=0;x<M.length;++x)k[D++]=255&M.charCodeAt(x)}for(;D<N;)x=Math.floor(65536*Math.random()),k[D++]=x>>>8,k[D++]=255&x;D=0,O()}function C(){if(null==T){for(O(),(T=new G).init(k),D=0;D<k.length;++D)k[D]=0;D=0}return T.next()}function B(){}function G(){this.i=0,this.j=0,this.S=new Array}B.prototype.nextBytes=function(t){var e;for(e=0;e<t.length;++e)t[e]=C()},G.prototype.init=function(t){var e,n,i;for(e=0;e<256;++e)this.S[e]=e;for(n=0,e=0;e<256;++e)n=n+this.S[e]+t[e%t.length]&255,i=this.S[e],this.S[e]=this.S[n],this.S[n]=i;this.i=0,this.j=0},G.prototype.next=function(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]};var N=256;t.exports={default:n,BigInteger:n,SecureRandom:B}}).call(A)});bt.BigInteger,bt.SecureRandom;function Et(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var St=bt.BigInteger;var wt=function(){function t(){this.tlv=null,this.t="00",this.l="00",this.v=""}var e=t.prototype;return e.getEncodedHex=function(){return this.tlv||(this.v=this.getValue(),this.l=this.getLength(),this.tlv=this.t+this.l+this.v),this.tlv},e.getLength=function(){var t=this.v.length/2,e=t.toString(16);return e.length%2==1&&(e="0"+e),t<128?e:(128+e.length/2).toString(16)+e},e.getValue=function(){return""},t}(),Tt=function(t){function e(e){var n;return(n=t.call(this)||this).t="02",e&&(n.v=function(t){var e=t.toString(16);if("-"!==e[0])e.length%2==1?e="0"+e:e.match(/^[0-7]/)||(e="00"+e);else{var n=(e=e.substr(1)).length;n%2==1?n+=1:e.match(/^[0-7]/)||(n+=2);for(var i="",o=0;o<n;o++)i+="f";e=(e=(i=new St(i,16)).xor(t).add(St.ONE)).toString(16).replace(/^-/,"")}return e}(e)),n}return Et(e,t),e.prototype.getValue=function(){return this.v},e}(wt),kt=function(t){function e(e){var n;return(n=t.call(this)||this).t="30",n.asn1Array=e,n}return Et(e,t),e.prototype.getValue=function(){return this.v=this.asn1Array.map(function(t){return t.getEncodedHex()}).join(""),this.v},e}(wt);function Dt(t,e){return+t[e+2]<8?1:128&+t.substr(e+2,2)}function At(t,e){var n=Dt(t,e),i=t.substr(e+2,2*n);return i?(+i[0]<8?new St(i,16):new St(i.substr(2),16)).intValue():-1}function It(t,e){return e+2*(Dt(t,e)+1)}var Ot=function(t,e){var n=new Tt(t),i=new Tt(e);return new kt([n,i]).getEncodedHex()},xt=function(t){var e=It(t,0),n=It(t,e),i=At(t,e),o=t.substr(n,2*i),r=n+o.length,a=It(t,r),s=At(t,r),c=t.substr(a,2*s);return{r:new St(o,16),s:new St(c,16)}},Rt=bt.BigInteger,Mt=new Rt("2"),Ct=new Rt("3"),Bt=function(){function t(t,e){this.x=e,this.q=t}var e=t.prototype;return e.equals=function(t){return t===this||this.q.equals(t.q)&&this.x.equals(t.x)},e.toBigInteger=function(){return this.x},e.negate=function(){return new t(this.q,this.x.negate().mod(this.q))},e.add=function(e){return new t(this.q,this.x.add(e.toBigInteger()).mod(this.q))},e.subtract=function(e){return new t(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))},e.multiply=function(e){return new t(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))},e.divide=function(e){return new t(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))},e.square=function(){return new t(this.q,this.x.square().mod(this.q))},t}(),Gt=function(){function t(t,e,n,i){this.curve=t,this.x=e,this.y=n,this.z=null==i?Rt.ONE:i,this.zinv=null}var e=t.prototype;return e.getX=function(){return null===this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},e.getY=function(){return null===this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},e.equals=function(t){return t===this||(this.isInfinity()?t.isInfinity():t.isInfinity()?this.isInfinity():!!t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(Rt.ZERO)&&t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(Rt.ZERO))},e.isInfinity=function(){return null===this.x&&null===this.y||this.z.equals(Rt.ZERO)&&!this.y.toBigInteger().equals(Rt.ZERO)},e.negate=function(){return new t(this.curve,this.x,this.y.negate(),this.z)},e.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var n=this.x.toBigInteger(),i=this.y.toBigInteger(),o=this.z,r=e.x.toBigInteger(),a=e.y.toBigInteger(),s=e.z,c=this.curve.q,u=n.multiply(s).mod(c),l=r.multiply(o).mod(c),h=u.subtract(l),f=i.multiply(s).mod(c),p=a.multiply(o).mod(c),d=f.subtract(p);if(Rt.ZERO.equals(h))return Rt.ZERO.equals(d)?this.twice():this.curve.infinity;var g=u.add(l),v=o.multiply(s).mod(c),m=h.square().mod(c),y=h.multiply(m).mod(c),_=v.multiply(d.square()).subtract(g.multiply(m)).mod(c),b=h.multiply(_).mod(c),E=d.multiply(m.multiply(u).subtract(_)).subtract(f.multiply(y)).mod(c),S=y.multiply(v).mod(c);return new t(this.curve,this.curve.fromBigInteger(b),this.curve.fromBigInteger(E),S)},e.twice=function(){if(this.isInfinity())return this;if(!this.y.toBigInteger().signum())return this.curve.infinity;var e=this.x.toBigInteger(),n=this.y.toBigInteger(),i=this.z,o=this.curve.q,r=this.curve.a.toBigInteger(),a=e.square().multiply(Ct).add(r.multiply(i.square())).mod(o),s=n.shiftLeft(1).multiply(i).mod(o),c=n.square().mod(o),u=c.multiply(e).multiply(i).mod(o),l=s.square().mod(o),h=a.square().subtract(u.shiftLeft(3)).mod(o),f=s.multiply(h).mod(o),p=a.multiply(u.shiftLeft(2).subtract(h)).subtract(l.shiftLeft(1).multiply(c)).mod(o),d=s.multiply(l).mod(o);return new t(this.curve,this.curve.fromBigInteger(f),this.curve.fromBigInteger(p),d)},e.multiply=function(t){if(this.isInfinity())return this;if(!t.signum())return this.curve.infinity;for(var e=t.multiply(Ct),n=this.negate(),i=this,o=e.bitLength()-2;o>0;o--){i=i.twice();var r=e.testBit(o);r!==t.testBit(o)&&(i=i.add(r?this:n))}return i},t}(),Nt=function(){function t(t,e,n){this.q=t,this.a=this.fromBigInteger(e),this.b=this.fromBigInteger(n),this.infinity=new Gt(this,null,null)}var e=t.prototype;return e.equals=function(t){return t===this||this.q.equals(t.q)&&this.a.equals(t.a)&&this.b.equals(t.b)},e.fromBigInteger=function(t){return new Bt(this.q,t)},e.decodePointHex=function(t){switch(parseInt(t.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var e=this.fromBigInteger(new Rt(t.substr(2),16)),n=this.fromBigInteger(e.multiply(e.square()).add(e.multiply(this.a)).add(this.b).toBigInteger().modPow(this.q.divide(new Rt("4")).add(Rt.ONE),this.q));return n.toBigInteger().mod(Mt).equals(new Rt(t.substr(0,2),16).subtract(Mt))||(n=n.negate()),new Gt(this,e,n);case 4:case 6:case 7:var i=(t.length-2)/2,o=t.substr(2,i),r=t.substr(i+2,i);return new Gt(this,this.fromBigInteger(new Rt(o,16)),this.fromBigInteger(new Rt(r,16)));default:return null}},t}(),Lt={ECPointFp:Gt,ECCurveFp:Nt},Pt=bt.BigInteger,Ut=bt.SecureRandom,zt=Lt.ECCurveFp,jt=new Ut,Ft=Ht(),qt=Ft.curve,Vt=Ft.G,Kt=Ft.n;function Ht(){var t=new Pt("FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF",16),e=new Pt("FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC",16),n=new Pt("28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93",16),i=new zt(t,e,n),o=i.decodePointHex("0432C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0");return{curve:i,G:o,n:new Pt("FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123",16)}}function Jt(t,e){return t.length>=e?t:new Array(e-t.length+1).join("0")+t}var Wt={getGlobalCurve:function(){return qt},generateEcparam:Ht,generateKeyPairHex:function(t,e,n){var i=(t?new Pt(t,e,n):new Pt(Kt.bitLength(),jt)).mod(Kt.subtract(Pt.ONE)).add(Pt.ONE),o=Jt(i.toString(16),64),r=Vt.multiply(i);return{privateKey:o,publicKey:"04"+Jt(r.getX().toBigInteger().toString(16),64)+Jt(r.getY().toBigInteger().toString(16),64)}},compressPublicKeyHex:function(t){if(130!==t.length)throw new Error("Invalid public key to compress");var e=(t.length-2)/2,n=t.substr(2,e),i="03";return new Pt(t.substr(e+2,e),16).mod(new Pt("2")).equals(Pt.ZERO)&&(i="02"),i+n},utf8ToHex:function(t){for(var e=(t=unescape(encodeURIComponent(t))).length,n=[],i=0;i<e;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;for(var o=[],r=0;r<e;r++){var a=n[r>>>2]>>>24-r%4*8&255;o.push((a>>>4).toString(16)),o.push((15&a).toString(16))}return o.join("")},leftPad:Jt,arrayToHex:function(t){return t.map(function(t){return 1===(t=t.toString(16)).length?"0"+t:t}).join("")},arrayToUtf8:function(t){for(var e=[],n=0,i=0;i<2*t.length;i+=2)e[i>>>3]|=parseInt(t[n],10)<<24-i%8*4,n++;try{for(var o=[],r=0;r<t.length;r++){var a=e[r>>>2]>>>24-r%4*8&255;o.push(String.fromCharCode(a))}return decodeURIComponent(escape(o.join("")))}catch(t){throw new Error("Malformed UTF-8 data")}},hexToArray:function(t){var e=[],n=t.length;n%2!=0&&(t=Jt(t,n+1)),n=t.length;for(var i=0;i<n;i+=2)e.push(parseInt(t.substr(i,2),16));return e},verifyPublicKey:function(t){var e=qt.decodePointHex(t);if(!e)return!1;var n=e.getX();return e.getY().square().equals(n.multiply(n.square()).add(n.multiply(qt.a)).add(qt.b))},comparePublicKeyHex:function(t,e){var n=qt.decodePointHex(t);if(!n)return!1;var i=qt.decodePointHex(e);return!!i&&n.equals(i)}},Xt=new Uint32Array(68),$t=new Uint32Array(64);function Zt(t,e){var n=31&e;return t<<n|t>>>32-n}function Qt(t){return t^Zt(t,9)^Zt(t,17)}function Yt(t){var e=8*t.length,n=e%512;n=n>=448?512-n%448-1:448-n-1;for(var i=new Array((n-7)/8),o=new Array(8),r=0,a=i.length;r<a;r++)i[r]=0;for(var s=0,c=o.length;s<c;s++)o[s]=0;e=e.toString(2);for(var u=7;u>=0;u--)if(e.length>8){var l=e.length-8;o[u]=parseInt(e.substr(l),2),e=e.substr(0,l)}else e.length>0&&(o[u]=parseInt(e,2),e="");for(var h,f=new Uint8Array([].concat(t,[128],i,o)),p=new DataView(f.buffer,0),d=f.length/64,g=new Uint32Array([1937774191,1226093241,388252375,3666478592,2842636476,372324522,3817729613,2969243214]),v=0;v<d;v++){Xt.fill(0),$t.fill(0);for(var m=16*v,y=0;y<16;y++)Xt[y]=p.getUint32(4*(m+y),!1);for(var _=16;_<68;_++)Xt[_]=(h=Xt[_-16]^Xt[_-9]^Zt(Xt[_-3],15))^Zt(h,15)^Zt(h,23)^Zt(Xt[_-13],7)^Xt[_-6];for(var b=0;b<64;b++)$t[b]=Xt[b]^Xt[b+4];for(var E=g[0],S=g[1],w=g[2],T=g[3],k=g[4],D=g[5],A=g[6],I=g[7],O=void 0,x=void 0,R=void 0,M=void 0,C=0;C<64;C++)M=C>=0&&C<=15?2043430169:2055708042,x=(C>=0&&C<=15?E^S^w:E&S|E&w|S&w)+T+((O=Zt(Zt(E,12)+k+Zt(M,C),7))^Zt(E,12))+$t[C],R=(C>=0&&C<=15?k^D^A:k&D|~k&A)+I+O+Xt[C],T=w,w=Zt(S,9),S=E,E=x,I=A,A=Zt(D,19),D=k,k=Qt(R);g[0]^=E,g[1]^=S,g[2]^=w,g[3]^=T,g[4]^=k,g[5]^=D,g[6]^=A,g[7]^=I}for(var B=[],G=0,N=g.length;G<N;G++){var L=g[G];B.push((4278190080&L)>>>24,(16711680&L)>>>16,(65280&L)>>>8,255&L)}return B}for(var te=64,ee=new Uint8Array(te),ne=new Uint8Array(te),ie=0;ie<te;ie++)ee[ie]=54,ne[ie]=92;var oe=Yt,re=bt.BigInteger,ae=Ot,se=xt,ce=oe,ue=Wt.generateEcparam(),le=ue.G,he=ue.curve,fe=ue.n,pe=0;function de(t,e,n){void 0===n&&(n="1234567812345678"),n=Wt.utf8ToHex(n);var i,o,r=Wt.leftPad(le.curve.a.toBigInteger().toRadix(16),64),a=Wt.leftPad(le.curve.b.toBigInteger().toRadix(16),64),s=Wt.leftPad(le.getX().toBigInteger().toRadix(16),64),c=Wt.leftPad(le.getY().toBigInteger().toRadix(16),64);if(128===e.length)i=e.substr(0,64),o=e.substr(64,64);else{var u=le.curve.decodePointHex(e);i=Wt.leftPad(u.getX().toBigInteger().toRadix(16),64),o=Wt.leftPad(u.getY().toBigInteger().toRadix(16),64)}var l=Wt.hexToArray(n+r+a+s+c+i+o),h=4*n.length;l.unshift(255&h),l.unshift(h>>8&255);var f=ce(l);return Wt.arrayToHex(ce(f.concat(Wt.hexToArray(t))))}function ge(){var t=Wt.generateKeyPairHex(),e=he.decodePointHex(t.publicKey);return t.k=new re(t.privateKey,16),t.x1=e.getX().toBigInteger(),t}var ve={generateKeyPairHex:Wt.generateKeyPairHex,compressPublicKeyHex:Wt.compressPublicKeyHex,comparePublicKeyHex:Wt.comparePublicKeyHex,doEncrypt:function(t,e,n){void 0===n&&(n=1),t="string"==typeof t?Wt.hexToArray(Wt.utf8ToHex(t)):Array.prototype.slice.call(t),e=Wt.getGlobalCurve().decodePointHex(e);var i=Wt.generateKeyPairHex(),o=new re(i.privateKey,16),r=i.publicKey;r.length>128&&(r=r.substr(r.length-128));var a=e.multiply(o),s=Wt.hexToArray(Wt.leftPad(a.getX().toBigInteger().toRadix(16),64)),c=Wt.hexToArray(Wt.leftPad(a.getY().toBigInteger().toRadix(16),64)),u=Wt.arrayToHex(ce([].concat(s,t,c))),l=1,h=0,f=[],p=[].concat(s,c),d=function(){f=ce([].concat(p,[l>>24&255,l>>16&255,l>>8&255,255&l])),l++,h=0};d();for(var g=0,v=t.length;g<v;g++)h===f.length&&d(),t[g]^=255&f[h++];var m=Wt.arrayToHex(t);return n===pe?r+m+u:r+u+m},doDecrypt:function(t,e,n,i){void 0===n&&(n=1);var o=(void 0===i?{}:i).output,r=void 0===o?"string":o;e=new re(e,16);var a=t.substr(128,64),s=t.substr(192);n===pe&&(a=t.substr(t.length-64),s=t.substr(128,t.length-128-64));var c=Wt.hexToArray(s),u=Wt.getGlobalCurve().decodePointHex("04"+t.substr(0,128)).multiply(e),l=Wt.hexToArray(Wt.leftPad(u.getX().toBigInteger().toRadix(16),64)),h=Wt.hexToArray(Wt.leftPad(u.getY().toBigInteger().toRadix(16),64)),f=1,p=0,d=[],g=[].concat(l,h),v=function(){d=ce([].concat(g,[f>>24&255,f>>16&255,f>>8&255,255&f])),f++,p=0};v();for(var m=0,y=c.length;m<y;m++)p===d.length&&v(),c[m]^=255&d[p++];return Wt.arrayToHex(ce([].concat(l,c,h)))===a.toLowerCase()?"array"===r?c:Wt.arrayToUtf8(c):"array"===r?[]:""},doSignature:function(t,e,n){var i=void 0===n?{}:n,o=i.pointPool,r=i.der,a=i.hash,s=i.publicKey,c=i.userId,u="string"==typeof t?Wt.utf8ToHex(t):Wt.arrayToHex(t);a&&(u=de(u,s=s||function(t){var e=le.multiply(new re(t,16)),n=Wt.leftPad(e.getX().toBigInteger().toString(16),64),i=Wt.leftPad(e.getY().toBigInteger().toString(16),64);return"04"+n+i}(e),c));var l=new re(e,16),h=new re(u,16),f=null,p=null,d=null;do{do{var g=void 0;f=(g=o&&o.length?o.pop():ge()).k,p=h.add(g.x1).mod(fe)}while(p.equals(re.ZERO)||p.add(f).equals(fe));d=l.add(re.ONE).modInverse(fe).multiply(f.subtract(p.multiply(l))).mod(fe)}while(d.equals(re.ZERO));return r?ae(p,d):Wt.leftPad(p.toString(16),64)+Wt.leftPad(d.toString(16),64)},doVerifySignature:function(t,e,n,i){var o,r,a=void 0===i?{}:i,s=a.der,c=a.hash,u=a.userId,l="string"==typeof t?Wt.utf8ToHex(t):Wt.arrayToHex(t);if(c&&(l=de(l,n,u)),s){var h=se(e);o=h.r,r=h.s}else o=new re(e.substring(0,64),16),r=new re(e.substring(64),16);var f=he.decodePointHex(n),p=new re(l,16),d=o.add(r).mod(fe);if(d.equals(re.ZERO))return!1;var g=le.multiply(r).add(f.multiply(d)),v=p.add(g.getX().toBigInteger()).mod(fe);return o.equals(v)},getPoint:ge,verifyPublicKey:Wt.verifyPublicKey},me=function(){function t(){}return t.prototype.doEncrypt=function(t,e,n){return void 0===n&&(n=1),"04"+ve.doEncrypt(t,e,n)},t}();var ye=function(){function e(t){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.adapters={},this.sdkReady=!1,this.name=t,this.hook=new a(this),this.logger=new Z(t),this.remotePlugin=new Map,this.Types=V,this.adapters.fetch=tt,this.adapters.storage=B}return e.usePlugin=function(t,n,i){if(n){for(var o=!1,r=0,a=e.plugins.length;r<a;r++){if(e.plugins[r].name===n){e.plugins[r].plugin=t,e.plugins[r].options=i||{},o=!0;break}}o||e.plugins.push({name:n,plugin:t,options:i})}else e.plugins.push({plugin:t})},e.prototype.usePlugin=function(t,e,n){t&&(this.remotePlugin.get(t)?console.info("your sdk version has ".concat(t," already ~")):e?"string"==typeof e?this.remotePlugin.get(t)||this.remotePlugin.set(t,{src:e,call:n}):this.remotePlugin.get(t)||this.remotePlugin.set(t,{instance:e}):this.remotePlugin.get(t)||this.remotePlugin.set(t,"sdk"))},e.prototype.init=function(t){var n,i=this;if(this.inited)console.log("init can be call only one time");else if(t&&s(t))if(t.app_id&&("number"==typeof(n=t.app_id)&&!isNaN(n)))if(!t.app_key||function(t){return"string"==typeof t}(t.app_key))if(t.channel_domain||-1!==["cn","sg","va"].indexOf(t.channel)||(console.warn("channel must be `cn`, `sg`,`va` !!!"),t.channel="cn"),this.logger=new Z(this.name,t.log),this.configManager=new $(this,t),this.appBridge=new Q(t,this.configManager),this.bridgeReport=this.appBridge.bridgeInject(),this.requestManager=new ht(this,t),this.logSetting=new pt,this.debugger=new _t(this,t),this.initConfig=t,this.env=t.channel_domain?"self":"public",this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Init",data:t,level:"info",time:Date.now(),infoType:"cus"}),t.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport){try{e.plugins.length&&e.plugins.reduce(function(t,e){var n=e.plugin,o=e.options;if("stay"===(null==e?void 0:e.name)||"autotrack"===(null==e?void 0:e.name)){var r=Object.assign(i.initConfig,o),a=new n;a.apply(i,r),t.push(a)}return t},this.pluginInstances)}catch(t){console.log("load plugin error, ".concat(t.message)),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK加载插件发生了异常",level:"error",time:Date.now(),data:t.message,infoType:"sdk"})}this.inited=!0,this.emit(V.Init)}else t.enable_encryption&&"sm"===t.encryption_type&&this.initCrypto(),this.configManager.set({app_id:t.app_id}),this.eventManager=new st,this.tokenManager=new ut,this.sessionManager=new rt,this.profileManager=new ft,this.extendManager=new yt,Promise.all([new Promise(function(t){i.once(V.TokenComplete,function(){t(!0)})}),new Promise(function(t){i.once(V.Start,function(){t(!0)})}),new Promise(function(t){i.once(V.LogSettingReady,function(){t(!0)})})]).then(function(){i.ready(t)}).catch(function(t){console.log(t)}),this.logSetting.apply(this,t),this.tokenManager.apply(this,t),this.eventManager.apply(this,t),this.sessionManager.apply(this,t),this.inited=!0,this.emit(V.Init),this.initConfig.tracer_appId&&new dt(this,this.initConfig);else console.warn("app_key param is error, must be string, please check!");else console.warn("app_id param is error, must be number, please check!");else console.warn("init params error,please check")},e.prototype.ready=function(t){var n=this;try{this.extendManager.apply(this,this.initConfig),e.plugins.length&&e.plugins.reduce(function(t,e){var i=e.plugin,o=e.options,r=Object.assign(n.initConfig,o),a=new i;return a.apply(n,r),t.push(a),n.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK加载".concat(e.name,"插件"),level:"info",time:Date.now(),infoType:"sdk"}),t},this.pluginInstances)}catch(t){console.log("load plugin error, ".concat(t.message)),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK加载插件发生了异常",level:"error",time:Date.now(),data:t.message,infoType:"sdk"})}this.sdkReady=!0,this.emit(V.Ready),this.emit(V.CloudReady,{userInfo:this.configManager.get("user")}),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 用户信息初始化完成",time:Date.now(),secType:"USER",level:"info",data:this.configManager.get("user"),infoType:"sdk"}),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 初始化完成",time:Date.now(),level:"info",data:this.configManager.get("user"),infoType:"sdk"}),this.logger.info("appid: ".concat(t.app_id,", userInfo:").concat(JSON.stringify(this.configManager.get("user")))),this.logger.info("appid: ".concat(t.app_id,", sdk is ready, version is ").concat(L,", you can report now !!!")),this.profileManager.apply(this,t);try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(t){this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK发生了异常",level:"error",time:Date.now(),data:t.message,infoType:"sdk"})}this.pageView(),this.on(V.TokenChange,function(e){"webid"!==e.type&&"anonymous_id"!==e.type||n.pageView(),n.logger.info("appid: ".concat(t.app_id," token change, new userInfo:").concat(JSON.stringify(n.configManager.get("user")))),n.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 设置了用户信息",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user"),infoType:"sdk"})}),this.on(V.TokenReset,function(){n.logger.info("appid: ".concat(t.app_id," token reset, new userInfo:").concat(JSON.stringify(n.configManager.get("user")))),n.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 重置了用户信息",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user"),infoType:"sdk"})}),this.on(V.RouteChange,function(e){e.init||t.disable_route_report||n.pageView(e.config)}),this.on(V.ReStart,function(){n.pageView()})},e.prototype.config=function(e){if(this.inited)if(e&&s(e))if(this.bridgeReport)this.appBridge.setConfig(e);else{e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv);var n=t({},e);if(this.initConfig&&this.initConfig.configPersist){var i=this.configManager.getStore();i&&(n=Object.assign(i,e)),this.configManager.setStore(e)}n.web_id,n.user_unique_id;var o=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n}(n,["web_id","user_unique_id"]);n.hasOwnProperty("web_id")&&this.emit(V.ConfigWebId,n.web_id),n.hasOwnProperty("user_unique_id")&&this.emit(V.ConfigUuid,n.user_unique_id),this.emit(V.ConfigTransform,n),this.configManager.set(o),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Config",level:"info",time:Date.now(),data:n,infoType:"cus"})}else this.logger.warn("config params is error, please check");else this.logger.warn("config must be use after function init")},e.prototype.setUserUniqueID=function(t){this.config({user_unique_id:t})},e.prototype.setHeaderInfo=function(t,e){var n={};n[t]=e,this.config(n)},e.prototype.removeHeaderInfo=function(t){var e={};e[t]=void 0,this.config(e)},e.prototype.setDomain=function(t){this.configManager&&this.configManager.setDomain(t),this.emit(V.ConfigDomain)},e.prototype.getConfig=function(t){return this.configManager.get(t)},e.prototype.send=function(){this.start()},e.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(V.Start),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Start",level:"info",time:Date.now(),infoType:"cus"}),this.bridgeReport&&(this.pageView(),this.emit(V.Ready)))},e.prototype.event=function(t,e){var n=this;try{if(this.initConfig&&this.initConfig.disable_track_event)return;var i=[];if(Array.isArray(t))t.forEach(function(t){var e=n.processEvent(t[0],t[1]||{});e&&i.push(e)});else{var o=this.processEvent(t,e);if(!o)return;i.push(o)}this.bridgeReport?i.forEach(function(t){var e=t.event,i=t.params;n.appBridge.onEventV3(e,JSON.stringify(i))}):i.length&&(this.emit(V.Event,i),this.emit(V.SessionResetTime)),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Event",level:"info",time:Date.now(),data:t,infoType:"cus"})}catch(t){this.logger.warn("something error, please check"),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Event发生了异常",level:"error",time:Date.now(),data:t.message,infoType:"sdk"})}},e.prototype.beconEvent=function(t,e){var n=this;if(!this.initConfig||!this.initConfig.disable_track_event)if(Array.isArray(t))console.warn("beconEvent not support batch report, please check");else{var i=[],o=this.processEvent(t,e||{});o&&(i.push(o),this.bridgeReport?i.forEach(function(t){var e=t.event,i=t.params;n.appBridge.onEventV3(e,JSON.stringify(i))}):i.length&&(this.emit(V.BeconEvent,i),this.emit(V.SessionResetTime)),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Beacon Event",level:"info",time:Date.now(),data:t,infoType:"sdk"}))}},e.prototype.processEvent=function(t,e){void 0===e&&(e={});try{if(!t)return this.logger.warn("eventName is null， please check"),null;var n=t;/^event\./.test(t)&&(n=t.slice(6));var i=e;"object"!=typeof i&&(i={}),i.profile?delete i.profile:i.event_index=h();var o=void 0;return i.local_ms?(o=i.local_ms,delete i.local_ms):o=+new Date,{event:n,params:i,local_time_ms:o,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(n){return this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK发生了异常",level:"error",time:Date.now(),data:n.message,infoType:"sdk"}),{event:t,params:e}}},e.prototype.dynamicParams=function(t){this.dynamicParamsFilter=t},e.prototype.filterEvent=function(t){this.eventFilter=t},e.prototype.on=function(t,e){this.hook.on(t,e)},e.prototype.once=function(t,e){this.hook.once(t,e)},e.prototype.off=function(t,e){this.hook.off(t,e)},e.prototype.emit=function(t,e,n){this.hook.emit(t,e,n)},e.prototype.set=function(t){this.hook.set(t)},e.prototype.pageView=function(t){this.disableAutoPageView||this.predefinePageView(t)},e.prototype.predefinePageView=function(e){if(void 0===e&&(e={}),this.inited){var n={title:document.title||location.pathname,url:location.href,url_path:this.handlePath(),time:Date.now(),referrer:window.document.referrer,$is_first_time:"".concat(this.configManager&&this.configManager.is_first_time||!1)},i=t(t({},n),e);this.event("predefine_pageview",i),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 上报PV",level:"info",time:Date.now(),infoType:"sdk"})}else console.warn("predefinePageView should call after init")},e.prototype.handlePath=function(){var t=location.pathname;try{if(this.initConfig.allow_hash){var e=new URL(location.href).hash.match(/#\/([^?#]+)/i);return e&&e.length?e[1]:location.pathname}}catch(e){t=location.pathname}return t},e.prototype.clearEventCache=function(){this.emit(V.CleanEvents)},e.prototype.setWebIDviaUnionID=function(t){if(t){var e=E(t);this.config({web_id:"".concat(e),wechat_unionid:t}),this.emit(V.CustomWebId)}},e.prototype.setWebIDviaOpenID=function(t){if(t){var e=E(t);this.config({web_id:"".concat(e),wechat_openid:t}),this.emit(V.CustomWebId)}},e.prototype.setAnonymousId=function(t){this.emit(V.AnonymousId,t)},e.prototype.setNativeAppId=function(t){this.bridgeReport&&this.appBridge.setNativeAppId(t)},e.prototype.setRequestHeaders=function(t){this.emit(V.CustomHeader,t)},e.prototype.resetStayDuration=function(t,e,n){void 0===t&&(t=""),void 0===e&&(e=""),void 0===n&&(n=""),this.emit(V.ResetStay,{url_path:t,title:e,url:n},V.Stay)},e.prototype.resetStayParams=function(t,e,n){void 0===t&&(t=""),void 0===e&&(e=""),void 0===n&&(n=""),this.emit(V.SetStay,{url_path:t,title:e,url:n},V.Stay)},e.prototype.getToken=function(e,n){var i=this;if(this.inited){var o=!1,r=function(n){if(!o){o=!0;var r=i.configManager.get().user;return n&&(r.tobid=n,r["diss".split("").reverse().join("")]=n),e(t({},r))}},a=function(){i.tokenManager.getTobId(function(t){r(t)})};this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行GetToken",level:"info",time:Date.now(),infoType:"cus"}),this.sdkReady?a():(n&&setTimeout(function(){r()},n),this.on(V.Ready,function(){a()}))}else this.logger.warn("getToken must be use after function init")},e.prototype.bindToken=function(t,e){this.sdkStop=!0,this.emit(V.BindToken,{params:t,callback:e})},e.prototype.setResourceEvent=function(t){this.emit(V.SetResource,t)},e.prototype.startTrackEvent=function(t){t&&this.emit(V.TrackDurationStart,t,V.TrackDuration)},e.prototype.endTrackEvent=function(t,e){void 0===e&&(e={}),t&&this.emit(V.TrackDurationEnd,{eventName:t,params:e},V.TrackDuration)},e.prototype.pauseTrackEvent=function(t){t&&this.emit(V.TrackDurationPause,t,V.TrackDuration)},e.prototype.resumeTrackEvent=function(t){t&&this.emit(V.TrackDurationResume,t,V.TrackDuration)},e.prototype.profileSet=function(t){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(t)):this.emit(V.ProfileSet,t,V.Profile),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSet",level:"info",time:Date.now(),data:t,infoType:"cus"})},e.prototype.profileSetOnce=function(t){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(t)):this.emit(V.ProfileSetOnce,t,V.Profile),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSetOnce",level:"info",time:Date.now(),data:t,infoType:"cus"})},e.prototype.profileIncrement=function(t){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(t)):this.emit(V.ProfileIncrement,t,V.Profile),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileIncrement",level:"info",time:Date.now(),data:t,infoType:"cus"})},e.prototype.profileUnset=function(t){this.bridgeReport?this.appBridge.profileUnset(t):this.emit(V.ProfileUnset,t,V.Profile),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileUnset",level:"info",time:Date.now(),data:t,infoType:"cus"})},e.prototype.profileAppend=function(t){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(t)):this.emit(V.ProfileAppend,t,V.Profile),this.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileAppend",level:"info",time:Date.now(),data:t,infoType:"cus"})},e.prototype.setExternalAbVersion=function(t){this.bridgeReport?this.appBridge.setExternalAbVersion(t):this.emit(V.AbExternalVersion,"string"==typeof t&&t?"".concat(t).trim():null,V.Ab)},e.prototype.getVar=function(t,e,n){this.bridgeReport?this.appBridge.getVar(t,e,n):this.emit(V.AbVar,{name:t,defaultValue:e,callback:n},V.Ab)},e.prototype.getAllVars=function(t){this.bridgeReport?this.appBridge.getAllVars(t):this.emit(V.AbAllVars,t,V.Ab)},e.prototype.getABconfig=function(t,e){this.emit(V.AbConfig,{params:t,callback:e},V.Ab)},e.prototype.getAbSdkVersion=function(t){if(!this.bridgeReport||!t)return this.configManager.getAbVersion()||"";this.appBridge.getAbSdkVersion(t)},e.prototype.onAbSdkVersionChange=function(t){var e=this;return this.emit(V.AbVersionChangeOn,t,V.Ab),function(){e.emit(V.AbVersionChangeOff,t,V.Ab)}},e.prototype.offAbSdkVersionChange=function(t){this.emit(V.AbVersionChangeOff,t,V.Ab)},e.prototype.openOverlayer=function(){this.emit(V.AbOpenLayer,"",V.Ab)},e.prototype.closeOverlayer=function(){this.emit(V.AbCloseLayer,"",V.Ab)},e.prototype.initCrypto=function(){this.publicKey=this.initConfig.crypto_publicKey||"04BA9E229380DC0E41E10839B0C52A4763D3EDFE8903F3B8E81395523381E03AA995D295BD4A4088792E4785B224F7837EB4D2C7C05973C7AE8687A35ACAE470A0"},e.prototype.cryptoData=function(t){try{if(this.initConfig.enable_encryption&&"sm"===this.initConfig.encryption_type&&!S()){var e=void 0;e=(new me).doEncrypt(JSON.stringify(t),this.publicKey,1);var n=D(e);return(e=new Uint8Array(n)).buffer||e}return t}catch(e){return console.log("加密出错了",e),t}},e.prototype.stop=function(){this.sdkStop=!0},e.prototype.reStart=function(){this.sdkStop=!1,this.emit(V.ReStart)},e.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(V.TokenComplete))},e.prototype.destoryInstance=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(V.TokenComplete))},e.prototype.setExposureType=function(t){this.emit(V.SetExposureType,t)},e.plugins=[],e}(),_e="__rangers_ab_style__";!function(t){var e=function(){try{return!!Symbol.iterator}catch(t){return!1}}(),n=function(t){var n={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e&&(n[Symbol.iterator]=function(){return n}),n},i=function(t){return encodeURIComponent(t).replace(/%20/g,"+")},o=function(t){return decodeURIComponent(String(t).replace(/\+/g," "))};(function(){try{var e=t.URLSearchParams;return"a=1"===new e("?a=1").toString()&&"function"==typeof e.prototype.set&&"function"==typeof e.prototype.entries}catch(e){return!1}})()||function(){var o=function t(e){Object.defineProperty(this,"_entries",{writable:!0,value:{}});var n=typeof e;if("undefined"===n);else if("string"===n)""!==e&&this._fromString(e);else if(e instanceof t){var i=this;e.forEach(function(t,e){i.append(e,t)})}else{if(null===e||"object"!==n)throw new TypeError("Unsupported input's type for URLSearchParams");if("[object Array]"===Object.prototype.toString.call(e))for(var o=0;o<e.length;o++){var r=e[o];if("[object Array]"!==Object.prototype.toString.call(r)&&2===r.length)throw new TypeError("Expected [string, any] as entry at index "+o+" of URLSearchParams's input");this.append(r[0],r[1])}else for(var a in e)e.hasOwnProperty(a)&&this.append(a,e[a])}},r=o.prototype;r.append=function(t,e){t in this._entries?this._entries[t].push(String(e)):this._entries[t]=[String(e)]},r.delete=function(t){delete this._entries[t]},r.get=function(t){return t in this._entries?this._entries[t][0]:null},r.getAll=function(t){return t in this._entries?this._entries[t].slice(0):[]},r.has=function(t){return t in this._entries},r.set=function(t,e){this._entries[t]=[String(e)]},r.forEach=function(t,e){var n;for(var i in this._entries)if(this._entries.hasOwnProperty(i)){n=this._entries[i];for(var o=0;o<n.length;o++)t.call(e,n[o],i,this)}},r.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),n(t)},r.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),n(t)},r.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),n(t)},e&&(r[Symbol.iterator]=r.entries),r.toString=function(){var t=[];return this.forEach(function(e,n){t.push(i(n)+"="+i(e))}),t.join("&")},t.URLSearchParams=o}();var r=t.URLSearchParams.prototype;"function"!=typeof r.sort&&(r.sort=function(){var t=this,e=[];this.forEach(function(n,i){e.push([i,n]),t._entries||t.delete(i)}),e.sort(function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:0}),t._entries&&(t._entries={});for(var n=0;n<e.length;n++)this.append(e[n][0],e[n][1])}),"function"!=typeof r._fromString&&Object.defineProperty(r,"_fromString",{enumerable:!1,configurable:!1,writable:!1,value:function(t){if(this._entries)this._entries={};else{var e=[];this.forEach(function(t,n){e.push(n)});for(var n=0;n<e.length;n++)this.delete(e[n])}var i,r=(t=t.replace(/^\?/,"")).split("&");for(n=0;n<r.length;n++)i=r[n].split("="),this.append(o(i[0]),i.length>1?o(i[1]):"")}})}(void 0!==A?A:"undefined"!=typeof window?window:"undefined"!=typeof self?self:A),function(t){if(function(){try{var e=new t.URL("b","http://a");return e.pathname="c d","http://a/c%20d"===e.href&&e.searchParams}catch(e){return!1}}()||function(){var e=t.URL,n=function e(n,i){"string"!=typeof n&&(n=String(n)),i&&"string"!=typeof i&&(i=String(i));var o,r=document;if(i&&(void 0===t.location||i!==t.location.href)){i=i.toLowerCase(),(o=(r=document.implementation.createHTMLDocument("")).createElement("base")).href=i,r.head.appendChild(o);try{if(0!==o.href.indexOf(i))throw new Error(o.href)}catch(e){throw new Error("URL unable to set base "+i+" due to "+e)}}var a=r.createElement("a");a.href=n,o&&(r.body.appendChild(a),a.href=a.href);var s=r.createElement("input");if(s.type="url",s.value=n,":"===a.protocol||!/:/.test(a.href)||!s.checkValidity()&&!i)throw new TypeError("Invalid URL");Object.defineProperty(this,"_anchorElement",{value:a});var c=new t.URLSearchParams(this.search),u=!0,l=!0,h=this;["append","delete","set"].forEach(function(t){var e=c[t];c[t]=function(){e.apply(c,arguments),u&&(l=!1,h.search=c.toString(),l=!0)}}),Object.defineProperty(this,"searchParams",{value:c,enumerable:!0});var f=void 0;Object.defineProperty(this,"_updateSearchParams",{enumerable:!1,configurable:!1,writable:!1,value:function(){this.search!==f&&(f=this.search,l&&(u=!1,this.searchParams._fromString(this.search),u=!0))}})},i=n.prototype;["hash","host","hostname","port","protocol"].forEach(function(t){!function(t){Object.defineProperty(i,t,{get:function(){return this._anchorElement[t]},set:function(e){this._anchorElement[t]=e},enumerable:!0})}(t)}),Object.defineProperty(i,"search",{get:function(){return this._anchorElement.search},set:function(t){this._anchorElement.search=t,this._updateSearchParams()},enumerable:!0}),Object.defineProperties(i,{toString:{get:function(){var t=this;return function(){return t.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(t){this._anchorElement.href=t,this._updateSearchParams()},enumerable:!0},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(t){this._anchorElement.pathname=t},enumerable:!0},origin:{get:function(){var t={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol],e=this._anchorElement.port!=t&&""!==this._anchorElement.port;return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(e?":"+this._anchorElement.port:"")},enumerable:!0},password:{get:function(){return""},set:function(t){},enumerable:!0},username:{get:function(){return""},set:function(t){},enumerable:!0}}),n.createObjectURL=function(t){return e.createObjectURL.apply(e,arguments)},n.revokeObjectURL=function(t){return e.revokeObjectURL.apply(e,arguments)},t.URL=n}(),void 0!==t.location&&!("origin"in t.location)){var e=function(){return t.location.protocol+"//"+t.location.hostname+(t.location.port?":"+t.location.port:"")};try{Object.defineProperty(t.location,"origin",{get:e,enumerable:!0})}catch(n){setInterval(function(){t.location.origin=e()},100)}}}(void 0!==A?A:"undefined"!=typeof window?window:"undefined"!=typeof self?self:A);var be={},Ee=[],Se=function(t){t.length&&t.forEach(function(t){Ee.push(t)})};function we(t,e,n,i){var o=t&&t.source||window.opener||window.parent,r=t&&t.origin||i||"*",a={type:e,payload:n};o.postMessage(JSON.stringify(a),r)}function Te(t,e){be[t]=be[t]||[],be[t].push(e)}function ke(t){if(Ee.some(function(t){return"*"===t})||Ee.some(function(e){return t.origin.indexOf(e)>-1})){var e=t.data;if("string"==typeof t.data)try{e=JSON.parse(t.data)}catch(t){e=void 0}if(!e)return;var n=e.type,i=e.payload;be[n]&&be[n].forEach(function(e){"function"==typeof e&&e(t,i)})}}function De(t,e){var n={};if(Object.keys(t).length)for(var i in t){if("filter"===i||"autotrack"===i||"enable_stay_duration"===i)break;n[i]=t[i]}(window.opener||window.parent).postMessage({type:"tea:sdk:info",config:n,version:e},"*"),window.addEventListener("message",ke,!1)}var Ae="",Ie=!1;function Oe(t){var e=t.event,n=t.editorUrl;t.collectInstance,t.fromSession;Ie||(Ie=!0,v(n,function(){we(e,"abEditorScriptloadSuccess")},function(){e&&we(e,"abEditorScriptloadError"),Ie=!1}))}var xe;!function(t){t[t.Var=0]="Var",t[t.All=1]="All"}(xe||(xe={}));var Re=function(){function e(){this.fetchStatus="no",this.refreshFetchStatus="complete",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data=null,this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[],this.auto_exposure=!1}return e.prototype.apply=function(t,e){var n=this;if(this.collect=t,this.config=e,this.config.enable_ab_test){var i=t.configManager.getSettingData("bav_ab_config");if(!u(i)||i){var o=e.enable_multilink,r=e.ab_channel_domain,a=e.enable_ab_visual,s=e.ab_cross,c=e.ab_cookie_domain,l=e.disable_ab_reset,h=e.auto_exposure_expriment,f=r||d(z[e.channel||"cn"]),p=t.adapters,g=p.storage,v=p.fetch;this.cacheStorgae=new g(!1),this.fetch=v,this.enable_multilink=o,this.enable_ab_visual=a,this.abKey="__tea_sdk_ab_version_".concat(e.app_id),this.ab_cross=s,this.ab_cookie_domain=c||"",this.fetchUrl="".concat(f).concat("/service/2/abtest_config/"),this.reportUrl="".concat(t.configManager.getUrl("event")),this.exposureLimit=e.exposure_limit||5,this.ab_batch_time=e.ab_batch_time||50,this.overlay_opacity=e.overlay_opacity||0,this.auto_exposure=h;var m=this.collect.Types;this.types=m;var y=t.configManager.getSettingData("bav_ab_refresh");this.collect.on(m.TokenChange,function(t){l||u(i)&&!y||"uuid"===t.type&&n.readyStatus&&(n.clearCache(),n.fetchAB())}),this.collect.on(m.TokenReset,function(){l||u(i)&&!y||n.readyStatus&&(n.clearCache(),n.fetchAB())}),this.collect.on(m.AbVar,function(t){var e=t.name,i=t.defaultValue,o=t.callback;n.getVar(e,i,o)}),this.collect.on(m.AbAllVars,function(t){n.getAllVars(t)}),this.collect.on(m.AbConfig,function(t){var e=t.params,i=t.callback;n.getABconfig(e,i)}),this.collect.on(m.AbExternalVersion,function(t){n.setExternalAbVersion(t)}),this.collect.on(m.AbOpenLayer,function(){n.openOverlayer()}),this.collect.on(m.AbCloseLayer,function(){n.closeOverlayer()}),this.collect.on(m.AbVersionChangeOn,function(t){n.changeListener.set(t,t)}),this.collect.on(m.AbVersionChangeOff,function(t){n.changeListener.get(t)&&n.changeListener.delete(t)}),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(m.AbReady)}}},e.prototype.ready=function(t){var e=this;if(this.collect.set(t),this.collect.hook._hooksCache.hasOwnProperty(t)){var n=this.collect.hook._hooksCache[t];if(!Object.keys(n).length)return;var i=function(t){n[t].length&&n[t].forEach(function(n){e.collect.hook.emit(t,n)})};for(var o in n)i(o)}},e.prototype.loadMode=function(){var t,e,n=function(){try{var t=JSON.parse(atob(window.name));return t||void 0}catch(t){return}}(),i="";if(n){var o=n.scenario,r=n.href;o?(this.editMode=!0,i=o):!r||-1===r.indexOf("datatester")&&-1===r.indexOf("visual-editor")||(this.editMode=!0,i="visual-editor")}this.enable_ab_visual&&(function(t,e){window.TEAVisualEditor=window.TEAVisualEditor||{},Se(["*"]);var n,i="";De(e,L);var o="";try{var r=window.performance.getEntriesByType("resource");if(r&&r.length&&(r.forEach(function(t){"script"===t.initiatorType&&t.name&&-1!==t.name.indexOf("collect")&&(o=t.name)}),o||document.currentScript&&(o=document.currentScript.src),o&&(n=o.split("/"))&&n.length)){i="https:/";for(var a=2;a<n.length&&a!==n.length-1;a++)i+="/".concat(n[a]);i="".concat(i,"/visual-ab-core")}}catch(t){}Te("tea:openVisualABEditor",function(n){var o=n.data;if("string"==typeof n.data)try{o=JSON.parse(n.data)}catch(t){o=void 0}if(o){var r=o.lang;if(o.appId!==e.app_id)return we(n,"appIdError"),void console.error("abtest appid is not belong the page appid please check");var a=o.version;if(a){var s=a?".".concat(a):".1.0.1";Ae=i?"".concat(i).concat(s,".js?query=").concat(Date.now()):"".concat(F,"?query=").concat(Date.now())}else Ae="".concat(F,"?query=").concat(Date.now());window.TEAVisualEditor.lang=r,window.TEAVisualEditor.__ab_domin=e.channel_domain||"",Oe({event:n,editorUrl:Ae,collectInstance:t})}})}(this.collect,this.config),"visual-editor"===i)?this.collect.destoryInstace():this.enable_multilink&&(t=this.collect,e=this.config,window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.appId=e.app_id,Te("tea:openTesterEventInspector",function(e){var n=e.data;if("string"==typeof e.data)try{n=JSON.parse(e.data)}catch(t){n=void 0}if(n){var i=n.referrer,o=n.lang,r=n.appId;window.TEAVisualEditor.__editor_ajax_domain=i||"",window.TEAVisualEditor.__ab_appId=r||"",window.TEAVisualEditor.lang=o||"";var a="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/tester-event-inspector";a="".concat(a,".2.2.0"),Oe({event:e,editorUrl:"".concat(a,".js?query=").concat(Date.now()),collectInstance:t})}}))},e.prototype.checkLocal=function(){var t=this.getABCache(),e=t.ab_version,n=t.ab_ext_version,i=t.ab_version_multilink,o=t.data,r=this.checkFromUrl();r?this.mulilinkVersions.push(r):this.mulilinkVersions=i||[],this.extVersions=n||[],this.versions=e||[],this.data=o;var a=this.versions.concat(this.extVersions);this.enable_multilink&&(a=a.concat(this.mulilinkVersions)),this.configVersions(a.join(","))},e.prototype.checkFromUrl=function(){var t=b(window.location.href);return t&&t.vid?t.vid:""},e.prototype.updateVersions=function(){var t=this.extVersions.length?this.versions.concat(this.extVersions):this.versions;this.enable_multilink&&(t=t.concat(this.mulilinkVersions)),this.configVersions(t.join(",")),this.updateABCache(),this.changeListener.size>0&&this.changeListener.forEach(function(e){"function"==typeof e&&e(t)})},e.prototype.configVersions=function(t){this.collect.configManager.setAbVersion(t)},e.prototype.getVar=function(t,e,n){if(!t)throw new Error("variable must not be empty");if(void 0===e)throw new Error("variable no default value");if("function"!=typeof n)throw new Error("callback must be a function");var i={name:t,defaultValue:e,callback:n,type:xe.Var};this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用GetVar",level:"info",time:Date.now(),data:t,infoType:"cus"}),"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(i,t):this.callbacks.push(i)},e.prototype.getRealVar=function(t,e){var n=t.name,i=t.defaultValue,o=t.callback,r=this.data;if(r){if(s(r[n])){var a=r[n].vid;return"$ab_url"===e?this.mulilinkVersions.includes(a)||this.mulilinkVersions.push(a):this.versions.includes(a)||this.versions.push(a),this.updateVersions(),this.fechEvent(a,e,i),o(r[n].val),void this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK执行GetVar，并曝光了实验".concat(n),level:"info",time:Date.now(),data:r[n],infoType:"sdk"})}o(i),this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK执行GerVar默认回调",level:"info",time:Date.now(),data:this.data,infoType:"sdk"})}else o(i)},e.prototype.getAllVars=function(t){if("function"!=typeof t)throw new Error("callback must be a function");var e={callback:t,type:xe.All};this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用GetAllVars",level:"info",time:Date.now(),infoType:"cus"}),"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(e):this.callbacks.push(e)},e.prototype.getRealAllVars=function(t){(0,t.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{}),this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 执行GetAllVars",level:"info",time:Date.now(),data:this.data,infoType:"sdk"})},e.prototype.exposureAll=function(t){try{if(Object.keys(t).length)for(var e in t){if("$ab_url"===e||"$ab_modification"===e)break;this.getRealVar({name:e,defaultValue:t[e].val,callback:function(){},type:xe.Var},e)}}catch(t){console.warn("exposure all expriment err",JSON.stringify(t.message))}},e.prototype.fechEvent=function(t,e,n){try{if(this.config.disable_track_event)return;if(this.collect.sdkStop)return;if(!t)return;var i=this.collect.configManager.get(),o=i.header,r=i.user,a=this.getABCache();if(a&&a.uuid&&a.uuid!==r.user_unique_id)return;var s={event:"abtest_exposure",ab_sdk_version:"".concat(t),params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===e?n:window.location.href}),local_time_ms:Date.now()};o.custom=JSON.stringify(o.custom);var c={events:[s],user:r,header:o};this.reportExposure(c,e)}catch(t){this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 发生了异常",level:"error",time:Date.now(),data:t.message,infoType:"sdk"})}},e.prototype.reportExposure=function(t,e){this.exposureCache.push(t),this.report(e)},e.prototype.report=function(t){var e=this;try{var n=this.collect.cryptoData(this.exposureCache);if(w())return void it(this.collect.configManager.getUrl("img"),n);this.collect.requestManager.useRequest({url:this.reportUrl,data:n,timeout:1e5,useBeacon:"$ab_url"===t,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header,zip:!0}),this.exposureCache.forEach(function(t){e.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_EVENT,info:"曝光埋点上报成功",time:Date.now(),data:[t],code:200,status:"success",infoType:"sdk"})}),this.exposureCache=[]}catch(t){console.log("ab report err",t)}},e.prototype.setExternalAbVersion=function(t){this.extVersions=[t],this.updateVersions()},e.prototype.getABconfig=function(t,e){var n=Object.keys(t);n&&n.length&&this.collect.configManager.set(t),this.fetchAB(e)},e.prototype.get=function(t){if(this.ab_cross){var e=this.cacheStorgae.getCookie(t,this.ab_cookie_domain);return e?JSON.parse(e):null}return this.cacheStorgae.getItem(t)},e.prototype.set=function(t,e){this.ab_cross?this.cacheStorgae.setCookie(t,e,2592e6,this.ab_cookie_domain):this.cacheStorgae.setItem(t,e),this.collect.configManager.setAbCache(e)},e.prototype.remove=function(){this.ab_cross?this.cacheStorgae.removeCookie(this.abKey,this.ab_cookie_domain):this.cacheStorgae.removeItem(this.abKey)},e.prototype.getABCache=function(t){var e={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""};return e=this.get(this.abKey)||e,t?e[t]:e},e.prototype.updateABCache=function(){var t=this.getABCache();t.ab_version_multilink=this.mulilinkVersions,t.ab_ext_version=this.extVersions,t.ab_version=this.versions,t.timestamp=Date.now(),this.set(this.abKey,t)},e.prototype.setAbCache=function(t){var e=this.getABCache();e.data=this.data,e.uuid=t,e.timestamp=Date.now(),this.set(this.abKey,e)},e.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[],this.collect.configManager.clearAbCache()},e.prototype.openOverlayer=function(t){var e=this;if(function(t){if(!document.getElementById(_e)){var e="body { opacity: ".concat(t," !important; }"),n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.id=_e,i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),n.appendChild(i)}}(this.overlay_opacity),t)var n=setTimeout(function(){e.closeOverlayer(),clearTimeout(n)},t)},e.prototype.closeOverlayer=function(){var t;(t=document.getElementById(_e))&&t.parentElement.removeChild(t)},e.prototype.fetchComplete=function(t,e){var n=this;if(t&&"[object Object]"==Object.prototype.toString.call(t)){this.data=t,this.setAbCache(e);var i=[];Object.keys(t).forEach(function(e){var n=t[e].vid;n&&i.push(n)}),this.versions=this.versions.filter(function(t){return i.includes(t)});var o=t.$ab_url,r=t.$ab_modification;if(r&&r.val&&this.enable_ab_visual){if(this.collect.destroyInstance)return;this.getVar("$ab_modification",window.location.href,function(){var t;t=r.val,window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.__ab_config=t,v("".concat("https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-ab-loader.js","?query=").concat(Date.now()),function(){console.log("load visual render success")},function(){console.log("load visual render fail")}),n.closeOverlayer(),n.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行可视化实验",level:"info",logType:"fetch",time:Date.now(),infoType:"sdk",data:{$ab_modification:r}})})}else if(o&&this.enable_multilink){this.mulilinkVersions=this.mulilinkVersions.filter(function(t){return i.includes(t)}),this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行多链接实验",level:"info",logType:"fetch",time:Date.now(),infoType:"sdk",data:{$ab_url:o}});var a=o.val,s=o.vid;a&&s&&this.getVar("$ab_url",a,function(){n.editMode||(a!==window.location.href?setTimeout(function(){if(!n.collect.destroyInstance){var t="".concat(a);t=-1===t.indexOf("http")?"https://".concat(t):t;var e=_(t).host;try{var i=new URL(t);e!==location.host?i.searchParams.append("vid",s):window.history.replaceState("","",t),window.location.href=i.href}catch(e){window.location.href=t}}},100):n.closeOverlayer())})}this.auto_exposure&&this.exposureAll(t),this.updateVersions()}else this.closeOverlayer();this.callbacks.forEach(function(t){return n[t.type===xe.Var?"getRealVar":"getRealAllVars"](t,"")}),this.callbacks=[]},e.prototype.fetchAB=function(e){var n=this,i=this.collect.configManager.get(),o=i.header,r=i.user;this.config.enable_anonymousid&&delete r.web_id;var a=r.user_unique_id,s={header:t(t(t({aid:this.config.app_id},r||{}),o||{}),{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:window.location.href})};this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 发起AB实验请求",level:"info",logType:"fetch",time:Date.now(),data:s,infoType:"sdk"});var c=this.collect.cryptoData(s);this.collect.requestManager.useRequest({url:this.fetchUrl,data:c,success:function(t){n.fetchStatus="complete",n.refreshFetchStatus="complete";var i=t.data;"success"===t.message?(n.fetchComplete(i,a),e&&e(i)):(n.fetchComplete(null,a),e&&e(null)),n.collect.emit(n.types.AbComplete,i),n.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求成功",level:"info",logType:"fetch",time:Date.now(),data:i,infoType:"sdk"})},fail:function(){n.fetchStatus="complete",n.refreshFetchStatus="complete",n.fetchComplete(null,a),e&&e(null),n.collect.emit(n.types.AbTimeout),n.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求网络异常",level:"error",logType:"fetch",time:Date.now(),infoType:"sdk"})},timeout:this.config.ab_timeout||1e4,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header})},e}();try{var Me=vt();Me&&(Me.LogAb=function(t,e){(new Re).apply(t,e)})}catch(t){console.log(t)}var Ce=function(){function e(t,e){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.collect=t,this.config=e,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,s(e.enable_stay_duration)&&(this.options=Object.assign(this.options,e.enable_stay_duration))}return e.prototype.setParams=function(t,e,n){this.set_path=t,this.set_url=n,this.set_title=e},e.prototype.resetParams=function(t,e,n){this.url_path=t,this.url=n,this.title=e},e.prototype.enable=function(t,e,n){this.url_path=t||this.url_path,this.url=n||this.url,this.title=e||this.title,this.disableCallback=this.enablePageAlive(),this.options.params instanceof Function?this.customParmas=this.options.params():this.customParmas=this.options.params},e.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},e.prototype.sendEvent=function(e,n){void 0===n&&(n=!1);var i=n?this.aliveDTime:Date.now()-this.sessionStartTime;i<0||i>this.aliveDTime||Date.now()-this.pageStartTime>this.maxDuration||(this.collect.beconEvent(this.options.aliveName,t({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:i,is_support_visibility_change:m(),startTime:this.sessionStartTime,hidden:document.visibilityState,leave:e},this.customParmas)),this.sessionStartTime=Date.now(),this.resetParams(location.pathname,document.title,location.href))},e.prototype.getParams=function(t){switch(t){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.setUpTimer=function(){var t=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval(function(){Date.now()-t.sessionStartTime>t.aliveDTime&&t.sendEvent(!1,!0)},1e3)},e.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent(!1)):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},e.prototype.beforeunload=function(){document.hidden||this.sendEvent(!0)},e.prototype.enablePageAlive=function(){var t=this;this.timerHandler=this.setUpTimer();var e=this.visibilitychange.bind(this),n=this.beforeunload.bind(this);return f(document,"visibilitychange",e,!1),f(window,"pagehide",n,!1),function(){t.beforeunload(),p(document,"visibilitychange",e,!1),p(window,"beforeunload",n,!1),p(window,"pagehide",n,!1)}},e}(),Be=function(){function e(t,e){var n=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.visibilitychange=function(){"hidden"===document.visibilityState?n.activeEndTime=Date.now():"visible"===document.visibilityState&&(n.activeEndTime&&(n.totalTime+=n.activeEndTime-n.activeStartTime,n.activeTimes+=1),n.activeEndTime=void 0,n.activeStartTime=Date.now())},this.beforeunload=function(){if(n.totalTime+=(n.activeEndTime||Date.now())-n.activeStartTime,n.config.autotrack){try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:n.totalTime,page_title:document.title||location.pathname}))}catch(t){}}n.sendEventPageClose()},this.collect=t,this.config=e,this.maxDuration=e.maxDuration||864e5,this.pageStartTime=Date.now(),s(e.enable_stay_duration)&&(this.options=Object.assign(this.options,e.enable_stay_duration)),this.resetData()}return e.prototype.setParams=function(t,e,n){this.set_path=t,this.set_url=n,this.set_title=e},e.prototype.resetParams=function(t,e,n){this.url_path=t,this.url=n,this.title=e},e.prototype.enable=function(t,e,n){this.url_path=t||this.url_path,this.url=n||this.url,this.title=e||this.title,this.disableCallback=this.enablePageClose()},e.prototype.disable=function(){this.disableCallback()},e.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0,this.options.params instanceof Function?this.customParmas=this.options.params():this.customParmas=this.options.params,this.resetParams(location.pathname,document.title,location.href)},e.prototype.sendEventPageClose=function(){var e=Date.now()-this.pageStartTime;this.totalTime<0||e<0||this.totalTime>=this.maxDuration||(this.collect.beconEvent(this.options.closeName,t({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:e,is_support_visibility_change:m()},this.customParmas)),this.pageStartTime=Date.now(),this.resetData())},e.prototype.getParams=function(t){switch(t){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.enablePageClose=function(){var t=this,e=this.visibilitychange.bind(this),n=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",e),window.addEventListener("pagehide",n),function(){t.beforeunload(),document.removeEventListener("visibilitychange",e),window.removeEventListener("beforeunload",n),window.removeEventListener("pagehide",n)}},e}(),Ge=function(){function t(){}return t.prototype.apply=function(t,e){var n=this;if(this.collect=t,this.config=e,this.config.enable_stay_duration){this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new Ce(t,e),this.pageClose=new Be(t,e);var i=this.collect.Types;this.collect.on(i.ResetStay,function(t){var e=t.url_path,i=t.title,o=t.url;n.resetStayDuration(e,i,o)}),this.collect.on(i.RouteChange,function(t){t.init||e.disable_route_report||n.resetStayDuration()}),this.collect.on(i.SetStay,function(t){var e=t.url_path,i=t.title,o=t.url;n.setStayParmas(e,i,o)}),this.enable(this.url_path,this.title,this.url),this.ready(i.Stay),this.collect.emit(i.StayReady)}},t.prototype.ready=function(t){var e=this;if(this.collect.set(t),this.collect.hook._hooksCache.hasOwnProperty(t)){var n=this.collect.hook._hooksCache[t];if(!Object.keys(n).length)return;var i=function(t){n[t].length&&n[t].forEach(function(n){e.collect.hook.emit(t,n)})};for(var o in n)i(o)}},t.prototype.enable=function(t,e,n){this.pageAlive.enable(t,e,n),this.pageClose.enable(t,e,n)},t.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},t.prototype.setStayParmas=function(t,e,n){void 0===t&&(t=""),void 0===e&&(e=""),void 0===n&&(n=""),this.pageAlive.setParams(t,e,n),this.pageClose.setParams(t,e,n),this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayParams",level:"info",time:Date.now(),data:{url_path:t,title:e,url:n},infoType:"cus"})},t.prototype.reset=function(t,e,n){this.disable(),this.enable(t,e,n)},t.prototype.resetStayDuration=function(t,e,n){this.reset(t,e,n),this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayDuration",level:"info",time:Date.now(),data:{url_path:t,title:e,url:n},infoType:"sdk"})},t}();try{var Ne=vt();Ne&&(Ne.LogStay=function(t,e){(new Ge).apply(t,e)})}catch(t){console.log(t)}var Le=function(){function t(){var t=this;this.setInterval=function(){t.clearIntervalFunc=y(function(){t.isSessionhasEvent&&t.endCurrentSession()},t.sessionInterval)},this.clearInterval=function(){t.clearIntervalFunc&&t.clearIntervalFunc()}}return t.prototype.apply=function(t,e){var n=this;if(this.collect=t,!e.disable_heartbeat){this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval();var i=this.collect.Types;this.collect.on(i.SessionResetTime,function(){n.process()})}},t.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},t.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var t=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-t>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},t}(),Pe=function(){function t(){}return t.prototype.apply=function(t,e){var n=this;if(this.collect=t,this.config=e,!this.config.channel_domain&&!(this.config.disable_track_event||this.config.disable_sdk_monitor||this.config.enable_encryption)){var i=t.adapters.fetch;this.fetch=i,this.url=t.configManager.getUrl("event");var o=this.collect.Types;this.collect.on(o.Ready,function(){n.sdkOnload()}),this.collect.on(o.SubmitError,function(t){var e=t.type,i=t.eventData,o=t.errorCode;"f_data"===e&&n.sdkError(i,o)})}},t.prototype.sdkOnload=function(){var t=this;try{var e=this.collect.configManager.get(),n=e.header,i=e.user,o=n.app_id,r=n.app_name,a=n.sdk_version,s=i.web_id,c=i.anonymous_id,u={events:[{event:"onload",params:JSON.stringify({app_id:o,app_name:r||"",sdk_version:a,sdk_type:"script",sdk_config:this.config,sdk_desc:"TOB"}),local_time_ms:Date.now()}],user:{user_unique_id:this.config.enable_anonymousid?c:s},header:{}};setTimeout(function(){t.collect.requestManager.useRequest({url:t.url,data:[u],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})},16)}catch(t){}},t.prototype.sdkError=function(t,e){var n=this;try{var i=t[0],o=i.user,r=i.header,a=[];t.forEach(function(t){t.events.forEach(function(t){a.push(t)})});var s={events:a.map(function(t){return{event:"on_error",params:JSON.stringify({error_code:e,app_id:r.app_id,app_name:r.app_name||"",error_event:t.event,sdk_version:r.sdk_version,local_time_ms:t.local_time_ms,tea_event_index:Date.now(),params:t.params,header:JSON.stringify(r),user:JSON.stringify(o)}),local_time_ms:Date.now()}}),user:{user_unique_id:o.user_unique_id},header:{}};setTimeout(function(){n.collect.requestManager.useRequest({url:n.url,data:[s],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})},16)}catch(t){}},t}();function Ue(t,e){if(void 0===e&&(e="list"),!t)return!1;if(e&&"list"===e){if(["LI","TR","DL"].includes(t.nodeName))return!0;if(t.dataset&&t.dataset.hasOwnProperty("teaIdx"))return!0;if(t.hasAttribute&&t.hasAttribute("data-tea-idx"))return!0}else{if(["A","BUTTON"].includes(t.nodeName))return!0;if(t.dataset&&t.dataset.hasOwnProperty("teaContainer"))return!0;if(t.hasAttribute&&t.hasAttribute("data-tea-container"))return!0;if(t.hasAttribute&&Ke(t,"ss"))return!0}return!1}var ze=function(t,e){return!!Ke(t,e)};function je(t){for(var e=t;e&&!Ue(e,"container");){if("HTML"===e.nodeName||"BODY"===e.nodeName)return t;e=e.parentElement}return e||t}var Fe=function(t){if(!t)return"";var e="";return t.textContent?e=t.textContent.trim():t.innerText&&(e=t.innerText.trim()),"input"!==t.tagName&&"INPUT"!==t.tagName||(e=t.value||""),e};function qe(t){for(var e=t;e&&e.parentNode;){if(e.hasAttribute("data-tea-ignore"))return!0;if("HTML"===e.nodeName||"body"===e.nodeName)return!1;e=e.parentNode}return!1}var Ve=function(t,e){return t.hasAttribute?t.hasAttribute(e):t.attributes?!(!t.attributes[e]||!t.attributes[e].specified):void 0},Ke=function(t,e){if("string"==typeof e)return Ve(t,e);if(c(e)){for(var n=!1,i=0;i<e.length;i++){if(Ve(t,e[i])){n=!0;break}}return n}},He=function(t,e){var n={};if("string"==typeof e)Ve(t,e)&&(n[e]=t.getAttribute(e));else if(c(e))for(var i=0;i<e.length;i++){Ve(t,e[i])&&(n[e[i]]=t.getAttribute(e[i]))}return n},Je=function(t){if(t.children.length){var e=t.children;return![].slice.call(e).some(function(t){return t.children.length>0})}return!0},We=function(t){if("svg"===t.tagName.toLowerCase())return!0;for(var e=t.parentElement,n=!1;e;)"svg"===e.tagName.toLowerCase()?(e=null,n=!0):e=e.parentElement;return n};var Xe=function(){function e(e,n,i){var o=this;this.clickEvent=function(t){(function(t,e){if(1!==t.nodeType)return!1;if(!e.svg&&We(t))return!1;if(["HTML","BODY"].includes(t.tagName.toUpperCase()))return!1;var n=t;return!!("none"!==n.style.display&&(Ue(n,"container")||e.track_attr&&ze(n,e.track_attr)||Je(n)))})(t.target,o.options)&&o.eventHandel({eventType:"dom",eventName:"click"},t)},this.changeEvent=function(t){o.eventHandel({eventType:"dom",eventName:"change"},t)},this.submitEvent=function(t){o.eventHandel({eventType:"dom",eventName:"submit"},t)},this.getPageViewEvent=function(e,n){n&&"pushState"===n&&o.eventHandel({eventType:"dom",eventName:"beat"},t({beat_type:0},e)),o.eventHandel({eventType:"dom",eventName:"page_view"},e)},this.getPageLoadEvent=function(t){o.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:t})},this.config=i.getConfig().eventConfig,this.collect=n,this.options=e,this.beatTime=e.beat,this.statistics=!1}return e.prototype.init=function(t){this.eventHandel=t;var e=this.config.mode;this.addListener(e)},e.prototype.addListener=function(t){var e=this;if("proxy-capturing"===t&&(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv&&this.collect.on("route-change",function(t){var n=t.config,i=t.name;e.getPageViewEvent(n,i)}),this.config.beat)){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",function(){e.beatEvent(e.beatTime)});var n=0,i=null;window.addEventListener("scroll",function(){clearTimeout(i),i=setTimeout(o,500),n=document.documentElement.scrollTop||document.body.scrollTop});var o=function(){(document.documentElement.scrollTop||document.body.scrollTop)==n&&e.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})}}catch(t){}try{var r=window.performance&&window.performance.getEntriesByType("paint");if(r&&r.length)new PerformanceObserver(function(t){var n=t.getEntries(),i=n[n.length-1],o=i.renderTime||i.loadTime;e.statistics||(e.getPageLoadEvent(o),e.statistics=!0)}).observe({entryTypes:["largest-contentful-paint"]}),setTimeout(function(){e.statistics||(e.getPageLoadEvent(r[0].startTime||0),e.statistics=!0)},2e3);else this.getPageLoadEvent(0)}catch(t){this.getPageLoadEvent(0)}}},e.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},e.prototype.beatEvent=function(t){var e=this;try{var n;this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(n=setInterval(function(){e.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})},t)),g(function(){e.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),e.beatTime&&clearInterval(n)})}catch(t){}},e}(),$e={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},Ze=function(){function t(t,e){this.config=t,this.config.eventConfig=Object.assign(this.config.eventConfig,e)}return t.prototype.getConfig=function(){return this.config},t.prototype.setConfig=function(t){return this.config=t},t}();function Qe(t){for(var e=[];null!==t.parentElement;)e.push(t),t=t.parentElement;var n=[],i=[];return e.forEach(function(t){var e=function(t){if(null===t)return{str:"",index:0};var e=0,n=t.parentElement;if(n)for(var i=n.children,o=0;o<i.length&&i[o]!==t;o++)i[o].nodeName===t.nodeName&&e++;return{str:[t.nodeName.toLowerCase(),Ue(t,"list")?"[]":""].join(""),index:e}}(t),o=e.str,r=e.index;n.unshift(o),i.unshift(r)}),{element_path:"/".concat(n.join("/")),positions:i}}function Ye(t,e,n,i){var o={},r=function(t){if(t){var e=t.getBoundingClientRect(),n=e.width,i=e.height;return{left:e.left,top:e.top,element_width:n,element_height:i}}}(e),a=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var n=t.clientX,i=t.clientY,o=e.left,r=e.top,a=n-o>=0?n-o:0,s=i-r>=0?i-r:0;return{touch_x:Math.floor(a),touch_y:Math.floor(s)}}(t,r),s=r.element_width,c=r.element_height,u=a.touch_x,l=a.touch_y,h=Qe(e),f=h.element_path,p=h.positions,d=function(t){var e=je(t),n=[];return function t(e){var i=function(t){var e="";return 3===t.nodeType?e=t.textContent.trim():t.dataset&&t.dataset.hasOwnProperty("teaTitle")?e=t.getAttribute("data-tea-title"):t.hasAttribute("ata-tea-title")?e=t.getAttribute("data-tea-title"):t.hasAttribute("title")?e=t.getAttribute("title"):"INPUT"===t.nodeName&&["button","submit"].includes(t.getAttribute("type"))?e=t.getAttribute("value"):"IMG"===t.nodeName&&t.getAttribute("alt")&&(e=t.getAttribute("alt")),e.slice(0,200)}(e);if(i&&-1===n.indexOf(i)&&n.push(i),e.childNodes.length>0)for(var o=e.childNodes,r=0;r<o.length;r++)8!==o[r].nodeType&&t(o[r])}(e),n}(e),g=window.performance.timing.navigationStart,v=Date.now()-g,m=p.map(function(t){return"".concat(t)}),y=null;if(window.TEAVisualEditor&&window.TEAVisualEditor.getOriginXpath&&(y=window.TEAVisualEditor.getOriginXpath({xpath:f,positions:m})),o.element_path=y&&y.xpath||f,o.positions=y&&y.positions||m,i&&!i.text&&(o.texts=d,o.element_title=Fe(e)),o.element_id=e.getAttribute("id")||"",o.element_class_name=e.getAttribute("class")||"",o.element_type=e.nodeType,o.element_width=Math.floor(s),o.element_height=Math.floor(c),o.touch_x=u,o.touch_y=l,o.page_manual_key="",o.elememt_manual_key="",o.since_page_start_ms=v,o.page_start_ms=g,o.page_path=location.pathname,o.page_host=location.host,n.track_attr&&ze(e,n.track_attr)){var _=He(e,n.track_attr);for(var b in _)o[b]=_[b]}if(n.custom_attr)try{if(ze(e,n.custom_attr)){_=He(e,n.custom_attr),b=decodeURIComponent(_[n.custom_attr]);var E=JSON.parse(b);if(Object.keys(E))for(var S in E)o[S]=E[S]}}catch(t){console.log("custom attr error")}var w=je(e);return"A"===w.tagName&&(o.href=w.getAttribute("href")),!1!==n.src&&("IMG"!==e.tagName||e.getAttribute("src").includes("base64")||(o.src=e.getAttribute("src"))),o}var tn=function(e,n,i,o,r){return t(t({event:e},Ye(n,i,o,r)),{is_html:1,page_key:window.location.href,page_title:document.title})},en=function(){function e(t,e){this.ignore={text:!1},this.initConfig=t,this.options=e,this.eventName=e&&"tea"===e.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics",exposure:"__bav_page_exposure"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics",exposure:"$bav2b_exposure",scroll:"$bav2b_slide"},e&&!1===e.text&&(this.ignore.text=!0),e&&e.exposure&&e.exposure.eventName&&(this.eventName.exposure=e.exposure.eventName),e&&e.scroll&&e.scroll.eventName&&(this.eventName.scroll=e.scroll.eventName)}return e.prototype.handleEvent=function(e,n){try{if(qe(e.target))return null;var i="bav2b_click";switch(n){case"click":return i=this.eventName.click,tn(i,e,e.target,this.options,this.ignore);case"change":return t(t({},tn(i="bav2b_change",e,e.target,this.options)),function(t,e){try{if("bav2b_change"===t)return e.hasAttribute("data-tea-track")?{value:e.value}:{}}catch(t){return{}}}(i,e.target));case"submit":return tn(i="bav2b_submit",e,e.target,this.options)}}catch(t){return console.error(t),null}},e.prototype.handleViewEvent=function(t){t.event=this.eventName.page,t.page_title=document.title,t.page_total_width=window.innerWidth,t.page_total_height=window.innerHeight;try{var e=window.sessionStorage&&window.sessionStorage.getItem("_tea_cache_duration");if(e){var n=JSON.parse(e);t.refer_page_duration_ms=n?n.duration:""}t.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,t.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,t.page_start_ms=window.performance.timing.navigationStart}catch(t){console.log("page event error ".concat(JSON.stringify(t)))}return t},e.prototype.handleStatisticsEvent=function(t){var e={};e.event=this.eventName.static,e.is_html=1,e.page_key=location.href,e.refer_page_key=document.referrer||"",e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"",e.refer_page_manual_key="";try{var n=t.lcp,i=window.performance.timing,o=i.loadEventEnd-i.navigationStart;e.page_init_cost_ms=parseInt(n||(o>0?o:0)),e.page_start_ms=i.navigationStart}catch(t){console.log("page_statistics event error ".concat(JSON.stringify(t)))}return e},e.prototype.handleBeadtEvent=function(t){t.event=this.eventName.beat,t.page_key=window.location.href,t.is_html=1,t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{t.page_viewport_width=window.innerWidth,t.page_viewport_height=window.innerHeight,t.page_total_width=document.documentElement.scrollWidth,t.page_total_height=document.documentElement.scrollHeight,t.scroll_width=document.documentElement.scrollLeft+window.innerWidth,t.scroll_height=document.documentElement.scrollTop+window.innerHeight,t.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,t.page_start_ms=window.performance.timing.navigationStart}catch(t){console.log("beat event error ".concat(JSON.stringify(t)))}return t},e.prototype.handleExposureEvent=function(t,e){if(qe(e.target))return null;var n=tn(t.event||this.eventName.exposure,e,e.target||e,this.options,this.ignore);if(n.$exposure_type=t.exposureType,this.options.exposure.callback){var i=this.options.exposure.callback(n);return i||Object.keys(i).length?i:(console.warn("exposure callback must return data!"),n)}return n},e.prototype.handleScrollEvent=function(t,e){var n=tn(t.event||this.eventName.scroll,e,e.target||e,this.options,this.ignore);if(n=Object.assign(n,t.params),!this.options.scroll.callback||(n=this.options.scroll.callback(n))||Object.keys(n).length)return n;console.warn("scroll callback must return data!")},e}(),nn=function(){function t(t){this.collect=t}return t.prototype.send=function(t,e){var n=e.event;delete e.event,t&&"becon"===t.eventSend?this.collect.beconEvent(n,e):this.collect.event(n,e)},t.prototype.get=function(t,e){var n=Object.assign({headers:{"content-type":"application/json"},method:"GET"},e);fetch(t,n)},t.prototype.post=function(t,e){var n=Object.assign({headers:{"content-type":"application/json"},method:"POST"},e);fetch(t,n)},t}(),on="_TEA_VE_OPEN",rn="_TEA_VE_APIHOST",an="lang",sn="_VISUAL_EDITOR_V",cn="_VISUAL_EDITOR_U";function un(){try{var t=window.TEAVisualEditor.lang=window.TEAVisualEditor.lang||x.get(an),e=window.TEAVisualEditor.__editor_ajax_domain=window.TEAVisualEditor.__editor_ajax_domain||x.get(rn),n=window.TEAVisualEditor.__editor_verison=window.TEAVisualEditor.__editor_verison||x.get(sn),i=window.TEAVisualEditor.__editor_url=window.TEAVisualEditor.__editor_url||x.get(cn),o=+new Date,r=new Date(o+18e5);x.set(on,"1",{expires:r}),x.set(rn,e,{expires:r}),x.set(cn,i,{expires:r}),x.set(an,t,{expires:r}),x.set(sn,n||"",{expires:r})}catch(t){console.log("set cookie err")}}var ln=!1;function hn(t){var e=t.event,n=t.editorUrl,i=t.autoTrackInstance;ln||(ln=!0,v(n,function(){we(e,"editorScriptloadSuccess"),i.destroy()},function(){e&&we(e,"editorScriptloadError"),ln=!1}))}function fn(t,e){window.TEAVisualEditor=window.TEAVisualEditor||{};var n="",i="".concat(j,"?query=").concat(Date.now());window.TEAVisualEditor.appId=e.app_id;var o=e.channel_domain,r="";if(Se(["*"]),o){var a,s="";try{var c=window.performance.getEntriesByType("resource");if(c&&c.length&&(c.forEach(function(t){"script"===t.initiatorType&&t.name&&-1!==t.name.indexOf("collect")&&(s=t.name)}),s||document.currentScript&&(s=document.currentScript.src),s&&(a=s.split("/"))&&a.length)){r="https:/";for(var u=2;u<a.length&&u!==a.length-1;u++)r+="/".concat(a[u]);if(r&&r.indexOf("/5.0")){var l=r.split("/5.0");r=l[0]||r}}}catch(t){}}if(De(e,L),"1"===x.get(on)){var h=function(){var t=x.get(rn);try{t=JSON.parse(t)}catch(t){}return t}(),f="";h&&(window.TEAVisualEditor.__editor_ajax_domain=h,f=x.get(cn)),hn({event:null,editorUrl:f||i,autoTrackInstance:t}),un()}else try{Te("tea:openVisualEditor",function(e){var a=e.data;if("string"==typeof e.data)try{a=JSON.parse(e.data)}catch(t){a=void 0}if(a){var s=a.referrer,c=a.lang;if(s&&(window.TEAVisualEditor.__editor_ajax_domain=s),n=i,o){var u=a.version,l=u?"/visual-editor-rangers-v".concat(u):"/visual-editor-rangers-v1.0.0";n=r?"".concat(r).concat(l,".js"):i,window.TEAVisualEditor.__editor_verison=u}window.TEAVisualEditor.__editor_url=n,window.TEAVisualEditor.lang=c,hn({event:e,editorUrl:n,autoTrackInstance:t}),un()}}),window.TEAVisualEditor.openAutotrackEditor=function(){hn({event:null,editorUrl:window.TEAVisualEditor.__editor_url,autoTrackInstance:t})}}catch(t){console.log("receive message error")}try{Te("tea:openHeatMapCore",function(e){var n=q;n=o&&r?"".concat(r,"/heatmap-core.2.2.0"):"".concat(n,".2.2.0"),hn({event:e,editorUrl:"".concat(n,".js?query=").concat(Date.now()),autoTrackInstance:t})})}catch(t){console.log("openHeatMapCore error")}}var pn,dn=function(){function t(t,e){this._instance=null,this._intersection=t,this.config=e,this._intersection&&this.init()}return t.prototype.init=function(){var t=this;if(window.MutationObserver)try{if(this._instance=new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&t.attributeChangeObserve(e),"childList"===e.type&&t.modifyNodeObserve(e)})}),!document||!document.body)return void console.warn("please use sdk api init after body element");var e=!1!==this.config.autotrack.exposure.attributes;this._instance.observe(document.body,{childList:!0,attributes:e,subtree:!0,attributeOldValue:!1})}catch(t){console.log("your browser cannot support MutationObserver，so cannot report exposure event, please update")}else console.log("your browser cannot support MutationObserver，so cannot report exposure event, please update")},t.prototype.attributeChangeObserve=function(t){t.target.hasAttribute("data-exposure")?this.exposureAdd(t,"mutation"):this.exposureRemove(t)},t.prototype.modifyNodeObserve=function(t){var e=this;Array.prototype.forEach.call(t.addedNodes,function(t){1===t.nodeType&&t.hasAttribute("data-exposure")&&e.exposureAdd(t,"intersect"),e.mapChild(t,e.exposureAdd.bind(e))}),Array.prototype.forEach.call(t.removedNodes,function(t){1===t.nodeType&&t.hasAttribute("data-exposure")&&e.exposureRemove(t),e.mapChild(t,e.exposureRemove.bind(e))})},t.prototype.mapChild=function(t,e){var n=this;1===t.nodeType&&t.children.length&&Array.prototype.forEach.call(t.children,function(t){1===t.nodeType&&t.hasAttribute("data-exposure")&&e(t),n.mapChild(t,e)})},t.prototype.exposureAdd=function(t,e){try{this._intersection&&this._intersection.exposureAdd(t,e)}catch(t){console.log("intersection error",JSON.stringify(t.message))}},t.prototype.exposureRemove=function(t){try{this._intersection&&this._intersection.exposureRemove(t)}catch(t){console.log("intersection error",JSON.stringify(t.message))}},t._exposure_observer=null,t}();!function(t){t[t.EXPOSURE_ONCE=0]="EXPOSURE_ONCE",t[t.LIFECYCLE_SHOW_NEW=3]="LIFECYCLE_SHOW_NEW",t[t.RESUME_FORM_PAGE=6]="RESUME_FORM_PAGE",t[t.RESUME_FORM_BACK=7]="RESUME_FORM_BACK",t[t.NOT_EXPOSURE=-1]="NOT_EXPOSURE"}(pn||(pn={}));var gn,vn=function(){function t(e,n,i){var o=this;this.backStatus=!1,this.instance=this.buildObserver(),this.collect=e,this.observeMap=t._observer_map,n.autotrack.exposure.ratio?this.ratio=n.autotrack.exposure.ratio:0===n.autotrack.exposure.ratio?this.ratio=0:this.ratio=.5,this.timeLimit=n.autotrack.exposure.stay||0,this.exposureType=pn.NOT_EXPOSURE,this.eventHandle=i,this.hashMap=new Map,this.backStatus=!1,this.lastState=null,this.collect.on("re-start-sdk",function(){o.visibilitychange()}),this.addListen()}return t.prototype.buildObserver=function(){var e=this;if(t._observer_instance)return console.log("your browser cannot support IntersectionObserver， so cannot report exposure event, please update"),null;if(window.IntersectionObserver){for(var n=[],i=0;i<=1;i+=.01)n.push(i);n.push(1);try{t._observer_instance=new IntersectionObserver(function(t){t.forEach(function(t){var n=t.target.observeId,i=e.observeMap.get(n),o=(t.target,t.isIntersecting,t.intersectionRatio);if(i.intersectionRatio=o,o<=.1&&(t.target.backStatus=!1),e.observeMap.set(n,i),o<e.ratio)return i.isIntersecting=!1,i.added=!1,i.exposured=!1,i.startTime=Date.now(),void e.observeMap.set(n,i);if(!i.added){if(i.startTime=Date.now(),i.added=!0,i.isIntersecting=!0,e.timeLimit){var r=setTimeout(function(){try{if(i.isIntersecting&&!i.exposured&&e.observeMap.get(n)){var o=e.observeMap.get(n).intersectionRatio;e.exposureEvent(t,o,n,i)}}catch(t){console.log("IntersectionObserver setTimeout error，msg: ".concat(JSON.stringify(t)))}},e.timeLimit);i.wait=r}e.observeMap.set(n,i)}Date.now()-i.startTime>=e.timeLimit&&!i.exposured&&e.exposureEvent(t,o,n,i)})},{threshold:n})}catch(t){console.log("IntersectionObserver error，msg: ".concat(JSON.stringify(t)))}return t._observer_instance}return console.log("your browser cannot support IntersectionObserver， so cannot report exposure event, please update"),null},t.prototype.exposureAdd=function(t,e){var n="mutation"===e?t.target:t,i=n.observeId,o=ct();if(i||this.observeMap.has(i)){var r=this.observeMap.get(i);if(r&&n!==r.instance)this.unobserve(n),this.observeMap.delete(i),n.observeId=o,n.visible=!1,this.observeMap.set(o,{instance:n.cloneNode(!0),isIntersecting:!1}),this.observe(n);else{if(!0===n.visible)return;this.handleBoundingExposure(n)}}else n.observeId=o,n.visible=!1,this.observeMap.set(o,{instance:n.cloneNode(!0),isIntersecting:!1}),this.observe(n)},t.prototype.exposureRemove=function(t){this.observeMap.has(t.observeId)&&(this.observeMap.delete(t.observeId),this.unobserve(t),t.observeId="",t.visible=!1)},t.prototype.exposureEvent=function(t,e,n,i){if(e>=this.ratio){if("0"===t.target.style.opacity||"hidden"===t.target.style.visibility)return;if(!0===i.exposured)return;i.startWait&&clearTimeout(i.startWait);var o=t.target.getAttribute("data-exposure-event");this.eventHandle({eventType:"dom",eventName:"exposure",event:o,exposureType:this.getExposureType(t.target)},t),t.target.visible=!0,t.target.hasExposure=!0,i.startTime=Date.now(),i.exposured=!0}else i.startTime=Date.now(),i.exposured=!1;this.observeMap.set(n,i)},t.prototype.observe=function(t){this.instance&&this.instance.observe(t)},t.prototype.unobserve=function(t){this.instance&&this.instance.unobserve(t)},t.prototype.getExposureDomToExposure=function(){var t=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),function(e){t.handleBoundingExposure(e)})},t.prototype.visibilitychange=function(){var t=this,e=null;"visible"===document.visibilityState?this.timeLimit?e=setTimeout(function(){t.getExposureDomToExposure()},this.timeLimit):this.getExposureDomToExposure():(clearTimeout(e),this.customType=void 0)},t.prototype.handleBoundingExposure=function(t){if(this.getBoundingRatio(t)>=this.ratio){t.visible=!0;var e=t.getAttribute&&t.getAttribute("data-exposure-event");this.eventHandle({eventType:"dom",eventName:"exposure",event:e,exposureType:this.customType||pn.RESUME_FORM_BACK},t)}},t.prototype.getBoundingRatio=function(t){var e=t.getBoundingClientRect(),n=e.top,i=e.left,o=e.width,r=e.height,a=window.innerWidth||document.documentElement.clientWidth,s=window.innerHeight||document.documentElement.clientHeight;return n>=0&&i>=0&&n<=s&&i<=a?(o>a?a:o)*(s-n)/(o*r):0},t.prototype.getExposureType=function(t){return t.visible?!1!==t.backStatus&&(this.backStatus||this.customType||2===window.performance.navigation.type)?this.exposureType=pn.RESUME_FORM_PAGE:this.exposureType=pn.LIFECYCLE_SHOW_NEW:(t.hasExposure,!1!==t.backStatus&&(this.backStatus||this.customType||2===window.performance.navigation.type)?this.exposureType=pn.RESUME_FORM_PAGE:this.exposureType=pn.EXPOSURE_ONCE),this.exposureType},t.prototype.addListen=function(){var t=this;this.collect.on("set-exposure-type",function(e){t.customType=e});var e=this.visibilitychange.bind(this);if(f(document,"visibilitychange",e,!1),window.addEventListener("hashchange",function(e){var n=t.hashMap.get(e.oldURL);n&&location.href===n.prev?(t.backStatus=!0,t.exposureType=pn.RESUME_FORM_PAGE):(t.backStatus=!1,t.hashMap.set(location.href,{current:e.newURL,prev:e.oldURL}))}),this.collect.bridgeReport){var n=window.history.pushState;history.pushState=function(e){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];"function"==typeof history.onpushstate&&history.onpushstate({state:e});var s=n.call.apply(n,o([history,e],i(r)));return t.lastState=e,s};var r=history.replaceState;history.replaceState=function(e){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];"function"==typeof history.onreplacestate&&history.onreplacestate({state:e});var s=r.call.apply(r,o([history,e],i(n)));return t.lastState=e,s}}else this.collect.on("STATE_CHANGE",function(e){t.lastState=e});return window.addEventListener("popstate",function(e){var n=e.state;n&&n.current&&t.lastState&&t.lastState.back&&n.current===t.lastState.back?(t.backStatus=!0,t.exposureType=pn.RESUME_FORM_PAGE):t.backStatus=!1}),function(){p(document,"visibilitychange",e,!1)}},t._observer_instance=null,t._observer_map=new Map,t}(),mn=function(){function t(t,e,n){e.autotrack&&e.autotrack.exposure&&(this._intersection=new vn(t,e,n),this._observer=new dn(this._intersection,e),this._intersection&&this._observer?this.initObserver():console.log("your browser version cannot support exposure event, please update~"))}return t.prototype.initObserver=function(){var t=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),function(e){t._intersection.exposureAdd(e,"intersect")})},t}();!function(t){t[t.SCROLL_UP=1]="SCROLL_UP",t[t.SCROLL_DOWN=2]="SCROLL_DOWN",t[t.SCROLL_LEFT=3]="SCROLL_LEFT",t[t.SCROLL_RIGHT=4]="SCROLL_RIGHT",t[t.NOT_SCROLL=-1]="NOT_SCROLL"}(gn||(gn={}));var yn,_n=function(){function t(t,e){this.distance=30,t.autotrack&&t.autotrack.scroll&&(t.autotrack.scroll.distance&&(this.distance=t.autotrack.scroll.distance),this.eventHandle=e,this.addLinstenr(),this.mutation())}return t.prototype.addLinstenr=function(){var t=this;Array.prototype.forEach.call(document.querySelectorAll("[data-scroll]"),function(e){t.scrollHandle(e)})},t.prototype.mutation=function(){var t=this;if(window.MutationObserver)try{var e=new MutationObserver(function(e){e.forEach(function(e){"childList"===e.type&&t.modifyNodeObserve(e)})});if(!document||!document.body)return void console.warn("please use sdk api init after body element");e.observe(document.body,{childList:!0,attributes:!0,subtree:!0,attributeOldValue:!1})}catch(t){console.log("your browser cannot support MutationObserver")}else console.log("your browser cannot support MutationObserver")},t.prototype.modifyNodeObserve=function(t){var e=this;Array.prototype.forEach.call(t.addedNodes,function(t){1===t.nodeType&&t.hasAttribute("data-scroll")&&e.scrollHandle(t),e.mapChild(t,e.scrollHandle.bind(e))}),Array.prototype.forEach.call(t.removedNodes,function(t){1===t.nodeType&&t.hasAttribute("data-scroll")&&e.scrollHandle(t,"remove"),e.mapChild(t,e.scrollHandle.bind(e))})},t.prototype.mapChild=function(t,e){var n=this;1===t.nodeType&&t.children.length&&Array.prototype.forEach.call(t.children,function(t){1===t.nodeType&&t.hasAttribute("data-scroll")&&e(t),n.mapChild(t,e)})},t.prototype.scrollHandle=function(t,e){var n=this;try{var i=t.scrollTop,o=t.scrollLeft,r=null,a=0,s=0,c=function(e){clearTimeout(r),r=setTimeout(function(){var r=t.scrollTop,h=t.scrollLeft,f=e.target&&e.target.getAttribute("data-scroll-event")||"";1===l||2===l?r===c&&(s=c-i,Math.abs(s)>=n.distance&&n.distance&&n.eventHandle({eventType:"dom",eventName:"scroll",event:f,params:{$direction:l,$offsetY:s,$offsetX:a}},e)):3!==l&&4!==l||h===u&&(a=u-o,Math.abs(a)>=n.distance&&n.distance&&n.eventHandle({eventType:"dom",eventName:"scroll",event:f,params:{$direction:l,$offsetY:s,$offsetX:a}},e)),i=c,o=u},100);var c=t.scrollTop,u=t.scrollLeft,l=gn.NOT_SCROLL;c>i?l=gn.SCROLL_DOWN:c<i?l=gn.SCROLL_UP:u>o?l=gn.SCROLL_LEFT:u<o&&(l=gn.SCROLL_RIGHT)};return"remove"===e?t.removeEventListener("scroll",c,!1):t.addEventListener("scroll",c,!1),function(){t.removeEventListener("scroll",c,!1)}}catch(t){console.warn("scroll event error",JSON.stringify(t))}},t}(),bn={hashTag:!1,impr:!1},En=function(){function t(){}return t.prototype.apply=function(t,e){if(this.autoTrackStart=!1,this.collect=t,this.config=e,e.autotrack){var n=t.configManager.getSettingData("bav_log_collect");if((!u(n)||n)&&(!e.autotrack||!e.autotrack.collect_url||e.autotrack.collect_url())){var i=t.Types;this.ready(i.Autotrack),this.collect.emit(i.AutotrackReady)}}},t.prototype.ready=function(t){this.collect.set(t);var e=this.config.autotrack;e="object"==typeof e?e:{},e=Object.assign(bn,e),this.destroyed=!1,this.options=e,this.Config=new Ze($e,this.options),this.Exposure=new mn(this.collect,this.config,this.handle.bind(this)),this.Scroll=new _n(this.config,this.handle.bind(this)),this.Listener=new Xe(e,this.collect,this.Config),this.EventHandle=new en(this.config,e),this.Request=new nn(this.collect),this.autoTrackStart=!0,this.init(),fn(this,this.config)},t.prototype.init=function(){this.Listener.init(this.handle.bind(this))},t.prototype.handle=function(t,e){try{if(this.config.autotrack.collect_url&&!this.config.autotrack.collect_url())return}catch(t){}this.collect.sdkStop||"dom"===t.eventType&&this.handleDom(t,e)},t.prototype.handleDom=function(t,e){try{var n=t.eventName;if("click"===n||"change"===n||"submit"===n)(a=this.EventHandle.handleEvent(e,n))&&this.Request.send({eventType:"custom"},a);else if("page_view"===n||"page_statistics"===n){var i=void 0;(i="page_view"===n?this.EventHandle.handleViewEvent(e):this.EventHandle.handleStatisticsEvent(e))&&this.Request.send({eventType:"custom"},i)}else if("beat"===n){var o=this.EventHandle.handleBeadtEvent(e),r=t.eventSend;o&&this.Request.send({eventType:"custom",eventSend:r},o)}else if("exposure"===n){(a=this.EventHandle.handleExposureEvent(t,e))&&this.Request.send({eventType:"custom"},a)}else if("scroll"===n){var a;(a=this.EventHandle.handleScrollEvent(t,e))&&this.Request.send({eventType:"custom"},a)}}catch(t){console.log("handel dom event error ".concat(JSON.stringify(t)))}},t.prototype.destroy=function(){if(!this.autoTrackStart)return console.warn("engine is undefined, make sure you have called autoTrack.start()");this.autoTrackStart=!1,this.Listener.removeListener()},t}();try{var Sn=vt();Sn&&(Sn.LogAutoTrack=function(t,e){(new En).apply(t,e)})}catch(t){}!function(t){t.Net="net",t.FailNet="f_net",t.FailData="f_data"}(yn||(yn={}));var wn={pv:["predefine_pageview"],sdk:["_be_active","predefine_page_alive","predefine_page_close","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],autotrack:["bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","__bav_click","__bav_page","__bav_beat","__bav_page_statistics"]},Tn=function(){function t(){}return t.prototype.apply=function(t,e){var n=this;if(this.ready=e.app_id&&e.enable_tracer&&!e.disable_track_event,this.ready){this.limit={pv:1,sdk:3,autotrack:3,log:3},this.errorCode={f_net:0,f_data:0},this.tracerCache=new Map,this.collect=t,this.appid=e.app_id,this.reportUrl=t.configManager.getUrl("event");var i=this.collect.Types,o=t.adapters.fetch;this.fetch=o,this.collect.on(i.Event,function(){n.addCount("log")}),this.collect.on(i.SubmitError,function(t){var e=t.type,i=t.eventDate,o=t.errorCode,r=t.response;n.addErrorCount(i,e,o,r)}),this.listener(),this.collect.emit(i.TracerReady)}},t.prototype.addCount=function(t,e,n){void 0===e&&(e="net"),void 0===n&&(n=1);try{this.tracerCache||(this.tracerCache=new Map);var i=void 0;if(this.tracerCache.has(t)){if((o=this.tracerCache.get(t)).has(e))i=o.get(e).params.count,i++,o.set(e,this.processTracer(i,t,e));else i=n,o.set(e,this.processTracer(n,t,e))}else{var o=new Map;i=n,o.set(e,this.processTracer(n,t,e)),this.tracerCache.set(t,o)}"net"===e&&i>=this.limit[t]&&this.report(!1)}catch(t){console.log(t)}},t.prototype.addErrorCount=function(t,e,n,i){var o=this;try{if(t&&t.length){var r=t[0].events;r&&r.length&&("f_data"===e?(i&&i.hasOwnProperty("sc")?this.addCount("log",e,r.length-i.sc):this.addCount("log",e,r.length),this.errorCode[e]=n):r.forEach(function(t){var i="log";for(var r in wn)if(-1!==wn[r].indexOf(t.event)){i=r;break}o.addCount(i,e,1),o.errorCode[e]=n}))}}catch(t){}},t.prototype.report=function(t){if(this.tracerCache){var e=[];this.tracerCache.forEach(function(t){console.log(t),t.forEach(function(t){e.push(t)})}),e&&e.length&&this.sendTracer(e,t)}},t.prototype.sendTracer=function(t,e){try{var n=this.collect.eventManager.merge(t);e&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify(n)):this.fetch(this.reportUrl,n),this.tracerCache=null}catch(t){}},t.prototype.processTracer=function(t,e,n){var i={count:t,state:n,key:e,params_for_special:"applog_trace",aid:this.appid,platform:"web",_staging_flag:1,sdk_version:L};"f_net"!==n&&"f_data"!==n||(i.errorCode=this.errorCode[n]);var o=this.collect.processEvent("applog_trace",i);if(o&&o.event)return delete o.is_bav,o},t.prototype.listener=function(){var t=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&t.leavePage()}),g(function(){t.leavePage()})},t.prototype.leavePage=function(){this.report(!0)},t}();try{var kn=vt();kn&&(kn.LogTracer=function(t,e){(new Tn).apply(t,e)})}catch(t){console.log(t)}var Dn=function(){function t(){this.verifyReady=!1,this.cleanStatus=!1}return t.prototype.apply=function(t,e){var n=this;w()||(this.collector=t,this.config=e,this.eventStorage=[],this.collector.on("submit-verify-h5",function(t){t&&t.length&&n.eventStore(t[0])}),this.checkUrl(),this.heartbeat())},t.prototype.checkUrl=function(){var t=window.location.href,e=b(t);e._r_d_&&e._r_c_k_?(this.verifyReady=!0,this.domain=e._r_d_,this.key=e._r_c_k_,this.checkCache()):this.collector.off("submit-verify-h5")},t.prototype.checkCache=function(){this.eventStorage.length&&this.postVerify(this.eventStorage)},t.prototype.heartbeat=function(){var t=this;this.heart=setInterval(function(){var e={event:"simulator_test__",local_time_ms:Date.now()},n=t.collector.configManager.get(),i=n.header,o={events:[e],user:n.user,header:i};t.eventStore(o)},6e4)},t.prototype.eventStore=function(t){this.cleanStatus||(this.verifyReady?this.postVerify(t):this.eventStorage.push(t))},t.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[],clearInterval(this.heart)},t.prototype.postVerify=function(t){var e=this;try{var n=JSON.parse(JSON.stringify(t));c(t)?n.forEach(function(t){e.fetchLog(t)}):this.fetchLog(n)}catch(t){console.log("web verify post error ~")}},t.prototype.fetchLog=function(t){this.collector.requestManager.useRequest({url:"".concat(this.domain,"/simulator/h5/log?connection_key=").concat(this.key),data:t,timeout:2e4})},t.prototype.leave=function(){var t=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&t.cleanVerify()}),g(function(){t.cleanVerify()})},t}(),An=O(function(t,e){t.exports=function t(e,n,i){function o(a,s){if(!n[a]){if(!e[a]){var c=I;if(!s&&c)return c(a,!0);if(r)return r(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return o(n||t)},l,l.exports,t,e,n,i)}return n[a].exports}for(var r=I,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,e,n){(function(t){var n,i,o=t.MutationObserver||t.WebKitMutationObserver;if(o){var r=0,a=new o(l),s=t.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=r=++r%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){l(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(l,0)};else{var c=new t.MessageChannel;c.port1.onmessage=l,n=function(){c.port2.postMessage(0)}}var u=[];function l(){var t,e;i=!0;for(var n=u.length;n;){for(e=u,u=[],t=-1;++t<n;)e[t]();n=u.length}i=!1}e.exports=function(t){1!==u.push(t)||i||n()}}).call(this,void 0!==A?A:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,n){var i=t(1);function o(){}var r={},a=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function u(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,t!==o&&p(this,t)}function l(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(t,e,n){i(function(){var i;try{i=e(n)}catch(e){return r.reject(t,e)}i===t?r.reject(t,new TypeError("Cannot resolve promise with itself")):r.resolve(t,i)})}function f(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function p(t,e){var n=!1;function i(e){n||(n=!0,r.reject(t,e))}function o(e){n||(n=!0,r.resolve(t,e))}var a=d(function(){e(o,i)});"error"===a.status&&i(a.value)}function d(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}e.exports=u,u.prototype.catch=function(t){return this.then(null,t)},u.prototype.then=function(t,e){if("function"!=typeof t&&this.state===s||"function"!=typeof e&&this.state===a)return this;var n=new this.constructor(o);if(this.state!==c){var i=this.state===s?t:e;h(n,i,this.outcome)}else this.queue.push(new l(n,t,e));return n},l.prototype.callFulfilled=function(t){r.resolve(this.promise,t)},l.prototype.otherCallFulfilled=function(t){h(this.promise,this.onFulfilled,t)},l.prototype.callRejected=function(t){r.reject(this.promise,t)},l.prototype.otherCallRejected=function(t){h(this.promise,this.onRejected,t)},r.resolve=function(t,e){var n=d(f,e);if("error"===n.status)return r.reject(t,n.value);var i=n.value;if(i)p(t,i);else{t.state=s,t.outcome=e;for(var o=-1,a=t.queue.length;++o<a;)t.queue[o].callFulfilled(e)}return t},r.reject=function(t,e){t.state=a,t.outcome=e;for(var n=-1,i=t.queue.length;++n<i;)t.queue[n].callRejected(e);return t},u.resolve=function(t){return t instanceof this?t:r.resolve(new this(o),t)},u.reject=function(t){var e=new this(o);return r.reject(e,t)},u.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,i=!1;if(!n)return this.resolve([]);for(var a=new Array(n),s=0,c=-1,u=new this(o);++c<n;)l(t[c],c);return u;function l(t,o){e.resolve(t).then(function(t){a[o]=t,++s!==n||i||(i=!0,r.resolve(u,a))},function(t){i||(i=!0,r.reject(u,t))})}},u.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,i=!1;if(!n)return this.resolve([]);for(var a,s=-1,c=new this(o);++s<n;)a=t[s],e.resolve(a).then(function(t){i||(i=!0,r.resolve(c,t))},function(t){i||(i=!0,r.reject(c,t))});return c}},{1:1}],3:[function(t,e,n){(function(e){"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,void 0!==A?A:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,n){var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();function r(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(r){if("TypeError"!==r.name)throw r;for(var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,i=new n,o=0;o<t.length;o+=1)i.append(t[o]);return i.getBlob(e.type)}}"undefined"==typeof Promise&&t(3);var a=Promise;function s(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}function c(t,e,n){"function"==typeof e&&t.then(e),"function"==typeof n&&t.catch(n)}function u(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function l(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",f=void 0,p={},d=Object.prototype.toString,g="readonly",v="readwrite";function m(t){return"boolean"==typeof f?a.resolve(f):function(t){return new a(function(e){var n=t.transaction(h,v),i=r([""]);n.objectStore(h).put(i,"key"),n.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},n.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||parseInt(t[1],10)>=43)}}).catch(function(){return!1})}(t).then(function(t){return f=t})}function y(t){var e=p[t.name],n={};n.promise=new a(function(t,e){n.resolve=t,n.reject=e}),e.deferredOperations.push(n),e.dbReady?e.dbReady=e.dbReady.then(function(){return n.promise}):e.dbReady=n.promise}function _(t){var e=p[t.name],n=e.deferredOperations.pop();if(n)return n.resolve(),n.promise}function b(t,e){var n=p[t.name],i=n.deferredOperations.pop();if(i)return i.reject(e),i.promise}function E(t,e){return new a(function(n,i){if(p[t.name]=p[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return n(t.db);y(t),t.db.close()}var r=[t.name];e&&r.push(t.version);var a=o.open.apply(o,r);e&&(a.onupgradeneeded=function(e){var n=a.result;try{n.createObjectStore(t.storeName),e.oldVersion<=1&&n.createObjectStore(h)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),a.onerror=function(t){t.preventDefault(),i(a.error)},a.onsuccess=function(){var e=a.result;e.onversionchange=function(t){t.target.close()},n(e),_(t)}})}function S(t){return E(t,!1)}function w(t){return E(t,!0)}function T(t,e){if(!t.db)return!0;var n=!t.db.objectStoreNames.contains(t.storeName),i=t.version<t.db.version,o=t.version>t.db.version;if(i&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),o||n){if(n){var r=t.db.version+1;r>t.version&&(t.version=r)}return!0}return!1}function k(t){var e=function(t){for(var e=t.length,n=new ArrayBuffer(e),i=new Uint8Array(n),o=0;o<e;o++)i[o]=t.charCodeAt(o);return n}(atob(t.data));return r([e],{type:t.type})}function D(t){return t&&t.__local_forage_encoded_blob}function A(t){var e=this,n=e._initReady().then(function(){var t=p[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady});return c(n,t,t),n}function I(t,e,n,i){void 0===i&&(i=1);try{var o=t.db.transaction(t.storeName,e);n(null,o)}catch(o){if(i>0&&(!t.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return a.resolve().then(function(){if(!t.db||"NotFoundError"===o.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),w(t)}).then(function(){return function(t){y(t);for(var e=p[t.name],n=e.forages,i=0;i<n.length;i++){var o=n[i];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return t.db=null,S(t).then(function(e){return t.db=e,T(t)?w(t):e}).then(function(i){t.db=e.db=i;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=i}).catch(function(e){throw b(t,e),e})}(t).then(function(){I(t,e,n,i-1)})}).catch(n);n(o)}}var O={_driver:"asyncStorage",_initStorage:function(t){var e=this,n={db:null};if(t)for(var i in t)n[i]=t[i];var o=p[n.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},p[n.name]=o),o.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=A);var r=[];function s(){return a.resolve()}for(var c=0;c<o.forages.length;c++){var u=o.forages[c];u!==e&&r.push(u._initReady().catch(s))}var l=o.forages.slice(0);return a.all(r).then(function(){return n.db=o.db,S(n)}).then(function(t){return n.db=t,T(n,e._defaultConfig.version)?w(n):t}).then(function(t){n.db=o.db=t,e._dbInfo=n;for(var i=0;i<l.length;i++){var r=l[i];r!==e&&(r._dbInfo.db=n.db,r._dbInfo.version=n.version)}})},_support:function(){try{if(!o||!o.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),iterate:function(t,e){var n=this,i=new a(function(e,i){n.ready().then(function(){I(n._dbInfo,g,function(o,r){if(o)return i(o);try{var a=r.objectStore(n._dbInfo.storeName),s=a.openCursor(),c=1;s.onsuccess=function(){var n=s.result;if(n){var i=n.value;D(i)&&(i=k(i));var o=t(i,n.key,c++);void 0!==o?e(o):n.continue()}else e()},s.onerror=function(){i(s.error)}}catch(t){i(t)}})}).catch(i)});return s(i,e),i},getItem:function(t,e){var n=this;t=u(t);var i=new a(function(e,i){n.ready().then(function(){I(n._dbInfo,g,function(o,r){if(o)return i(o);try{var a=r.objectStore(n._dbInfo.storeName),s=a.get(t);s.onsuccess=function(){var t=s.result;void 0===t&&(t=null),D(t)&&(t=k(t)),e(t)},s.onerror=function(){i(s.error)}}catch(t){i(t)}})}).catch(i)});return s(i,e),i},setItem:function(t,e,n){var i=this;t=u(t);var o=new a(function(n,o){var r;i.ready().then(function(){return r=i._dbInfo,"[object Blob]"===d.call(e)?m(r.db).then(function(t){return t?e:(n=e,new a(function(t,e){var i=new FileReader;i.onerror=e,i.onloadend=function(e){var i=btoa(e.target.result||"");t({__local_forage_encoded_blob:!0,data:i,type:n.type})},i.readAsBinaryString(n)}));var n}):e}).then(function(e){I(i._dbInfo,v,function(r,a){if(r)return o(r);try{var s=a.objectStore(i._dbInfo.storeName);null===e&&(e=void 0);var c=s.put(e,t);a.oncomplete=function(){void 0===e&&(e=null),n(e)},a.onabort=a.onerror=function(){try{var t=c.error?c.error:c.transaction.error;o(t)}catch(t){o(t)}}}catch(t){o(t)}})}).catch(o)});return s(o,n),o},removeItem:function(t,e){var n=this;t=u(t);var i=new a(function(e,i){n.ready().then(function(){I(n._dbInfo,v,function(o,r){if(o)return i(o);try{var a=r.objectStore(n._dbInfo.storeName),s=a.delete(t);r.oncomplete=function(){e()},r.onerror=function(){i(s.error)},r.onabort=function(){try{var t=s.error?s.error:s.transaction.error;i(t)}catch(t){i(t)}}}catch(t){i(t)}})}).catch(i)});return s(i,e),i},clear:function(t){var e=this,n=new a(function(t,n){e.ready().then(function(){I(e._dbInfo,v,function(i,o){if(i)return n(i);try{var r=o.objectStore(e._dbInfo.storeName),a=r.clear();o.oncomplete=function(){t()},o.onabort=o.onerror=function(){try{var t=a.error?a.error:a.transaction.error;n(t)}catch(t){n(t)}}}catch(t){n(t)}})}).catch(n)});return s(n,t),n},length:function(t){var e=this,n=new a(function(t,n){e.ready().then(function(){I(e._dbInfo,g,function(i,o){if(i)return n(i);try{var r=o.objectStore(e._dbInfo.storeName),a=r.count();a.onsuccess=function(){t(a.result)},a.onerror=function(){n(a.error)}}catch(t){n(t)}})}).catch(n)});return s(n,t),n},key:function(t,e){var n=this,i=new a(function(e,i){t<0?e(null):n.ready().then(function(){I(n._dbInfo,g,function(o,r){if(o)return i(o);try{var a=r.objectStore(n._dbInfo.storeName),s=!1,c=(a.openKeyCursor||a.openCursor).call(a);c.onsuccess=function(){var n=c.result;n?0===t?e(n.key):s?e(n.key):(s=!0,n.advance(t)):e(null)},c.onerror=function(){i(c.error)}}catch(t){i(t)}})}).catch(i)});return s(i,e),i},keys:function(t){var e=this,n=new a(function(t,n){e.ready().then(function(){I(e._dbInfo,g,function(i,o){if(i)return n(i);try{var r=o.objectStore(e._dbInfo.storeName),a=(r.openKeyCursor||r.openCursor).call(r),s=[];a.onsuccess=function(){var e=a.result;e?(s.push(e.key),e.continue()):t(s)},a.onerror=function(){n(a.error)}}catch(t){n(t)}})}).catch(n)});return s(n,t),n},dropInstance:function(t,e){e=l.apply(this,arguments);var n,i=this.config();if((t="function"!=typeof t&&t||{}).name||(t.name=t.name||i.name,t.storeName=t.storeName||i.storeName),t.name){var r=t.name===i.name&&this._dbInfo.db,c=r?a.resolve(this._dbInfo.db):S(t).then(function(e){var n=p[t.name],i=n.forages;n.db=e;for(var o=0;o<i.length;o++)i[o]._dbInfo.db=e;return e});n=t.storeName?c.then(function(e){if(e.objectStoreNames.contains(t.storeName)){var n=e.version+1;y(t);var i=p[t.name],r=i.forages;e.close();for(var s=0;s<r.length;s++){var c=r[s];c._dbInfo.db=null,c._dbInfo.version=n}var u=new a(function(e,i){var r=o.open(t.name,n);r.onerror=function(t){var e=r.result;e.close(),i(t)},r.onupgradeneeded=function(){var e=r.result;e.deleteObjectStore(t.storeName)},r.onsuccess=function(){var t=r.result;t.close(),e(t)}});return u.then(function(t){i.db=t;for(var e=0;e<r.length;e++){var n=r[e];n._dbInfo.db=t,_(n._dbInfo)}}).catch(function(e){throw(b(t,e)||a.resolve()).catch(function(){}),e})}}):c.then(function(e){y(t);var n=p[t.name],i=n.forages;e.close();for(var r=0;r<i.length;r++){var s=i[r];s._dbInfo.db=null}var c=new a(function(e,n){var i=o.deleteDatabase(t.name);i.onerror=function(){var t=i.result;t&&t.close(),n(i.error)},i.onblocked=function(){console.warn('dropInstance blocked for database "'+t.name+'" until all open connections are closed')},i.onsuccess=function(){var t=i.result;t&&t.close(),e(t)}});return c.then(function(t){n.db=t;for(var e=0;e<i.length;e++){var o=i[e];_(o._dbInfo)}}).catch(function(e){throw(b(t,e)||a.resolve()).catch(function(){}),e})})}else n=a.reject("Invalid arguments");return s(n,e),n}},x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R="~~local_forage_type~",M=/^~~local_forage_type~([^~]+)~/,C="__lfsc__:",B=C.length,G="arbf",N="blob",L="si08",P="ui08",U="uic8",z="si16",j="si32",F="ur16",q="ui32",V="fl32",K="fl64",H=B+G.length,J=Object.prototype.toString;function W(t){var e,n,i,o,r,a=.75*t.length,s=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(e=0;e<s;e+=4)n=x.indexOf(t[e]),i=x.indexOf(t[e+1]),o=x.indexOf(t[e+2]),r=x.indexOf(t[e+3]),l[c++]=n<<2|i>>4,l[c++]=(15&i)<<4|o>>2,l[c++]=(3&o)<<6|63&r;return u}function X(t){var e,n=new Uint8Array(t),i="";for(e=0;e<n.length;e+=3)i+=x[n[e]>>2],i+=x[(3&n[e])<<4|n[e+1]>>4],i+=x[(15&n[e+1])<<2|n[e+2]>>6],i+=x[63&n[e+2]];return n.length%3==2?i=i.substring(0,i.length-1)+"=":n.length%3==1&&(i=i.substring(0,i.length-2)+"=="),i}var $={serialize:function(t,e){var n="";if(t&&(n=J.call(t)),t&&("[object ArrayBuffer]"===n||t.buffer&&"[object ArrayBuffer]"===J.call(t.buffer))){var i,o=C;t instanceof ArrayBuffer?(i=t,o+=G):(i=t.buffer,"[object Int8Array]"===n?o+=L:"[object Uint8Array]"===n?o+=P:"[object Uint8ClampedArray]"===n?o+=U:"[object Int16Array]"===n?o+=z:"[object Uint16Array]"===n?o+=F:"[object Int32Array]"===n?o+=j:"[object Uint32Array]"===n?o+=q:"[object Float32Array]"===n?o+=V:"[object Float64Array]"===n?o+=K:e(new Error("Failed to get type for BinaryArray"))),e(o+X(i))}else if("[object Blob]"===n){var r=new FileReader;r.onload=function(){var n=R+t.type+"~"+X(this.result);e(C+N+n)},r.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(n){console.error("Couldn't convert value into a JSON string: ",t),e(null,n)}},deserialize:function(t){if(t.substring(0,B)!==C)return JSON.parse(t);var e,n=t.substring(H),i=t.substring(B,H);if(i===N&&M.test(n)){var o=n.match(M);e=o[1],n=n.substring(o[0].length)}var a=W(n);switch(i){case G:return a;case N:return r([a],{type:e});case L:return new Int8Array(a);case P:return new Uint8Array(a);case U:return new Uint8ClampedArray(a);case z:return new Int16Array(a);case F:return new Uint16Array(a);case j:return new Int32Array(a);case q:return new Uint32Array(a);case V:return new Float32Array(a);case K:return new Float64Array(a);default:throw new Error("Unkown type: "+i)}},stringToBuffer:W,bufferToString:X};function Z(t,e,n,i){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,i)}function Q(t,e,n,i,o,r){t.executeSql(n,i,o,function(t,a){a.code===a.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],function(t,s){s.rows.length?r(t,a):Z(t,e,function(){t.executeSql(n,i,o,r)},r)},r):r(t,a)},r)}var Y={_driver:"webSQLStorage",_initStorage:function(t){var e=this,n={db:null};if(t)for(var i in t)n[i]="string"!=typeof t[i]?t[i].toString():t[i];var o=new a(function(t,i){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(t){return i(t)}n.db.transaction(function(o){Z(o,n,function(){e._dbInfo=n,t()},function(t,e){i(e)})},i)});return n.serializer=$,o},_support:"function"==typeof openDatabase,iterate:function(t,e){var n=this,i=new a(function(e,i){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){Q(n,o,"SELECT * FROM "+o.storeName,[],function(n,i){for(var r=i.rows,a=r.length,s=0;s<a;s++){var c=r.item(s),u=c.value;if(u&&(u=o.serializer.deserialize(u)),void 0!==(u=t(u,c.key,s+1)))return void e(u)}e()},function(t,e){i(e)})})}).catch(i)});return s(i,e),i},getItem:function(t,e){var n=this;t=u(t);var i=new a(function(e,i){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){Q(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[t],function(t,n){var i=n.rows.length?n.rows.item(0).value:null;i&&(i=o.serializer.deserialize(i)),e(i)},function(t,e){i(e)})})}).catch(i)});return s(i,e),i},setItem:function(t,e,n){return function t(e,n,i,o){var r=this;e=u(e);var c=new a(function(a,s){r.ready().then(function(){void 0===n&&(n=null);var c=n,u=r._dbInfo;u.serializer.serialize(n,function(n,l){l?s(l):u.db.transaction(function(t){Q(t,u,"INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[e,n],function(){a(c)},function(t,e){s(e)})},function(n){if(n.code===n.QUOTA_ERR){if(o>0)return void a(t.apply(r,[e,c,i,o-1]));s(n)}})})}).catch(s)});return s(c,i),c}.apply(this,[t,e,n,1])},removeItem:function(t,e){var n=this;t=u(t);var i=new a(function(e,i){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){Q(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[t],function(){e()},function(t,e){i(e)})})}).catch(i)});return s(i,e),i},clear:function(t){var e=this,n=new a(function(t,n){e.ready().then(function(){var i=e._dbInfo;i.db.transaction(function(e){Q(e,i,"DELETE FROM "+i.storeName,[],function(){t()},function(t,e){n(e)})})}).catch(n)});return s(n,t),n},length:function(t){var e=this,n=new a(function(t,n){e.ready().then(function(){var i=e._dbInfo;i.db.transaction(function(e){Q(e,i,"SELECT COUNT(key) as c FROM "+i.storeName,[],function(e,n){var i=n.rows.item(0).c;t(i)},function(t,e){n(e)})})}).catch(n)});return s(n,t),n},key:function(t,e){var n=this,i=new a(function(e,i){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){Q(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[t+1],function(t,n){var i=n.rows.length?n.rows.item(0).key:null;e(i)},function(t,e){i(e)})})}).catch(i)});return s(i,e),i},keys:function(t){var e=this,n=new a(function(t,n){e.ready().then(function(){var i=e._dbInfo;i.db.transaction(function(e){Q(e,i,"SELECT key FROM "+i.storeName,[],function(e,n){for(var i=[],o=0;o<n.rows.length;o++)i.push(n.rows.item(o).key);t(i)},function(t,e){n(e)})})}).catch(n)});return s(n,t),n},dropInstance:function(t,e){e=l.apply(this,arguments);var n=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);var i,o=this;return s(i=t.name?new a(function(e){var i;i=t.name===n.name?o._dbInfo.db:openDatabase(t.name,"","",0),t.storeName?e({db:i,storeNames:[t.storeName]}):e(function(t){return new a(function(e,n){t.transaction(function(i){i.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(n,i){for(var o=[],r=0;r<i.rows.length;r++)o.push(i.rows.item(r).name);e({db:t,storeNames:o})},function(t,e){n(e)})},function(t){n(t)})})}(i))}).then(function(t){return new a(function(e,n){t.db.transaction(function(i){function o(t){return new a(function(e,n){i.executeSql("DROP TABLE IF EXISTS "+t,[],function(){e()},function(t,e){n(e)})})}for(var r=[],s=0,c=t.storeNames.length;s<c;s++)r.push(o(t.storeNames[s]));a.all(r).then(function(){e()}).catch(function(t){n(t)})},function(t){n(t)})})}):a.reject("Invalid arguments"),e),i}};function tt(t,e){var n="";return t.name&&(n=t.name+"/"),t.storeName!==e.storeName&&(n+=t.storeName+"/"),n}function et(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(t){return!0}}()||localStorage.length>0}var nt={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var n in t)e[n]=t[n];return e.keyPrefix=tt(t,this._defaultConfig),et()?(this._dbInfo=e,e.serializer=$,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}(),iterate:function(t,e){var n=this,i=n.ready().then(function(){for(var e=n._dbInfo,i=e.keyPrefix,o=i.length,r=localStorage.length,a=1,s=0;s<r;s++){var c=localStorage.key(s);if(0===c.indexOf(i)){var u=localStorage.getItem(c);if(u&&(u=e.serializer.deserialize(u)),void 0!==(u=t(u,c.substring(o),a++)))return u}}});return s(i,e),i},getItem:function(t,e){var n=this;t=u(t);var i=n.ready().then(function(){var e=n._dbInfo,i=localStorage.getItem(e.keyPrefix+t);return i&&(i=e.serializer.deserialize(i)),i});return s(i,e),i},setItem:function(t,e,n){var i=this;t=u(t);var o=i.ready().then(function(){void 0===e&&(e=null);var n=e;return new a(function(o,r){var a=i._dbInfo;a.serializer.serialize(e,function(e,i){if(i)r(i);else try{localStorage.setItem(a.keyPrefix+t,e),o(n)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||r(t),r(t)}})})});return s(o,n),o},removeItem:function(t,e){var n=this;t=u(t);var i=n.ready().then(function(){var e=n._dbInfo;localStorage.removeItem(e.keyPrefix+t)});return s(i,e),i},clear:function(t){var e=this,n=e.ready().then(function(){for(var t=e._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var i=localStorage.key(n);0===i.indexOf(t)&&localStorage.removeItem(i)}});return s(n,t),n},length:function(t){var e=this.keys().then(function(t){return t.length});return s(e,t),e},key:function(t,e){var n=this,i=n.ready().then(function(){var e,i=n._dbInfo;try{e=localStorage.key(t)}catch(t){e=null}return e&&(e=e.substring(i.keyPrefix.length)),e});return s(i,e),i},keys:function(t){var e=this,n=e.ready().then(function(){for(var t=e._dbInfo,n=localStorage.length,i=[],o=0;o<n;o++){var r=localStorage.key(o);0===r.indexOf(t.keyPrefix)&&i.push(r.substring(t.keyPrefix.length))}return i});return s(n,t),n},dropInstance:function(t,e){if(e=l.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var n=this.config();t.name=t.name||n.name,t.storeName=t.storeName||n.storeName}var i,o=this;return s(i=t.name?new a(function(e){t.storeName?e(tt(t,o._defaultConfig)):e(t.name+"/")}).then(function(t){for(var e=localStorage.length-1;e>=0;e--){var n=localStorage.key(e);0===n.indexOf(t)&&localStorage.removeItem(n)}}):a.reject("Invalid arguments"),e),i}},it=function(t,e){for(var n=t.length,i=0;i<n;){if((o=t[i])===(r=e)||"number"==typeof o&&"number"==typeof r&&isNaN(o)&&isNaN(r))return!0;i++}var o,r;return!1},ot=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},rt={},at={},st={INDEXEDDB:O,WEBSQL:Y,LOCALSTORAGE:nt},ct=[st.INDEXEDDB._driver,st.WEBSQL._driver,st.LOCALSTORAGE._driver],ut=["dropInstance"],lt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ut),ht={description:"",driver:ct.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ft(t,e){t[e]=function(){var n=arguments;return t.ready().then(function(){return t[e].apply(t,n)})}}function pt(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var n in e)e.hasOwnProperty(n)&&(ot(e[n])?arguments[0][n]=e[n].slice():arguments[0][n]=e[n])}return arguments[0]}var dt=function(){function t(e){for(var n in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),st)if(st.hasOwnProperty(n)){var i=st[n],o=i._driver;this[n]=o,rt[o]||this.defineDriver(i)}this._defaultConfig=pt({},ht),this._config=pt({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":i(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t&&t.driver)||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,n){var i=new a(function(e,n){try{var i=t._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void n(o);for(var r=lt.concat("_initStorage"),c=0,u=r.length;c<u;c++){var l=r[c],h=!it(ut,l);if((h||t[l])&&"function"!=typeof t[l])return void n(o)}!function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),n=a.reject(e);return s(n,arguments[arguments.length-1]),n}},n=0,i=ut.length;n<i;n++){var o=ut[n];t[o]||(t[o]=e(o))}}();var f=function(n){rt[i]&&console.info("Redefining LocalForage driver: "+i),rt[i]=t,at[i]=n,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(f,n):f(!!t._support):f(!0)}catch(t){n(t)}});return c(i,e,n),i},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,n){var i=rt[t]?a.resolve(rt[t]):a.reject(new Error("Driver not found."));return c(i,e,n),i},t.prototype.getSerializer=function(t){var e=a.resolve($);return c(e,t),e},t.prototype.ready=function(t){var e=this,n=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return c(n,t,t),n},t.prototype.setDriver=function(t,e,n){var i=this;ot(t)||(t=[t]);var o=this._getSupportedDrivers(t);function r(){i._config.driver=i.driver()}function s(t){return i._extend(t),r(),i._ready=i._initStorage(i._config),i._ready}var u=null!==this._driverSet?this._driverSet.catch(function(){return a.resolve()}):a.resolve();return this._driverSet=u.then(function(){var t=o[0];return i._dbInfo=null,i._ready=null,i.getDriver(t).then(function(t){i._driver=t._driver,r(),i._wrapLibraryMethodsWithReady(),i._initDriver=function(t){return function(){var e=0;return function n(){for(;e<t.length;){var o=t[e];return e++,i._dbInfo=null,i._ready=null,i.getDriver(o).then(s).catch(n)}r();var c=new Error("No available storage method found.");return i._driverSet=a.reject(c),i._driverSet}()}}(o)})}).catch(function(){r();var t=new Error("No available storage method found.");return i._driverSet=a.reject(t),i._driverSet}),c(this._driverSet,e,n),this._driverSet},t.prototype.supports=function(t){return!!at[t]},t.prototype._extend=function(t){pt(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],n=0,i=t.length;n<i;n++){var o=t[n];this.supports(o)&&e.push(o)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=lt.length;t<e;t++)ft(this,lt[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),gt=new dt;e.exports=gt},{3:3}]},{},[4])(4)}),In=function(){function t(t,e){return this.dbStorage=An.createInstance({driver:[An.INDEXEDDB,An.LOCALSTORAGE],name:"applog_sdk_event_store_".concat(t),storeName:e}),this.dbStorage}return t.prototype.getItem=function(t){return e(this,void 0,void 0,function(){var e,i;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.dbStorage.getItem(t)];case 1:e=n.sent(),i=e;try{e&&"string"==typeof e&&(i=JSON.parse(e))}catch(t){}return[2,i||void 0];case 2:return n.sent(),console.warn("db get storage error"),[3,3];case 3:return[2,void 0]}})})},t.prototype.setItem=function(t,e){try{this.dbStorage.setItem(t,e)}catch(t){console.warn("db set storage error")}},t.prototype.removeItem=function(t){try{this.dbStorage.removeItem(t)}catch(t){console.warn("db remove storage error")}},t}(),On=function(){function t(){this.errorCache=new Map,this.sleepTime=1e3,this.maxTime=16e3,this.minTime=1e3,this.goodCount=0,this.maxGoodCount=2,this.maxSilceCount=50,this.sendStatus=!1,this.firstTrigger=!0,this.degradeStarted=!1,this.backoff_ratio=0,this.tempId=[]}return t.prototype.apply=function(t,e){var n=this;try{if(t.destroy)return;if(!e.enable_storage)return;this.collect=t,this.config=e,this.storage=new In(e.app_id,"DEGRADE_EVENT_STORE"),this.eventUrl=this.collect.configManager.getUrl("event"),this.eventKey="__applog_degrade_events",this.eventSleepTimeKey="__applog_degrade_events_sleep_time",this.collect.on("http-error",function(t){n.setErrorData(t)}),this.collect.on("backoff-ratio",function(t){t&&0===t.e&&(n.backoff_ratio=t.backoff_ratio||0)}),this.checkStorage()}catch(t){console.log("degrade init error",JSON.stringify(t))}},t.prototype.getSleepTime=function(){return e(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return t=this,[4,this.storage.getItem(this.eventSleepTimeKey)];case 1:return t.sleepTime=e.sent()||this.sleepTime,console.log(this.sleepTime),[2]}})})},t.prototype.triggerDegrade=function(t){return e(this,void 0,void 0,function(){var e,i;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),console.log("degradeInfo",t),e=t.data,"degrade"===t.status?(this.addSleep(),[2]):(this.degradeStarted=!0,this.collect.degradeStarted=!0,[4,this.setEventStorage(e)]);case 1:return n.sent(),this.tryReportStoreData(),!this.firstTrigger&&this.addSleep(),this.firstTrigger=!1,[3,3];case 2:return i=n.sent(),console.log("trigger degrade error",JSON.stringify(i)),[3,3];case 3:return[2]}})})},t.prototype.checkStorage=function(){return e(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.storage.getItem(this.eventKey)];case 1:return(t=e.sent())&&t.size?(this.degradeStarted=!0,this.collect.degradeStarted=!0,this.tryReportStoreData(),[3,3]):[2];case 2:return e.sent(),console.log("check storage error"),[3,3];case 3:return[2]}})})},t.prototype.setErrorData=function(t){return e(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return"degrade"===t.status?[2]:[4,this.setEventStorage(t)];case 1:return e.sent(),[2]}})})},t.prototype.setEventStorage=function(t){return e(this,void 0,void 0,function(){var e,i,o;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.storage.getItem(this.eventKey)];case 1:return(e=n.sent())||(e=new Map),i=ct(),o=t.data,console.log("eventS",JSON.stringify(o)),e.set(i,{eventData:o,id:i}),this.setDataToDB(e),[3,3];case 2:return n.sent(),console.warn("set DB storage error"),[3,3];case 3:return[2]}})})},t.prototype.getStoragefromDBToSlice=function(){return e(this,void 0,void 0,function(){var t,e,o,r,a,s,c,u,l,h,f=this;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.storage.getItem(this.eventKey)];case 1:if(t=n.sent(),console.log("eventMap",t),e=new Map,o=[],this.tempId=[],t.size<=this.maxSilceCount)e=t;else try{for(r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),a=r.next();!a.done&&(s=i(a.value,2),c=s[0],u=s[1],e.size<this.maxSilceCount);a=r.next())e.set(c,u)}catch(t){l={error:t}}finally{try{a&&!a.done&&(h=r.return)&&h.call(r)}finally{if(l)throw l.error}}return e.forEach(function(t){o.push(t.eventData[0]),f.tempId.push(t.id)}),[2,o];case 2:return n.sent(),[2,[]];case 3:return[2]}})})},t.prototype.setDataToDB=function(t){try{console.log("set data ",t),this.storage.setItem(this.eventKey,t)}catch(e){console.log("set data to DB error",JSON.stringify(e)),this.dropEvents(t)}},t.prototype.dropEvents=function(t){try{var e=this.collect.configManager.get(),n=e.user,i=e.header;i.app_id=1338;var o=[];t.forEach(function(t){var e=t.event,n=t.local_time_ms;o.push({eventName:e,eventTime:n})});var r={events:[{event:"sdk_monitor",params:JSON.stringify({storage_fails:o}),local_time_ms:Date.now()}],user:n,header:i};this.collect.requestManager.useRequest({url:this.eventUrl,data:r,timeout:3e4,type:"event"})}catch(t){console.log("drop data error",JSON.stringify(t))}},t.prototype.tryReportStoreData=function(){var t=this;if(!this.sendStatus){this.sendStatus=!0;try{this.sleepFn=setTimeout(function(){return e(t,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return[4,this.getStoragefromDBToSlice()];case 1:return(t=e.sent()).length?0!==this.backoff_ratio&&this.backoff_ratio&&this.random()<this.backoff_ratio?(clearTimeout(this.sleepFn),[2]):(this.fetchData(t),[2]):(clearTimeout(this.sleepFn),[2])}})})},this.sleepTime)}catch(t){console.warn("error check storage")}}},t.prototype.addSleep=function(){this.sendStatus=!1,this.sleepTime=2*this.sleepTime,this.sleepTime>this.maxTime&&(this.sleepTime=this.maxTime),this.storage.setItem(this.eventSleepTimeKey,this.sleepTime),clearTimeout(this.sleepFn),this.tryReportStoreData()},t.prototype.reduceDataFromDB=function(){return e(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),this.degradeStarted?(this.sendStatus=!1,this.goodCount+=1,clearTimeout(this.sleepFn),[4,this.storage.getItem(this.eventKey)]):[2];case 1:return t=e.sent(),this.tempId.length&&t&&(this.tempId.forEach(function(e){t.delete(e)}),this.tempId=[],this.setDataToDB(t)),this.storage.setItem(this.eventSleepTimeKey,this.sleepTime),[4,this.reportRest()];case 2:return e.sent(),[3,4];case 3:return e.sent(),console.warn("reduceDataFromDB error"),[3,4];case 4:return[2]}})})},t.prototype.reportRest=function(){return e(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.storage.getItem(this.eventKey)];case 1:return(t=e.sent())&&t.size?(this.tryReportStoreData(),[3,3]):[2];case 2:return e.sent(),[3,3];case 3:return[2]}})})},t.prototype.random=function(){return Math.floor(1e4*Math.random())},t.prototype.fetchData=function(t){var e=this;this.collect.requestManager.useRequest({url:this.eventUrl,data:t,timeout:3e4,type:"event",status:"degrade",success:function(){e.reduceDataFromDB()}})},t.prototype.destroy=function(){this.collect.off("http-error"),this.collect.off("http-ok")},t}();try{var xn=vt();xn&&(xn.LogStore=function(t,e){(new On).apply(t,e)})}catch(t){console.log(t)}var Rn=function(){function t(){this.autotrack=!1,this.spa=!1,this.cache={},this.allowHash=!1}return t.prototype.apply=function(t,e){if(e.spa||e.autotrack){var n=t.Types;this.collect=t,this.config=e,this.appid=e.app_id,this.allowHash=e.allow_hash,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),t.emit(n.RouteReady)}},t.prototype.setKey=function(){var t=this.collect.adapters.storage;this.storage=new t(!1),this.cache_key="__tea_cache_refer_".concat(this.appid),this.cache={refer_key:"",refer_title:document.title||location.pathname,refer_manual_key:"",routeChange:!1},this.config.autotrack&&"object"==typeof this.config.autotrack&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},t.prototype.hack=function(){var t=this,e=window.history.pushState;history.pushState=function(n){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];"function"==typeof history.onpushstate&&history.onpushstate({state:n});var s=e.call.apply(e,o([history,n],i(r)));if(t.collect.emit("STATE_CHANGE",n),t.lastLocation===location.href)return s;t.setReferCache(t.lastLocation);var c=t.getPopStateChangeEventData();return t.lastLocation=location.href,t.sendPv(c,"pushState"),s};var n=history.replaceState;history.replaceState=function(e){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];"function"==typeof history.onreplacestate&&history.onreplacestate({state:e});var s=n.call.apply(n,o([history,e],i(r)));if(t.collect.emit("STATE_CHANGE",e),t.lastLocation===location.href)return s;t.setReferCache(t.lastLocation);var c=t.getPopStateChangeEventData();return t.lastLocation=location.href,t.sendPv(c),s}},t.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},t.prototype.getLocation=function(){return this.lastLocation},t.prototype.init=function(){var t=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:t,init:!0})},t.prototype.listener=function(){var t=this,e=null;window.addEventListener("hashchange",function(n){if(t.lastLocation!==window.location.href&&(clearTimeout(e),t.allowHash)){t.setReferCache(t.lastLocation),t.lastLocation=window.location.href;var i=t.getPopStateChangeEventData();t.sendPv(i)}}),window.addEventListener("popstate",function(n){t.lastLocation!==window.location.href&&(e=setTimeout(function(){t.setReferCache(t.lastLocation),t.lastLocation=window.location.href;var e=t.getPopStateChangeEventData();t.sendPv(e)},10))})},t.prototype.getPopStateChangeEventData=function(){var t=this.pageConfig();return t.is_back=0,t},t.prototype.pageConfig=function(){try{var t=this.storage.getItem(this.cache_key)||{},e=!1,n=this.storage.getItem("__tea_cache_first_".concat(this.appid));return e=!n||1!=n,{is_html:1,url:location.href,referrer:this.handleRefer(),page_key:location.href,refer_page_key:this.handleRefer(),page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:t&&t.refer_manual_key||"",refer_page_title:t&&t.refer_title||"",page_path:this.collect.handlePath(),url_path:this.collect.handlePath(),page_host:location.host,is_first_time:"".concat(e)}}catch(t){return this.collect.emit(U.DEBUGGER_MESSAGE,{type:U.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),{}}},t.prototype.sendPv=function(t,e){this.collect.emit("route-change",{config:t,init:!1})},t.prototype.handleRefer=function(){var t="";try{var e=this.storage.getItem(this.cache_key)||{};t=e.routeChange?e.refer_key:this.collect.configManager.get("referrer")}catch(e){t=document.referrer}return t},t.prototype.setReferCache=function(t){var e=this.storage.getItem(this.cache_key)||{};e.refer_key=t,e.routeChange=!0,this.storage.setItem(this.cache_key,e)},t}();try{var Mn=vt();Mn&&(Mn.LogRoute=function(t,e){(new Rn).apply(t,e)})}catch(t){console.log(t)}var Cn=["getConfig","getAbSdkVersion"],Bn=["init","usePlugin","autoInitializationRangers","on"],Gn=function(){function t(t){this.task=[],this.newProcessTask=[],this.processMap=!1,this.Collector=t,this.collectMap=new Map,this.processMap=new Map}return t.prototype.processTask=function(){var t=this;if(this.task.length){var e=this.findIndex(this.task,Bn,"0");if(-1!==e){var n=this.processScope(this.task[e][0]).scope;this.processMap.set(n,!0),this.processCmd.apply(this,o([],i(this.task[e]))),this.newProcessTask=this.task.filter(function(t){if("default"===n){if(-1===t[0].indexOf("."))return t}else if(-1!==t[0].indexOf("".concat(n,".")))return t});var r=this.findIndex(this.newProcessTask,Bn,"0");this.newProcessTask.forEach(function(e,n){n!==r&&t.processCmd.apply(t,o([],i(e)))}),this.newProcessTask=[]}}},t.prototype.processCmd=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(c(t)){var n=this.processScope(t[0]),i=n.scope,o=n.cmd;if(!this.processMap.get(i))return this.task.push(t),void this.processTask();if(t.splice(0,1),-1!==Cn.indexOf(o))return this.callCmd(i,o,t);this.callCmd(i,o,t)}},t.prototype.callCmd=function(t,e,n){try{if(-1!==Bn.indexOf(e)&&(this.collectMap.get(t)||(this.collect=new this.Collector(t),this.collectMap.set(t,this.collect))),!this.collectMap.get(t))return void console.log("init or use must be first call, cmd:".concat(e));var r=this.collectMap.get(t);if(r&&r[e])if("event"===e)r.event.apply(r,o([e],i(n)));else{if(-1!==Cn.indexOf(e))return r[e].apply(r,o([],i(n)));r[e].apply(r,o([],i(n)))}else r.event.apply(r,o([e],i(n)))}catch(t){console.log(t.message)}},t.prototype.findIndex=function(t,e,n){var i=this,o=-1;try{t.forEach(function(t,r){var a=void 0!==n?t[n]:t,s=i.processScope(a).cmd;-1!==e.indexOf(s)&&(o=r)})}catch(t){return o}return o},t.prototype.processScope=function(t){var e="default";try{if("string"==typeof t&&t.indexOf(".")>-1){var n=t.split(".");e=n[0],t=n[1]}}catch(n){return{scope:e,cmd:t}}return{scope:e,cmd:t}},t}();ye.usePlugin(Re,"ab"),ye.usePlugin(Ge,"stay"),ye.usePlugin(En,"autotrack"),ye.usePlugin(On,"degrade"),ye.usePlugin(Dn,"verify_h5"),ye.usePlugin(Le,"heartbeat"),ye.usePlugin(Pe,"monitor"),ye.usePlugin(Rn,"route"),ye.usePlugin(Tn,"tracer"),function(t){if("undefined"!=typeof window){var e=function(){if("undefined"!=typeof window)return window.LogAnalyticsObject||window.TeaAnalyticsObject}();if(e&&window[e]){var n=window[e];n.sdkLoad?console.log("you page has load sdk file already, do not load another sdk file"):(t.task=n.q||[],window[e]=t.processCmd.bind(t),window[e].sdkLoad=!0,t.processTask())}}}(new Gn(ye))}();
